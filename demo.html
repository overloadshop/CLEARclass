<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>班级管理系统 - 演示</title>
    <link rel="stylesheet" href="assets/icons.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #ffffff;
        }
        
        .page-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* 侧边栏样式 */
        .sidebar {
            width: 250px;
            background-color: #f8f9fa;
            border-right: 1px solid #e9ecef;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid #e9ecef;
            margin-bottom: 20px;
        }
        
        .sidebar-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            margin-bottom: 5px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #666;
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .nav-link:hover {
            background-color: #e9ecef;
            color: #333;
        }
        
        .nav-link.active {
            background-color: #007AFF;
            color: white;
        }
        
        .nav-icon {
            margin-right: 8px !important;
            width: 18px !important;
            height: 18px !important;
        }
        
        /* 主内容区域 */
        .main-content {
            flex: 1;
            margin-left: 250px;
            display: flex;
            flex-direction: column;
        }
        
        .content-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .page-title {
            font-size: 32px;
            font-weight: 600;
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        /* 控制台专用样式 */
        .console-content {
            display: none;
        }
        
        .console-content.active {
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        .stat-card.clickable {
            cursor: pointer;
        }
        
        .stat-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .stat-icon {
            font-size: 14px;
            margin-right: 8px;
            width: 14px;
            height: 14px;
        }
        
        .stat-title {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }
        
        .stat-desc {
            font-size: 12px;
            color: #999;
        }
        
        .notice-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }
        
        .notice-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 1px solid #e9ecef;
            height: 28px;
        }
        
        .notice-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 4px;
            flex: 1;
            justify-content: center;
        }
        
        .add-notice-btn {
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 14px;
            flex-shrink: 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }
        
        .add-notice-btn:hover {
            background: #0056b3;
        }
        
        .empty-notice {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }
        
        .empty-notice-text {
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* 统一弹窗样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(2px);
        }
        
        .modal-content {
            background-color: white;
            margin: 0 auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #e0e0e0;
            background: #3498db;
            border-radius: 4px 4px 0 0;
        }
        
        .modal-header h3 {
            margin: 0;
            color: white;
            font-size: 18px;
            font-weight: 600;
        }
        
        .close {
            color: white;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            background: none;
            border: none;
            padding: 4px;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }
        
        .close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .modal-body {
            padding: 24px;
            background: white;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }
        
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            box-sizing: border-box;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 20px 28px;
            border-top: 1px solid #e9ecef;
            background: white;
            border-radius: 0 0 12px 12px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s ease;
            min-width: 80px;
        }
        
        .btn-cancel, .btn-secondary {
            background: #95a5a6;
            color: white;
            border: none;
        }
        
        .btn-cancel:hover, .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .btn-confirm, .btn-primary {
            background: #3498db;
            color: white;
            border: none;
        }
        
        .btn-confirm:hover, .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
            border: none;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        /* 星期选择器样式 */
        .week-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        
        .week-checkbox {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            min-width: 60px;
            justify-content: center;
        }
        
        .week-checkbox:hover {
            border-color: #007bff;
            background: #f8f9ff;
        }
        
        .week-checkbox.selected {
            border-color: #007bff;
            background: #007bff;
            color: white;
        }
        
        .week-checkbox input[type="checkbox"] {
            display: none;
        }
        
        /* 悬浮提示样式 */
        [title] {
            position: relative;
        }
        
        [title]:hover::after {
            content: attr(title);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            margin-bottom: 5px;
            pointer-events: none;
        }
        
        [title]:hover::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            pointer-events: none;
        }
        
        /* Toast吐司提醒样式 */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            pointer-events: none;
        }
        
        .toast {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            padding: 16px 20px;
            margin-bottom: 10px;
            min-width: 300px;
            max-width: 400px;
            border-left: 4px solid #007bff;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(100%);
            transition: all 0.3s ease;
            pointer-events: auto;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            border-left-color: #28a745;
        }
        
        .toast.error {
            border-left-color: #dc3545;
        }
        
        .toast.warning {
            border-left-color: #ffc107;
        }
        
        .toast.info {
            border-left-color: #17a2b8;
        }
        
        .toast-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }
        
        .toast-icon.success {
            color: #28a745;
        }
        
        .toast-icon.error {
            color: #dc3545;
        }
        
        .toast-icon.warning {
            color: #ffc107;
        }
        
        .toast-icon.info {
            color: #17a2b8;
        }
        
        .toast-content {
            flex: 1;
        }
        
        .toast-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: #333;
        }
        
        .toast-message {
            color: #666;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .toast-close {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 18px;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .toast-close:hover {
            color: #666;
        }
        
        /* 响应式设计 */
        
        .notice-item {
             padding: 12px 0;
             border-bottom: 1px solid #f8f9fa;
             position: relative;
         }
         
         .notice-item:last-child {
             border-bottom: none;
         }
         
         .notice-item.pinned {
             background-color: #fff3cd;
             border-left: 4px solid #ffc107;
             padding-left: 16px;
             margin-left: -4px;
         }
         
         .notice-content {
             color: #333;
             line-height: 1.5;
             margin-bottom: 5px;
             padding-right: 60px;
         }
         
         .notice-time {
             color: #999;
             font-size: 12px;
         }
         
         .notice-actions {
             position: absolute;
             right: 0;
             top: 50%;
             transform: translateY(-50%);
             display: flex;
             gap: 5px;
         }
         
         .pin-btn {
             background: none;
             border: none;
             color: #999;
             cursor: pointer;
             font-size: 14px;
             padding: 2px 4px;
             border-radius: 3px;
             transition: all 0.3s;
         }
         
         .pin-btn:hover {
             background: #f8f9fa;
             color: #333;
         }
         
         .pin-btn.pinned {
             color: #ffc107;
         }
         
         .pinned-label {
             color: #856404;
             font-size: 11px;
             font-weight: bold;
             margin-left: 8px;
         }
        
        .default-content {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            min-height: 400px;
        }
        
        /* 作业管理样式 */
         .homework-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 20px;
         }
         
         .homework-header h2 {
             margin: 0;
             color: #333;
         }

        /* 课程表样式 */
        .schedule-toolbar-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
            transition: box-shadow 0.3s ease;
        }

        .schedule-toolbar-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        .schedule-content-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            transition: box-shadow 0.3s ease;
        }

        .schedule-content-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        .edit-control-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
            transition: box-shadow 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .edit-control-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        .edit-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .edit-controls .btn {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .schedule-toolbar {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .schedule-toolbar .btn {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .schedule-toolbar .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .schedule-toolbar .btn-primary:hover {
            background: #2980b9;
        }
        
        .schedule-toolbar .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .schedule-toolbar .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .schedule-toolbar .btn-success {
            background: #2ecc71;
            color: white;
        }
        
        .schedule-toolbar .btn-success:hover {
            background: #27ae60;
        }
        
        .schedule-toolbar .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .schedule-toolbar .btn-danger:hover {
            background: #c0392b;
        }
        
        .schedule-toolbar .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .schedule-toolbar .btn-warning:hover {
            background: #e67e22;
        }
        
        .schedule-toolbar .btn-info {
            background: #3498db;
            color: white;
        }
        
        .schedule-toolbar .btn-info:hover {
            background: #2980b9;
        }
        
        .schedule-messages {
            margin-bottom: 15px;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid #c3e6cb;
            margin-bottom: 10px;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid #f5c6cb;
            margin-bottom: 10px;
        }
        
        .loading {
            background: #d1ecf1;
            color: #0c5460;
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid #bee5eb;
            text-align: center;
        }
        
        .schedule-content-card {
            overflow-x: auto;
        }
        
        .schedule-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 14px;
            min-width: 800px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            table-layout: fixed;
        }
        
        .schedule-table th,
        .schedule-table td {
            border-right: 1px solid #e9ecef;
            border-bottom: 1px solid #e9ecef;
            padding: 12px 8px;
            text-align: center;
            vertical-align: middle;
            position: relative;
        }
        
        .schedule-table th:last-child,
        .schedule-table td:last-child {
            border-right: none;
        }
        
        .schedule-table tr:last-child td {
            border-bottom: none;
        }
        
        .schedule-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 2px solid #dee2e6;
        }
        
        .schedule-table th:first-child {
            background: #e9ecef;
            font-weight: 700;
            width: 100px;
            min-width: 100px;
            max-width: 100px;
            color: #343a40;
        }
        
        .schedule-table th:not(:first-child) {
            width: 120px;
            min-width: 120px;
            max-width: 120px;
        }
        
        .schedule-table td {
            background: white;
            height: 50px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            overflow: hidden;
            vertical-align: middle;
            width: 120px;
            min-width: 120px;
            max-width: 120px;
            border: 1px solid #dee2e6;
            position: relative;
        }
        
        .schedule-table td:hover {
            background: #f8f9fa;
        }
        
        .schedule-table td:first-child {
            background: #e9ecef;
            font-weight: 600;
            color: #495057;
            cursor: default;
        }
        
        .schedule-table td:first-child:hover {
            background: #e9ecef;
        }
        
        .schedule-cell {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            font-size: 12px;
            font-family: 'Microsoft YaHei', 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
            font-weight: 400;
            text-align: center;
            resize: none;
            outline: none;
            padding: 4px 2px;
            line-height: 1.2;
            overflow: hidden;
            word-wrap: break-word;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }

        /* 字体自适应样式 */
        .schedule-cell.font-small {
            font-size: 10px;
            line-height: 1.1;
            font-weight: 400;
        }

        .schedule-cell.font-medium {
            font-size: 12px;
            line-height: 1.2;
            font-weight: 500;
        }

        .schedule-cell.font-large {
            font-size: 14px;
            line-height: 1.3;
            font-weight: 600;
        }
        
        .schedule-cell:focus {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #ffc107;
            box-shadow: 0 2px 8px rgba(255, 193, 7, 0.3);
            transform: scale(1.02);
        }

        .schedule-cell:disabled {
            background: transparent;
            cursor: default;
            color: #6c757d;
            font-weight: 500;
        }

        .schedule-cell:disabled:hover {
            background: rgba(248, 249, 250, 0.5);
            transform: none;
        }

        .schedule-cell:disabled {
            background: #f8f9fa;
            color: #495057;
        }
        
        .schedule-cell:not(:disabled) {
            background: #fff;
            border: 1px solid #007bff;
        }
        
        .file-input {
            display: none;
        }

        /* 时间段管理样式 */
        .time-slot-list {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
        }

        .time-slot-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 5px;
            background: #f9f9f9;
            border-radius: 3px;
            border-left: 4px solid #007bff;
        }

        .time-slot-item.break {
            border-left-color: #28a745;
        }

        .time-slot-item.lunch {
            border-left-color: #ffc107;
        }

        .time-slot-item.activity {
            border-left-color: #17a2b8;
        }

        .time-slot-info {
            flex: 1;
        }

        .time-slot-name {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .time-slot-time {
            font-size: 12px;
            color: #666;
        }

        .time-slot-actions {
            display: flex;
            gap: 5px;
        }

        .btn-small {
            padding: 2px 8px;
            font-size: 12px;
            border-radius: 3px;
        }

        .add-time-slot {
            border-top: 1px solid #ddd;
            padding-top: 15px;
        }

        .schedule-table th, .schedule-table td {
            position: relative;
        }

        .cell-actions {
            position: absolute;
            top: 2px;
            right: 2px;
            display: none;
        }

        .schedule-table td:hover .cell-actions {
            display: block;
        }

        .btn-cell {
            padding: 1px 4px;
            font-size: 10px;
            margin-left: 2px;
        }

        /* 右键菜单样式 */
        .context-menu {
            position: fixed;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 10000;
            min-width: 150px;
        }

        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
            border-bottom: 1px solid #f0f0f0;
        }

        .context-menu-item:hover {
            background: #f5f5f5;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .context-menu-separator {
            height: 1px;
            background: #e0e0e0;
            margin: 4px 0;
        }

        /* 拖拽样式 */
        .dragging {
            opacity: 0.5;
        }

        .drag-over {
            background: #e3f2fd !important;
            border: 2px dashed #2196f3 !important;
        }

        .schedule-cell.selected {
            background: #fff3cd !important;
            border: 2px solid #ffc107 !important;
        }
         
         .add-homework-btn {
             background: #4a90e2;
             color: white;
             border: none;
             padding: 10px 20px;
             border-radius: 8px;
             cursor: pointer;
             font-size: 14px;
             font-weight: 500;
             transition: all 0.3s ease;
             display: flex;
             align-items: center;
             justify-content: center;
             text-align: center;
         }
         
         .add-homework-btn:hover {
             background: #357abd;
             box-shadow: 0 2px 8px rgba(74, 144, 226, 0.3);
         }
         
         .homework-content {
             background: white;
             border-radius: 12px;
             padding: 20px;
             box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
         }
         
         .homework-list {
             min-height: 200px;
             display: flex;
             flex-wrap: wrap;
             gap: 12px;
             padding: 20px;
             align-items: flex-start;
         }
         
         .subject-group {
             background: white;
             border-radius: 12px;
             padding: 20px;
             box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
             border-left: 4px solid #ddd;
             position: relative;
             min-width: 280px;
             max-width: 400px;
             flex: 1 1 auto;
             transition: all 0.3s ease;
         }
         
         .subject-group.语文 { border-left-color: #e74c3c; }
         .subject-group.数学 { border-left-color: #3498db; }
         .subject-group.英语 { border-left-color: #2ecc71; }
         .subject-group.物理 { border-left-color: #9b59b6; }
         .subject-group.化学 { border-left-color: #f39c12; }
         .subject-group.生物 { border-left-color: #1abc9c; }
         .subject-group.历史 { border-left-color: #34495e; }
         .subject-group.地理 { border-left-color: #16a085; }
         .subject-group.政治 { border-left-color: #e67e22; }
         
         .subject-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 15px;
             padding-bottom: 10px;
             border-bottom: 1px solid #eee;
         }
         
         .subject-title {
             font-size: 18px;
             font-weight: 600;
             color: #333;
         }
         
         .subject-count {
             background: #f8f9fa;
             color: #666;
             padding: 4px 8px;
             border-radius: 12px;
             font-size: 12px;
         }
         
         .subject-edit-btn {
             background: #6c757d;
             color: white;
             border: none;
             padding: 6px 10px;
             border-radius: 4px;
             cursor: pointer;
             font-size: 12px;
             margin-left: 8px;
             transition: background-color 0.3s ease;
         }
         
         .subject-edit-btn:hover {
             background: #5a6268;
         }
         
         .settings-edit-btn {
             background: #f8f9fa;
             border: 1px solid #dee2e6;
             border-radius: 4px;
             padding: 4px 8px;
             font-size: 12px;
             color: #6c757d;
             cursor: pointer;
             transition: all 0.3s ease;
         }
         
         .settings-edit-btn:hover {
             background: #e9ecef;
             border-color: #adb5bd;
         }
         
         .empty-homework {
             display: flex;
             justify-content: center;
             align-items: center;
             height: 200px;
             color: #999;
         }
         
         .empty-homework-text {
             font-size: 18px;
             font-weight: 500;
         }
         
         /* 作业弹窗样式 */
         .homework-modal {
             max-width: 600px;
             width: 90%;
             margin: 5% auto;
             display: block;
         }
         
         .homework-items {
             margin-bottom: 10px;
         }
         
         .homework-item-input {
             display: flex;
             align-items: center;
             margin-bottom: 8px;
             gap: 8px;
         }
         
         .homework-input {
             flex: 1;
             padding: 8px 12px;
             border: 1px solid #ddd;
             border-radius: 6px;
             font-size: 14px;
         }
         
         .homework-input:focus {
             outline: none;
             border-color: #667eea;
             box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
         }
         
         .remove-item-btn {
             background: #ff4757;
             color: white;
             border: none;
             width: 30px;
             height: 30px;
             border-radius: 50%;
             cursor: pointer;
             font-size: 16px;
             display: flex;
             align-items: center;
             justify-content: center;
             transition: all 0.3s ease;
         }
         
         .remove-item-btn:hover {
             background: #ff3742;
             transform: scale(1.1);
         }
         
         .add-item-btn {
             background: #2ed573;
             color: white;
             border: none;
             width: 80%;
             height: 40px;
             border-radius: 6px;
             cursor: pointer;
             font-size: 18px;
             font-weight: bold;
             transition: all 0.3s ease;
             text-align: center;
             line-height: 40px;
             padding: 0;
             margin: 0 auto;
             box-sizing: border-box;
             display: flex;
             align-items: center;
             justify-content: center;
             text-indent: 0;
             letter-spacing: 0;
             word-spacing: 0;
         }
         
         .add-item-btn:hover {
             background: #26d467;
             transform: translateY(-1px);
         }
         
         select {
             width: 100%;
             padding: 8px 12px;
             border: 1px solid #ddd;
             border-radius: 6px;
             font-size: 14px;
             background: white;
         }
         
         select:focus {
             outline: none;
             border-color: #667eea;
             box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
         }
         
         input[type="datetime-local"] {
             width: 100%;
             padding: 8px 12px;
             border: 1px solid #ddd;
             border-radius: 6px;
             font-size: 14px;
         }
         
         input[type="datetime-local"]:focus {
             outline: none;
             border-color: #667eea;
             box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
         }
         
         /* 作业列表样式 */
         .homework-item {
             background: #f8f9fa;
             border-radius: 8px;
             padding: 15px;
             margin-bottom: 12px;
             transition: all 0.3s ease;
             position: relative;
             border: 1px solid #e9ecef;
         }
         
         .homework-item:hover {
             background: #e9ecef;
             border-color: #dee2e6;
         }
         
         .homework-item .homework-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 12px;
         }
         
         .homework-subject {
             font-size: 18px;
             font-weight: bold;
             color: #333;
         }
         
         .homework-deadline {
             font-size: 14px;
             color: #666;
             background: #f8f9fa;
             padding: 4px 8px;
             border-radius: 6px;
         }
         
         .homework-tasks {
             display: flex;
             flex-direction: column;
             gap: 8px;
         }
         
         .homework-task {
             background: #f8f9fa;
             padding: 8px 12px;
             border-radius: 6px;
             font-size: 14px;
             color: #555;
         }
         
         /* 科目颜色 */
         .homework-item[data-subject="语文"] {
             border-left-color: #ff6b6b;
         }
         
         .homework-item[data-subject="数学"] {
             border-left-color: #4ecdc4;
         }
         
         .homework-item[data-subject="英语"] {
             border-left-color: #45b7d1;
         }
         
         .homework-item[data-subject="物理"] {
             border-left-color: #96ceb4;
         }
         
         .homework-item[data-subject="化学"] {
             border-left-color: #feca57;
         }
         
         .homework-item[data-subject="生物"] {
             border-left-color: #ff9ff3;
         }
         
         .homework-item[data-subject="历史"] {
             border-left-color: #54a0ff;
         }
         
         .homework-item[data-subject="地理"] {
             border-left-color: #5f27cd;
         }
         
         .homework-item[data-subject="政治"] {
             border-left-color: #00d2d3;
         }
         
         /* 作业特殊设置样式 */
         .homework-item {
             position: relative;
         }
         
         .homework-settings-menu {
             position: absolute;
             top: 10px;
             right: 10px;
             background: white;
             border: 1px solid #ddd;
             border-radius: 8px;
             box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
             padding: 8px;
             display: none;
             z-index: 1000;
             min-width: 200px;
         }
         
         .homework-settings-menu.show {
             display: block;
         }
         
         .settings-option {
             display: flex;
             align-items: center;
             justify-content: space-between;
             padding: 8px 12px;
             margin-bottom: 4px;
             border-radius: 4px;
             cursor: pointer;
             transition: background 0.2s ease;
         }
         
         .settings-option:hover {
             background: #f8f9fa;
         }
         
         .settings-option label {
             font-size: 14px;
             color: #333;
             cursor: pointer;
             margin: 0;
         }
         
         .settings-toggle {
             position: relative;
             width: 40px;
             height: 20px;
             background: #ccc;
             border-radius: 10px;
             cursor: pointer;
             transition: background 0.3s ease;
         }
         
         .settings-toggle.active {
             background: #667eea;
         }
         
         .settings-toggle::after {
             content: '';
             position: absolute;
             top: 2px;
             left: 2px;
             width: 16px;
             height: 16px;
             background: white;
             border-radius: 50%;
             transition: transform 0.3s ease;
         }
         
         .settings-toggle.active::after {
             transform: translateX(20px);
         }
         
         .settings-divider {
             height: 1px;
             background: #eee;
             margin: 8px 0;
         }
         
         .settings-input-group {
             padding: 12px 16px;
             margin-top: 8px;
             background-color: #f8f9fa;
             border-radius: 6px;
         }
         
         .settings-input-group label {
             display: block;
             font-size: 12px;
             color: #666;
             margin-bottom: 4px;
         }
         
         .settings-input-group input {
             width: 100%;
             padding: 6px 8px;
             border: 1px solid #ddd;
             border-radius: 4px;
             font-size: 12px;
         }
         
         .homework-badges {
             display: flex;
             gap: 6px;
             margin-top: 8px;
             flex-wrap: wrap;
         }
         
         .homework-badge {
             background: #667eea;
             color: white;
             padding: 2px 8px;
             border-radius: 12px;
             font-size: 12px;
             font-weight: 500;
         }
         
         .homework-badge.classroom {
             background: #ff6b6b;
         }
         
         .homework-badge.no-submit {
             background: #feca57;
             color: #333;
         }
         
         /* 设置页面样式 */
         .settings-card {
             background: white;
             border-radius: 12px;
             box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
             margin-bottom: 20px;
             overflow: hidden;
         }
         
         .settings-card-header {
             padding: 20px;
             background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
             color: white;
         }
         
         .settings-card-header h3 {
             margin: 0 0 8px 0;
             font-size: 18px;
             font-weight: 600;
         }
         
         .settings-card-header p {
             margin: 0;
             font-size: 14px;
             opacity: 0.9;
         }
         
         .settings-card-content {
             padding: 20px;
         }
         
         .settings-row {
             margin-bottom: 20px;
         }
         
         .settings-row label {
             display: block;
             margin-bottom: 8px;
             font-weight: 500;
             color: #333;
             font-size: 14px;
         }
         
         .settings-row input,
         .settings-row select,
         .settings-row textarea {
             width: 100%;
             padding: 12px;
             border: 2px solid #e9ecef;
             border-radius: 8px;
             font-size: 14px;
             transition: border-color 0.3s ease;
             box-sizing: border-box;
         }
         
         .settings-row input:focus,
         .settings-row select:focus,
         .settings-row textarea:focus {
             outline: none;
             border-color: #667eea;
         }
         
         .settings-row textarea {
             resize: vertical;
             min-height: 80px;
         }
         
         .settings-actions {
             display: flex;
             gap: 12px;
             margin-top: 30px;
             padding-top: 20px;
             border-top: 1px solid #e9ecef;
         }
         
         .settings-actions .btn {
             padding: 12px 24px;
             border-radius: 8px;
             font-weight: 500;
             cursor: pointer;
             border: none;
             transition: all 0.3s ease;
         }
         
         .settings-actions .btn-primary {
             background: #667eea;
             color: white;
         }
         
         .settings-actions .btn-primary:hover {
             background: #5a6fd8;
             transform: translateY(-1px);
         }
         
         .settings-actions .btn-secondary {
             background: #6c757d;
             color: white;
         }
         
         .settings-actions .btn-secondary:hover {
             background: #5a6268;
             transform: translateY(-1px);
         }

         .homework-settings-btn {
             position: absolute;
             top: 8px;
             right: 8px;
             background: rgba(0, 0, 0, 0.1);
             border: none;
             width: 24px;
             height: 24px;
             border-radius: 50%;
             cursor: pointer;
             display: none;
             align-items: center;
             justify-content: center;
             font-size: 12px;
             transition: all 0.2s ease;
         }
         
         .homework-item:hover .homework-settings-btn {
             display: flex;
         }
         
         .homework-settings-btn:hover {
             background: rgba(0, 0, 0, 0.2);
         }
         
         .homework-edit-btn {
             background: none;
             border: none;
             font-size: 14px;
             cursor: pointer;
             color: #666;
             padding: 4px 8px;
             border-radius: 4px;
             transition: all 0.3s ease;
             margin-left: 10px;
         }
         
         .homework-edit-btn:hover {
             background-color: #f0f0f0;
             color: #333;
         }
         
         /* 响应式设计 */
         @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.show {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .page-title {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- Toast容器 -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- SVG图标定义 -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;" width="0" height="0">
      <!-- 电脑图标 -->
      <symbol id="computer" viewBox="0 0 24 24">
        <path fill="currentColor" d="M4 2h16a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2h-5l1 2v1H8v-1l1-2H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm0 2v11h16V4H4z"/>
      </symbol>
      
      <!-- 日历图标 -->
      <symbol id="calendar" viewBox="0 0 24 24">
        <path fill="currentColor" d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
      </symbol>
      
      <!-- 设置图标 -->
      <symbol id="settings" viewBox="0 0 24 24">
        <path fill="currentColor" d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5a3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97c0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1c0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/>
      </symbol>
      
      <!-- 用户组图标 -->
      <symbol id="users" viewBox="0 0 24 24">
        <path fill="currentColor" d="M16 4c0-1.11.89-2 2-2s2 .89 2 2s-.89 2-2 2s-2-.89-2-2M4 4c0-1.11.89-2 2-2s2 .89 2 2s-.89 2-2 2s-2-.89-2-2m9 9c-1.11 0-2-.89-2-2s.89-2 2-2s2 .89 2 2s-.89 2-2 2m3-7v7h2.5l-2.54 7.63A1.5 1.5 0 0 1 14.5 22H9.5c-.68 0-1.27-.45-1.46-1.11L5.5 13H8V6c0-.83.67-1.5 1.5-1.5S11 5.17 11 6v2h2V6c0-.83.67-1.5 1.5-1.5S16 5.17 16 6Z"/>
      </symbol>
      
      <!-- 书本图标 -->
      <symbol id="book" viewBox="0 0 24 24">
        <path fill="currentColor" d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"/>
      </symbol>
      
      <!-- 举手图标 -->
      <symbol id="hand" viewBox="0 0 24 24">
        <path fill="currentColor" d="M23 5.5V20c0 2.2-1.8 4-4 4h-7.3c-1.08 0-2.1-.43-2.85-1.19L1 14.83s1.26-1.23 1.3-1.25c.22-.19.49-.29.79-.29c.22 0 .42.06.6.16L8 16.5V6.5C8 5.67 8.67 5 9.5 5S11 5.67 11 6.5V10h1V3.5C12 2.67 12.67 2 13.5 2S15 2.67 15 3.5V10h1V5.5C16 4.67 16.67 4 17.5 4S19 4.67 19 5.5V10h1V6.5C20 5.67 20.67 5 21.5 5S23 5.67 23 6.5V5.5z"/>
      </symbol>
      
      <!-- 工具图标 -->
      <symbol id="tools" viewBox="0 0 24 24">
        <path fill="currentColor" d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9c-2-2-5-2.4-7.4-1.3L9 6L6 9L1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/>
      </symbol>
      
      <!-- 扫帚图标 -->
      <symbol id="broom" viewBox="0 0 24 24">
        <path fill="currentColor" d="M19.36 2.72L20.78 4.14l-1.42 1.42L18.94 5.14L19.36 2.72M12 9L17 4l1.41 1.41L13.41 10.41L12 9M11 10L9.59 11.41l7.07 7.07L18.07 17L11 10M8.18 12.82L5.11 15.89l-1.42-1.42L6.76 11.4L8.18 12.82M2.81 15.89l1.42 1.42l-1.06 1.06c-.39.39-.39 1.02 0 1.41l.71.71c.39.39 1.02.39 1.41 0L6.35 19.43l1.42 1.42L6.71 21.91c-1.17 1.17-3.07 1.17-4.24 0l-.71-.71c-1.17-1.17-1.17-3.07 0-4.24L2.81 15.89Z"/>
      </symbol>
      
      <!-- 成功/勾选图标 -->
      <symbol id="check" viewBox="0 0 24 24">
        <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
      </symbol>
      
      <!-- 错误/叉号图标 -->
      <symbol id="close" viewBox="0 0 24 24">
        <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
      </symbol>
      
      <!-- 图钉/置顶图标 -->
       <symbol id="pin" viewBox="0 0 24 24">
         <path fill="currentColor" d="M16 12V4h1V2H7v2h1v8l-2 2v2h5.2l.8 6h1l.8-6H19v-2l-2-2z"/>
       </symbol>
       
       <!-- 编辑图标 -->
       <symbol id="edit" viewBox="0 0 24 24">
         <path fill="currentColor" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83l3.75 3.75l1.83-1.83z"/>
       </symbol>
       
       <!-- 复制图标 -->
       <symbol id="copy" viewBox="0 0 24 24">
         <path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
       </symbol>
       
       <!-- 粘贴图标 -->
       <symbol id="paste" viewBox="0 0 24 24">
         <path fill="currentColor" d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"/>
       </symbol>
       
       <!-- 删除图标 -->
       <symbol id="delete" viewBox="0 0 24 24">
         <path fill="currentColor" d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
       </symbol>
       
       <!-- 箭头图标 -->
       <symbol id="arrow-up" viewBox="0 0 24 24">
         <path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
       </symbol>
       
       <symbol id="arrow-down" viewBox="0 0 24 24">
         <path fill="currentColor" d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
       </symbol>
       
       <symbol id="arrow-left" viewBox="0 0 24 24">
         <path fill="currentColor" d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"/>
       </symbol>
       
       <symbol id="arrow-right" viewBox="0 0 24 24">
         <path fill="currentColor" d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
       </symbol>
       
       <!-- 加号图标 -->
       <symbol id="plus" viewBox="0 0 24 24">
         <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
       </symbol>

       <symbol id="settings" viewBox="0 0 24 24">
         <path fill="currentColor" d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/>
       </symbol>
     </svg>
    
    <div class="page-container">
        <!-- 侧边栏 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">班级管理系统</div>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link active" data-page="console">
                        <svg class="nav-icon"><use href="#computer"></use></svg>
                        <span class="nav-text">控制台</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="homework">
                        <svg class="nav-icon"><use href="#book"></use></svg>
                        <span class="nav-text">作业</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="roll-call">
                        <svg class="nav-icon"><use href="#hand"></use></svg>
                        <span class="nav-text">点名</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="tools">
                        <svg class="nav-icon"><use href="#tools"></use></svg>
                        <span class="nav-text">小工具</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="schedule">
                        <svg class="nav-icon"><use href="#calendar"></use></svg>
                        <span class="nav-text">课程表</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="duty">
                        <svg class="nav-icon"><use href="#broom"></use></svg>
                        <span class="nav-text">值日生表</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="settings">
                        <svg class="nav-icon"><use href="#settings"></use></svg>
                        <span class="nav-text">设置</span>
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- 主内容区域 -->
        <div class="main-content">
            <div class="content-area">
                <!-- 控制台内容 -->
                <div class="page" id="console" style="display: block;">
                    <div class="page-title">控制台</div>
                    
                    <!-- 班级信息卡片 -->
                    <div class="class-info-card" id="classInfoCard" style="display: none;">
                        <div class="class-info-header">
                            <h3>班级信息</h3>
                        </div>
                        <div class="class-info-content">
                            <div class="class-info-item">
                                <span class="class-info-label">班级名称:</span>
                                <span class="class-info-value" id="consoleClassName">未设置</span>
                            </div>
                            <div class="class-info-item">
                                <span class="class-info-label">年级:</span>
                                <span class="class-info-value" id="consoleClassGrade">未设置</span>
                            </div>
                            <div class="class-info-item">
                                <span class="class-info-label">班主任:</span>
                                <span class="class-info-value" id="consoleClassTeacher">未设置</span>
                            </div>
                            <div class="class-info-item">
                                <span class="class-info-label">班级口号:</span>
                                <span class="class-info-value" id="consoleClassSlogan">未设置</span>
                            </div>
                            <div class="class-info-item">
                                <span class="class-info-label">更新时间:</span>
                                <span class="class-info-value" id="consoleClassUpdateTime">未设置</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 统计卡片 -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <svg class="stat-icon"><use href="#users"></use></svg>
                                <span class="stat-title">班级人数</span>
                            </div>
                            <div class="stat-value">0</div>
                            <div class="stat-desc">总人数</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <svg class="stat-icon"><use href="#check"></use></svg>
                                <span class="stat-title">到班人数</span>
                            </div>
                            <div class="stat-value">0</div>
                            <div class="stat-desc">已到班</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <svg class="stat-icon"><use href="#check"></use></svg>
                                <span class="stat-title">请假人数</span>
                            </div>
                            <div class="stat-value">0</div>
                            <div class="stat-desc">已请假</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <svg class="stat-icon"><use href="#close"></use></svg>
                                <span class="stat-title">无故缺席</span>
                            </div>
                            <div class="stat-value">0</div>
                            <div class="stat-desc">未到班</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <svg class="stat-icon"><use href="#book"></use></svg>
                                <span class="stat-title">当前课程</span>
                            </div>
                            <div class="stat-value">--</div>
                            <div class="stat-desc">暂无数据</div>
                        </div>
                    </div>
                    
                    <!-- 班级通知 -->
                    <div class="notice-section">
                        <div class="notice-header">
                            <div class="notice-title">
                                <svg class="stat-icon"><use href="assets/icons.svg#notification"></use></svg>
                                <span>班级通知</span>
                            </div>
                            <button class="add-notice-btn" onclick="showAddNoticeModal()" title="添加通知"><svg class="btn-icon"><use href="#plus"></use></svg></button>
                        </div>
                        
                        <div class="notice-list" id="noticeList">
                            <div class="empty-notice">
                                <div class="empty-notice-text">暂时还没有班级通知，可点击卡片右上角创建</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 默认内容（其他页面） -->
                <div class="default-content" id="defaultContent" style="display: none;">
                    <div class="page-title" id="pageTitle">控制台</div>
                </div>
                
                <!-- 作业页面内容 -->
                <div id="homework" class="page" style="display: none;">
                    <div class="homework-header">
                        <h2>作业管理</h2>
                        <button class="add-homework-btn" onclick="showAddHomeworkModal()">+ 添加作业</button>
                    </div>
                    <div class="homework-content">
                        <div id="homeworkList" class="homework-list">
                            <!-- 测试作业项目 -->
                            <div class="homework-item">
                                <div class="homework-header">
                                    <div class="homework-subject">数学</div>
                                    <div class="homework-deadline">截止时间: 2024-01-20</div>
                                    <button class="homework-settings-btn" onclick="toggleHomeworkSettings(this)"><svg class="btn-icon"><use href="#settings"></use></svg></button>
                                </div>
                                <div class="homework-content">
                                    <div class="homework-items">
                                        <div class="homework-item-detail">
                                            <span class="homework-item-text">完成课本第45页练习题1-10</span>
                                            <div class="homework-item-actions">
                                                <button class="homework-edit-btn" onclick="editHomeworkItem(this)" title="编辑"><svg class="btn-icon"><use href="#edit"></use></svg></button>
                                                <button class="homework-delete-btn" onclick="deleteHomeworkItem(this)" title="删除"><svg class="btn-icon"><use href="#delete"></use></svg></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="homework-settings-menu" style="display: none;">
                                    <button onclick="editHomework(this)">编辑作业</button>
                                    <button onclick="deleteHomework(this)">删除作业</button>
                                    <button onclick="duplicateHomework(this)">复制作业</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 点名页面内容 -->
                <div id="roll-call" class="page" style="display: none;">
                    <div class="page-title">点名</div>
                    <div class="page-content">
                        <p>点名功能正在开发中...</p>
                    </div>
                </div>

                <!-- 小工具页面内容 -->
                <div id="tools" class="page" style="display: none;">
                    <div class="page-title">小工具</div>
                    <div class="page-content">
                        <p>小工具功能正在开发中...</p>
                    </div>
                </div>

                <!-- 值日生表页面内容 -->
                <div id="duty" class="page" style="display: none;">
                    <div class="page-title">值日生表</div>
                    <div class="page-content">
                        <p>值日生表功能正在开发中...</p>
                    </div>
                </div>

                <!-- 课程表页面内容 -->
                <div id="schedule" class="page" style="display: none;">
                    <div class="page-title">课程表</div>
                    
                    <!-- 编辑控制按钮 -->
                    <div class="edit-control-card">
                        <button id="editModeBtn" class="btn btn-primary" onclick="toggleEditMode()" title="进入编辑模式">编辑</button>
                        <div id="editControls" class="edit-controls" style="display: none;">
                            <button class="btn btn-success" onclick="saveSchedule()" title="保存修改">保存</button>
                            <button class="btn btn-secondary" onclick="cancelEdit()" title="撤销修改">撤销</button>
                            <button class="btn btn-danger" onclick="exitEditMode()" title="退出编辑模式">退出编辑</button>
                        </div>
                    </div>
                    
                    <!-- 课程表工具栏卡片 -->
                    <div id="scheduleToolbar" class="schedule-toolbar-card" style="display: none;">
                        <div class="schedule-toolbar">
                            <button class="btn btn-primary" onclick="addTimeSlot()" title="添加新的时间段">添加时间段</button>
                            <button class="btn btn-secondary" onclick="addWeekDay()" title="添加新的星期列">添加星期</button>
                            <button class="btn btn-warning" onclick="showTimeSlotManager()" title="管理时间段设置">时间管理</button>
                            <button class="btn btn-success" onclick="showBatchAddModal()" title="一键批量添加课程到多个时间段">批量添加</button>
                            <button class="btn btn-info" onclick="document.getElementById('fileInput').click()" title="从CSV文件导入课程表数据">导入</button>
                            <button class="btn btn-secondary" onclick="exportSchedule()" title="导出课程表为CSV文件">导出</button>
                            <button class="btn btn-danger" onclick="clearSchedule()" title="清空所有课程表数据">清空</button>
                            <input type="file" id="fileInput" class="file-input" accept=".csv,.xlsx,.xls" onchange="importSchedule(event)" style="display: none;">
                        </div>
                    </div>
                    
                    <div class="schedule-messages">
                        <div class="success-message" id="successMessage" style="display: none;"></div>
                        <div class="error-message" id="errorMessage" style="display: none;"></div>
                        <div class="loading" id="loading" style="display: none;">正在处理中...</div>
                    </div>

                    <!-- 课程表内容卡片 -->
                    <div class="schedule-content-card">
                        <table class="schedule-table" id="scheduleTable">
                            <thead>
                                <tr>
                                    <th>时间</th>
                                    <th>周一</th>
                                    <th>周二</th>
                                    <th>周三</th>
                                    <th>周四</th>
                                    <th>周五</th>
                                    <th>周六</th>
                                    <th>周日</th>
                                </tr>
                            </thead>
                            <tbody id="scheduleBody">
                                <!-- 课程表内容将通过JavaScript生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 设置页面内容 -->
                <div id="settings" class="page" style="display: none; background: white; min-height: 500px; padding: 20px;">
                    <div class="page-title" style="color: red; font-size: 24px; font-weight: bold;">设置页面测试</div>
                    <div style="background: yellow; padding: 10px; margin: 10px 0; border: 2px solid red;">
                        <h2>如果您能看到这个黄色框，说明设置页面内容是存在的！</h2>
                    </div>
                    
                    <!-- 班级信息配置 -->
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3>班级信息配置</h3>
                            <p>设置班级的基本信息</p>
                        </div>
                        <div class="settings-card-content">
                            <div class="settings-row">
                                <label for="className">班级名称</label>
                                <input type="text" id="className" placeholder="请输入班级名称">
                            </div>
                            <div class="settings-row">
                                <label for="classGrade">年级</label>
                                <select id="classGrade">
                                    <option value="">请选择年级</option>
                                    <option value="高一">高一</option>
                                    <option value="高二">高二</option>
                                    <option value="高三">高三</option>
                                </select>
                            </div>
                            <div class="settings-row">
                                <label for="classTeacher">班主任</label>
                                <input type="text" id="classTeacher" placeholder="请输入班主任姓名">
                            </div>
                            <div class="settings-row">
                                <label for="classSlogan">班级口号</label>
                                <textarea id="classSlogan" placeholder="请输入班级口号" rows="3"></textarea>
                            </div>
                            <div class="settings-actions">
                                <button class="btn btn-primary" onclick="saveClassInfo()">保存班级信息</button>
                                <button class="btn btn-secondary" onclick="resetClassInfo()">重置</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 时间段管理模态框 -->
    <div id="timeSlotModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>时间段管理</h3>
                <span class="close" onclick="closeTimeSlotModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="time-slot-list" id="timeSlotList">
                    <!-- 时间段列表 -->
                </div>
                <div class="add-time-slot">
                    <h4>添加新时间段</h4>
                    <div class="form-group">
                        <label>时间段名称:</label>
                        <input type="text" id="timeSlotName" placeholder="例如：第1节课、课间操、午休">
                    </div>
                    <div class="form-group">
                        <label>开始时间:</label>
                        <input type="time" id="startTime">
                    </div>
                    <div class="form-group">
                        <label>结束时间:</label>
                        <input type="time" id="endTime">
                    </div>
                    <div class="form-group">
                        <label>类型:</label>
                        <select id="slotType">
                            <option value="class">课程</option>
                            <option value="break">课间</option>
                            <option value="lunch">午休</option>
                            <option value="activity">活动</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="addNewTimeSlot()">添加时间段</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 右键菜单 -->
    <div id="contextMenu" class="context-menu" style="display: none;">
        <div class="context-menu-item" onclick="copyCell()"><svg class="context-menu-icon"><use href="#copy"></use></svg>复制</div>
        <div class="context-menu-item" onclick="pasteCell()"><svg class="context-menu-icon"><use href="#paste"></use></svg>粘贴</div>
        <div class="context-menu-item" onclick="clearCell()"><svg class="context-menu-icon"><use href="#delete"></use></svg>清空</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" onclick="insertRowAbove()"><svg class="context-menu-icon"><use href="#arrow-up"></use></svg>上方插入行</div>
        <div class="context-menu-item" onclick="insertRowBelow()"><svg class="context-menu-icon"><use href="#arrow-down"></use></svg>下方插入行</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" onclick="insertColumnLeft()"><svg class="context-menu-icon"><use href="#arrow-left"></use></svg>左侧插入列</div>
        <div class="context-menu-item" onclick="insertColumnRight()"><svg class="context-menu-icon"><use href="#arrow-right"></use></svg>右侧插入列</div>
    </div>

    <!-- 自定义确认弹窗 -->
    <div id="confirmModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 id="confirmTitle">确认操作</h3>
                <span class="close" onclick="closeConfirmModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">确定要执行此操作吗？</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeConfirmModal()">取消</button>
                <button class="btn btn-danger" id="confirmBtn" onclick="confirmAction()">确定</button>
            </div>
        </div>
    </div>

    <!-- 自定义输入弹窗 -->
    <div id="promptModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 id="promptTitle">输入信息</h3>
                <span class="close" onclick="closePromptModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p id="promptMessage">请输入：</p>
                <input type="text" id="promptInput" class="form-control" placeholder="">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePromptModal()">取消</button>
                <button class="btn btn-primary" onclick="submitPrompt()">确定</button>
            </div>
        </div>
    </div>

    <!-- 批量添加模态框 -->
    <div id="batchAddModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>批量添加课程</h3>
                <span class="close" onclick="closeBatchAddModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="batchCourseName">课程名称</label>
                    <input type="text" id="batchCourseName" class="form-control" placeholder="请输入课程名称（如：午休、早读）">
                </div>
                <div class="form-group">
                    <label for="batchTimeSlot">选择时间段</label>
                    <select id="batchTimeSlot" class="form-control">
                        <option value="">请选择时间段</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>选择星期</label>
                    <div class="week-selector" id="weekSelector">
                        <!-- 动态生成星期选择器 -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeBatchAddModal()">取消</button>
                <button class="btn btn-primary" onclick="confirmBatchAdd()">批量添加</button>
            </div>
        </div>
    </div>

    <!-- 新建通知弹窗 -->
    <div class="modal" id="addNoticeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>新建班级通知</h3>
                <span class="close" onclick="closeAddNoticeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="noticeContent">通知内容：</label>
                    <textarea id="noticeContent" placeholder="请输入通知内容..." rows="4"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeAddNoticeModal()">取消</button>
                <button class="btn btn-confirm" onclick="addNotice()">确定</button>
            </div>
        </div>
    </div>

    <!-- 添加作业弹窗 -->
    <div id="addHomeworkModal" class="modal">
        <div class="modal-content homework-modal">
            <div class="modal-header">
                <h3>添加作业</h3>
                <span class="close" onclick="closeAddHomeworkModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="homeworkSubject">科目：</label>
                    <select id="homeworkSubject">
                        <option value="">请选择科目</option>
                        <option value="语文">语文</option>
                        <option value="数学">数学</option>
                        <option value="英语">英语</option>
                        <option value="物理">物理</option>
                        <option value="化学">化学</option>
                        <option value="生物">生物</option>
                        <option value="历史">历史</option>
                        <option value="地理">地理</option>
                        <option value="政治">政治</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="homeworkDeadline">结束时间：</label>
                    <input type="datetime-local" id="homeworkDeadline">
                </div>
                <div class="form-group">
                    <label>作业内容：</label>
                    <div id="homeworkItems" class="homework-items">
                        <div class="homework-item-input">
                            <input type="text" placeholder="请输入作业内容..." class="homework-input">
                            <button type="button" class="remove-item-btn" onclick="removeHomeworkItem(this)" style="display: none;">-</button>
                        </div>
                    </div>
                    <button type="button" class="add-item-btn" onclick="addHomeworkItem()">添加作业</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeAddHomeworkModal()">取消</button>
                <button class="btn btn-confirm" onclick="confirmAddHomework()">确定</button>
            </div>
        </div>
    </div>

    <!-- 编辑作业弹窗 -->
    <div id="editHomeworkModal" class="modal">
        <div class="modal-content homework-modal">
            <div class="modal-header">
                <h3>编辑作业</h3>
                <span class="close" onclick="closeEditHomeworkModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="editHomeworkSubject">科目：</label>
                    <select id="editHomeworkSubject">
                        <option value="">请选择科目</option>
                        <option value="语文">语文</option>
                        <option value="数学">数学</option>
                        <option value="英语">英语</option>
                        <option value="物理">物理</option>
                        <option value="化学">化学</option>
                        <option value="生物">生物</option>
                        <option value="历史">历史</option>
                        <option value="地理">地理</option>
                        <option value="政治">政治</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editHomeworkDeadline">结束时间：</label>
                    <input type="datetime-local" id="editHomeworkDeadline">
                </div>
                <div class="form-group">
                    <label>作业内容：</label>
                    <div id="editHomeworkItems" class="homework-items">
                        <!-- 动态生成的作业项 -->
                    </div>
                    <button type="button" class="add-item-btn" onclick="addEditHomeworkItem()">添加作业</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeEditHomeworkModal()">取消</button>
                <button class="btn btn-danger" onclick="deleteSubject()" id="deleteSubjectBtn" style="display: none; background-color: #e74c3c; color: white; margin-right: auto;">删除学科</button>
                <button class="btn btn-confirm" onclick="confirmEditHomework()">确定</button>
            </div>
        </div>
    </div>

    <script>
        // 页面切换功能
        const navLinks = document.querySelectorAll('.nav-link');
        
        const pageTitles = {
            'console': '控制台',
            'homework': '作业',
            'attendance': '点名',
            'tools': '小工具',
            'settings': '设置',
            'schedule': '课程表',
            'duty': '值日生表'
        };
        
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                const pageId = this.getAttribute('data-page');
                
                // 移除所有导航项的激活状态
                navLinks.forEach(nav => nav.classList.remove('active'));
                
                // 添加当前导航项的激活状态
                this.classList.add('active');
                
                // 切换页面内容
                switchPage(pageId);
            });
        });
        
        function switchPage(page) {
            console.log('switchPage 被调用，页面ID:', page);
            const consoleContent = document.getElementById('consoleContent');
            const defaultContent = document.getElementById('defaultContent');
            const homeworkContent = document.getElementById('homework');
            const scheduleContent = document.getElementById('schedule');
            const settingsContent = document.getElementById('settings');
            const pageTitle = document.getElementById('pageTitle');
            
            console.log('找到的元素:', {
                consoleContent: !!consoleContent,
                defaultContent: !!defaultContent,
                homeworkContent: !!homeworkContent,
                scheduleContent: !!scheduleContent,
                settingsContent: !!settingsContent,
                pageTitle: !!pageTitle
            });
            
            // 隐藏所有页面内容
            consoleContent.style.display = 'none';
            defaultContent.style.display = 'none';
            if (homeworkContent) homeworkContent.style.display = 'none';
            if (scheduleContent) scheduleContent.style.display = 'none';
            if (settingsContent) settingsContent.style.display = 'none';
            
            if (page === 'console') {
                // 显示控制台详细内容
                consoleContent.style.display = 'block';
            } else if (page === 'homework') {
                // 显示作业页面
                if (homeworkContent) {
                    homeworkContent.style.display = 'block';
                }
            } else if (page === 'schedule') {
                // 显示课程表页面
                if (scheduleContent) {
                    scheduleContent.style.display = 'block';
                    // 初始化课程表
                    if (typeof initSchedule === 'function') {
                        initSchedule();
                    }
                }
            } else if (page === 'settings') {
                // 显示设置页面
                console.log('准备显示设置页面，settingsContent存在:', !!settingsContent);
                if (settingsContent) {
                    settingsContent.style.display = 'block';
                    console.log('设置页面已设置为显示，当前display值:', settingsContent.style.display);
                    // 初始化设置页面
                    if (typeof loadClassInfo === 'function') {
                        loadClassInfo();
                    }
                } else {
                    console.error('settingsContent 元素未找到！');
                }
            } else {
                // 显示其他页面的简单内容
                defaultContent.style.display = 'flex';
                pageTitle.textContent = pageTitles[page] || '控制台';
            }
        }
        

        
        // 显示新建通知弹窗
        function showAddNoticeModal() {
            const modal = document.getElementById('addNoticeModal');
            modal.style.display = 'block';
        }
        
        // 关闭新建通知弹窗
        function closeAddNoticeModal() {
            const modal = document.getElementById('addNoticeModal');
            const textarea = document.getElementById('noticeContent');
            modal.style.display = 'none';
            textarea.value = ''; // 清空输入框
        }
        
        // 添加新通知
         function addNotice() {
             const textarea = document.getElementById('noticeContent');
             const content = textarea.value.trim();
             
             if (!content) {
                 showToast('请输入通知内容', 'warning');
                 return;
             }
             
             const noticeList = document.getElementById('noticeList');
             const emptyNotice = noticeList.querySelector('.empty-notice');
             
             // 如果是第一条通知，移除空状态
             if (emptyNotice) {
                 emptyNotice.remove();
             }
             
             // 创建新通知元素
             const noticeItem = document.createElement('div');
             noticeItem.className = 'notice-item';
             
             const now = new Date();
             const timeStr = now.getFullYear() + '-' + 
                           String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                           String(now.getDate()).padStart(2, '0') + ' ' + 
                           String(now.getHours()).padStart(2, '0') + ':' + 
                           String(now.getMinutes()).padStart(2, '0');
             
             const noticeId = 'notice_' + Date.now();
             noticeItem.setAttribute('data-notice-id', noticeId);
             
             noticeItem.innerHTML = `
                 <div class="notice-content">${content}</div>
                 <div class="notice-time">${timeStr}</div>
                 <div class="notice-actions">
                     <button class="pin-btn" onclick="togglePin('${noticeId}')" title="置顶通知"><svg class="btn-icon"><use href="#pin"></use></svg></button>
                 </div>
             `;
             
             // 将新通知插入到非置顶通知的顶部
             const pinnedNotices = noticeList.querySelectorAll('.notice-item.pinned');
             if (pinnedNotices.length > 0) {
                 const lastPinned = pinnedNotices[pinnedNotices.length - 1];
                 noticeList.insertBefore(noticeItem, lastPinned.nextSibling);
             } else {
                 noticeList.insertBefore(noticeItem, noticeList.firstChild);
             }
             
             // 关闭弹窗
             closeAddNoticeModal();
         }
         
         // 切换置顶状态
         function togglePin(noticeId) {
             const noticeItem = document.querySelector(`[data-notice-id="${noticeId}"]`);
             const pinBtn = noticeItem.querySelector('.pin-btn');
             const noticeList = document.getElementById('noticeList');
             
             if (noticeItem.classList.contains('pinned')) {
                 // 取消置顶
                 noticeItem.classList.remove('pinned');
                 pinBtn.classList.remove('pinned');
                 pinBtn.title = '置顶通知';
                 
                 // 移除置顶标签
                 const pinnedLabel = noticeItem.querySelector('.pinned-label');
                 if (pinnedLabel) {
                     pinnedLabel.remove();
                 }
                 
                 // 移动到非置顶区域的顶部
                 const pinnedNotices = noticeList.querySelectorAll('.notice-item.pinned');
                 if (pinnedNotices.length > 0) {
                     const lastPinned = pinnedNotices[pinnedNotices.length - 1];
                     noticeList.insertBefore(noticeItem, lastPinned.nextSibling);
                 } else {
                     noticeList.insertBefore(noticeItem, noticeList.firstChild);
                 }
             } else {
                 // 设置置顶
                 noticeItem.classList.add('pinned');
                 pinBtn.classList.add('pinned');
                 pinBtn.title = '取消置顶';
                 
                 // 添加置顶标签
                 const noticeTime = noticeItem.querySelector('.notice-time');
                 const pinnedLabel = document.createElement('span');
                 pinnedLabel.className = 'pinned-label';
                 pinnedLabel.textContent = '[置顶]';
                 noticeTime.appendChild(pinnedLabel);
                 
                 // 移动到置顶区域的底部
                 const pinnedNotices = noticeList.querySelectorAll('.notice-item.pinned');
                 if (pinnedNotices.length > 1) {
                     const lastPinned = pinnedNotices[pinnedNotices.length - 2];
                     noticeList.insertBefore(noticeItem, lastPinned.nextSibling);
                 } else {
                     noticeList.insertBefore(noticeItem, noticeList.firstChild);
                 }
             }
         }
        
        // 显示添加作业弹窗
        function showAddHomeworkModal() {
            document.getElementById('addHomeworkModal').style.display = 'block';
            // 设置默认时间为明天
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(23, 59);
            document.getElementById('homeworkDeadline').value = tomorrow.toISOString().slice(0, 16);
        }
        
        // 关闭添加作业弹窗
        function closeAddHomeworkModal() {
            console.log('closeAddHomeworkModal 开始执行');
            const modal = document.getElementById('addHomeworkModal');
            console.log('模态框元素:', modal);
            console.log('模态框当前显示状态:', modal ? modal.style.display : '未找到模态框');
            
            modal.style.display = 'none';
            console.log('模态框显示状态已设置为 none');
            
            // 重置表单
            document.getElementById('homeworkSubject').value = '';
            document.getElementById('homeworkDeadline').value = '';
            const homeworkItems = document.getElementById('homeworkItems');
            homeworkItems.innerHTML = `
                <div class="homework-item-input">
                    <input type="text" placeholder="请输入作业内容..." class="homework-input">
                    <button type="button" class="remove-item-btn" onclick="removeHomeworkItem(this)" style="display: none;">-</button>
                </div>
            `;
            console.log('表单已重置');
            console.log('closeAddHomeworkModal 执行完成');
        }
        
        // 添加作业项
        function addHomeworkItem() {
            const homeworkItems = document.getElementById('homeworkItems');
            const newItem = document.createElement('div');
            newItem.className = 'homework-item-input';
            newItem.innerHTML = `
                <input type="text" placeholder="请输入作业内容..." class="homework-input">
                <button type="button" class="remove-item-btn" onclick="removeHomeworkItem(this)">-</button>
            `;
            homeworkItems.appendChild(newItem);
            
            // 显示所有删除按钮
            const removeButtons = homeworkItems.querySelectorAll('.remove-item-btn');
            removeButtons.forEach(btn => btn.style.display = 'flex');
        }
        
        // 删除作业项
        function removeHomeworkItem(button) {
            console.log('removeHomeworkItem 开始执行');
            const homeworkItems = document.getElementById('homeworkItems');
            const item = button.parentElement;
            item.remove();
            console.log('已从DOM中删除作业项');
            
            // 如果只剩一项，隐藏删除按钮
            const remainingItems = homeworkItems.querySelectorAll('.homework-item-input');
            if (remainingItems.length === 1) {
                remainingItems[0].querySelector('.remove-item-btn').style.display = 'none';
                console.log('隐藏最后一个删除按钮');
            }
            
            // 保存数据到本地存储
            setTimeout(() => {
                saveDataToLocalStorage();
                console.log('删除作业项后保存数据');
            }, 100);
        }
        
        // 确认添加作业
        function confirmAddHomework() {
            console.log('confirmAddHomework 开始执行');
            const subject = document.getElementById('homeworkSubject').value;
            const deadline = document.getElementById('homeworkDeadline').value;
            const inputs = document.querySelectorAll('.homework-input');
            
            console.log('科目:', subject, '截止时间:', deadline);
            
            if (!subject) {
                showToast('请选择科目', 'warning');
                return;
            }
            
            // 检查科目是否已存在
            const subjectExists = isSubjectExists(subject);
            console.log('科目是否已存在:', subjectExists);
            if (subjectExists) {
                showToast('该科目已存在，请选择其他科目或编辑现有作业', 'warning');
                return;
            }
            
            if (!deadline) {
                showToast('请选择结束时间', 'warning');
                return;
            }
            
            const items = [];
            inputs.forEach(input => {
                if (input.value.trim()) {
                    items.push(input.value.trim());
                }
            });
            
            console.log('作业项目:', items);
            
            if (items.length === 0) {
                showToast('请至少添加一项作业内容', 'warning');
                return;
            }
            
            console.log('开始添加作业到列表');
            // 添加作业到列表
            addHomeworkToList(subject, deadline, items);
            
            console.log('开始关闭弹窗');
            closeAddHomeworkModal();
            
            console.log('开始重新布局和保存数据');
            // 重新布局瀑布流
            setTimeout(layoutMasonry, 100);
            // 保存数据
            setTimeout(saveDataToLocalStorage, 150);
            
            console.log('confirmAddHomework 执行完成');
        }
        
        // 添加作业到列表
        function addHomeworkToList(subject, deadline, items) {
            console.log('addHomeworkToList 开始执行，科目:', subject, '截止时间:', deadline, '作业项:', items);
            const homeworkList = document.getElementById('homeworkList');
            const emptyHomework = document.querySelector('.empty-homework');
            
            // 如果是第一个作业，移除空状态
            if (emptyHomework) {
                emptyHomework.remove();
                console.log('移除空状态');
            }
            
            // 检查是否已存在该科目的分组
            let subjectGroup = null;
            const subjectGroups = document.querySelectorAll('.subject-group');
            console.log('查找现有科目组，总数:', subjectGroups.length);
            
            for (let group of subjectGroups) {
                const subjectTitle = group.querySelector('.subject-title');
                if (subjectTitle && subjectTitle.textContent === subject) {
                    subjectGroup = group;
                    console.log('找到现有科目组:', subject);
                    break;
                }
            }
            
            if (!subjectGroup) {
                console.log('创建新的科目分组:', subject);
                // 创建新的科目分组
                subjectGroup = document.createElement('div');
                subjectGroup.className = `subject-group ${subject}`;
                subjectGroup.innerHTML = `
                    <div class="subject-header">
                        <div class="subject-title">${subject}</div>
                        <div style="display: flex; align-items: center;">
                            <div class="subject-count">0 项作业</div>
                            <button class="subject-edit-btn" onclick="editSubject(this)" title="编辑学科">编辑学科</button>
                        </div>
                    </div>
                    <div class="subject-homework-list"></div>
                `;
                homeworkList.appendChild(subjectGroup);
                console.log('新科目组已添加到DOM');
            }
            
            const subjectHomeworkList = subjectGroup.querySelector('.subject-homework-list');
            const deadlineDate = new Date(deadline);
            // 格式化为友好的时间显示
            const year = deadlineDate.getFullYear();
            const month = deadlineDate.getMonth() + 1;
            const day = deadlineDate.getDate();
            const hour = deadlineDate.getHours();
            const minute = deadlineDate.getMinutes();
            
            let timeStr;
            if (minute === 0) {
                // 整点时间显示为上午/下午格式
                if (hour === 0) {
                    timeStr = '凌晨12点';
                } else if (hour < 12) {
                    timeStr = `上午${hour}点`;
                } else if (hour === 12) {
                    timeStr = '中午12点';
                } else {
                    timeStr = `下午${hour - 12}点`;
                }
            } else {
                // 非整点时间显示具体时分
                timeStr = String(hour).padStart(2, '0') + ':' + String(minute).padStart(2, '0');
            }
            
            const deadlineString = `${year}年${month}月${day}日 ${timeStr}`;
            
            // 为每个作业项创建单独的元素
            items.forEach((item, index) => {
                const homeworkItem = document.createElement('div');
                homeworkItem.className = 'homework-item';
                homeworkItem.setAttribute('data-subject', subject);
                homeworkItem.setAttribute('data-item-index', index);
                
                homeworkItem.innerHTML = `
                    <button class="homework-settings-btn" onclick="toggleHomeworkSettings(this)"><svg class="btn-icon"><use href="#settings"></use></svg></button>
                    <div class="homework-settings-menu">
                        <div class="settings-option" onclick="toggleSetting(this, 'classroom')">
                            <label>课堂作业</label>
                            <div class="settings-toggle" data-setting="classroom"></div>
                        </div>
                        <div class="settings-option" onclick="toggleSetting(this, 'no-submit')">
                            <label>无需交上</label>
                            <div class="settings-toggle" data-setting="no-submit"></div>
                        </div>
                        <div class="settings-divider"></div>
                        <div class="settings-option" onclick="editSingleHomework(this)" style="cursor: pointer;">
                             <label>编辑</label>
                             <div class="settings-edit-btn"><svg class="btn-icon"><use href="#edit"></use></svg></div>
                        </div>
                        <div class="settings-divider"></div>
                        <div class="settings-input-group" style="margin-left: 20px; margin-top: 12px;">
                            <label>独立上交时间：</label>
                            <input type="datetime-local" class="custom-deadline" onchange="updateCustomDeadline(this)">
                        </div>
                    </div>
                    <div class="homework-header">
                        <div class="homework-task">${item}</div>
                        <div class="homework-deadline">截止：${deadlineString}</div>
                    </div>
                    <div class="homework-badges"></div>
                `;
                
                subjectHomeworkList.appendChild(homeworkItem);
            });
            
            // 更新科目作业数量
             updateSubjectCount(subject);
        }
        
        // 更新科目作业数量
        function updateSubjectCount(subject) {
            let subjectGroup = null;
            const subjectGroups = document.querySelectorAll('.subject-group');
            for (let group of subjectGroups) {
                const subjectTitle = group.querySelector('.subject-title');
                if (subjectTitle && subjectTitle.textContent === subject) {
                    subjectGroup = group;
                    break;
                }
            }
            if (subjectGroup) {
                const count = subjectGroup.querySelectorAll('.homework-item').length;
                const countElement = subjectGroup.querySelector('.subject-count');
                countElement.textContent = `${count} 项作业`;
            }
            // 重新布局瀑布流
            layoutMasonry();
            // 保存数据到本地存储
            saveDataToLocalStorage();
        }
        
        // 保存数据到本地存储
        function saveDataToLocalStorage() {
            console.log('saveDataToLocalStorage 开始执行');
            const homeworkData = [];
            const subjectGroups = document.querySelectorAll('.subject-group');
            console.log('找到科目组数量:', subjectGroups.length);
            
            subjectGroups.forEach(group => {
                const subjectTitle = group.querySelector('.subject-title');
                if (!subjectTitle) {
                    console.log('科目组缺少标题元素');
                    return;
                }
                
                const subjectName = subjectTitle.textContent;
                console.log('处理科目:', subjectName);
                
                const homeworkItems = group.querySelectorAll('.homework-item');
                console.log('科目', subjectName, '的作业数量:', homeworkItems.length);
                
                const homeworks = [];
                
                homeworkItems.forEach(item => {
                    const taskElement = item.querySelector('.homework-task');
                    const deadlineElement = item.querySelector('.homework-deadline');
                    
                    if (taskElement && deadlineElement) {
                        const task = taskElement.textContent;
                        const deadline = deadlineElement.textContent;
                        
                        // 获取设置状态
                        const isClassroom = item.querySelector('[data-setting="classroom"]')?.classList.contains('active') || false;
                        const isNoSubmit = item.querySelector('[data-setting="no-submit"]')?.classList.contains('active') || false;
                        const customDeadlineInput = item.querySelector('.custom-deadline');
                        const customDeadline = customDeadlineInput ? customDeadlineInput.value : '';
                        
                        homeworks.push({
                            task,
                            deadline,
                            isClassroom,
                            isNoSubmit,
                            customDeadline
                        });
                        
                        console.log('保存作业:', { task, deadline, isClassroom, isNoSubmit, customDeadline });
                    }
                });
                
                if (homeworks.length > 0) {
                    homeworkData.push({
                        subject: subjectName,
                        homeworks
                    });
                }
            });
            
            console.log('准备保存的数据:', homeworkData);
            localStorage.setItem('homeworkData', JSON.stringify(homeworkData));
            console.log('数据已保存到localStorage');
        }
        
        // 从本地存储加载数据
        function loadDataFromLocalStorage() {
            console.log('loadDataFromLocalStorage 开始执行');
            const savedData = localStorage.getItem('homeworkData');
            
            if (!savedData) {
                console.log('没有找到保存的数据');
                return;
            }
            
            try {
                const homeworkData = JSON.parse(savedData);
                console.log('加载的数据:', homeworkData);
                
                // 清空现有数据
                const homeworkList = document.getElementById('homeworkList');
                if (homeworkList) {
                    homeworkList.innerHTML = '';
                    console.log('清空现有作业列表');
                }
                
                // 重建数据
                homeworkData.forEach(subjectData => {
                    console.log('重建科目:', subjectData.subject, '作业数量:', subjectData.homeworks.length);
                    
                    // 为每个科目的所有作业创建一个作业项数组
                    const homeworkTasks = subjectData.homeworks.map(homework => homework.task);
                    
                    // 使用第一个作业的截止时间作为科目的截止时间
                    const firstHomework = subjectData.homeworks[0];
                    if (firstHomework) {
                        // 从deadline文本中提取日期时间
                        const deadlineText = firstHomework.deadline;
                        // 这里需要将显示格式转换回datetime-local格式
                        // 暂时使用当前时间作为默认值
                        const now = new Date();
                        const defaultDeadline = now.toISOString().slice(0, 16);
                        
                        addHomeworkToList(
                            subjectData.subject,
                            defaultDeadline,
                            homeworkTasks
                        );
                        
                        // 恢复每个作业的设置状态
                        setTimeout(() => {
                            const subjectGroup = document.querySelector(`.subject-group`);
                            if (subjectGroup) {
                                const subjectTitle = subjectGroup.querySelector('.subject-title');
                                if (subjectTitle && subjectTitle.textContent === subjectData.subject) {
                                    const homeworkItems = subjectGroup.querySelectorAll('.homework-item');
                                    
                                    subjectData.homeworks.forEach((homework, index) => {
                                        if (homeworkItems[index]) {
                                            const item = homeworkItems[index];
                                            
                                            // 恢复设置状态
                                            if (homework.isClassroom) {
                                                const classroomToggle = item.querySelector('[data-setting="classroom"]');
                                                if (classroomToggle) classroomToggle.classList.add('active');
                                            }
                                            
                                            if (homework.isNoSubmit) {
                                                const noSubmitToggle = item.querySelector('[data-setting="no-submit"]');
                                                if (noSubmitToggle) noSubmitToggle.classList.add('active');
                                            }
                                            
                                            if (homework.customDeadline) {
                                                const customDeadlineInput = item.querySelector('.custom-deadline');
                                                if (customDeadlineInput) customDeadlineInput.value = homework.customDeadline;
                                            }
                                        }
                                    });
                                }
                            }
                        }, 100);
                    }
                });
                
                // 重新布局 - 增加延迟确保DOM完全渲染
                setTimeout(() => {
                    layoutMasonry();
                    console.log('布局完成');
                }, 500);
                console.log('数据加载完成');
            } catch (error) {
                console.error('加载数据失败:', error);
            }
        }
        
        // 智能横向填充布局函数
          function layoutMasonry() {
              const container = document.getElementById('homeworkList');
              const items = Array.from(container.querySelectorAll('.subject-group'));
              
              if (items.length === 0) {
                  container.style.height = '200px';
                  return;
              }
              
              // 重置所有元素为相对定位，使用flexbox布局
              container.style.display = 'flex';
              container.style.flexWrap = 'wrap';
              container.style.gap = '12px';
              container.style.padding = '20px';
              container.style.alignItems = 'flex-start';
              
              items.forEach(item => {
                  item.style.position = 'relative';
                  item.style.left = 'auto';
                  item.style.top = 'auto';
                  item.style.width = 'auto';
                  item.style.minWidth = '280px';
                  item.style.maxWidth = '400px';
                  item.style.flex = '1 1 auto';
              });
              
              // 移除固定高度，让容器自适应
              container.style.height = 'auto';
              container.style.minHeight = '200px';
          }
         
         // 布局单行
          function layoutRow(items, y, containerWidth, gap) {
               if (items.length === 0) return;
               
               const leftMargin = 20; // 左边距
               const rightMargin = 20; // 右边距
               const availableWidth = containerWidth - leftMargin - rightMargin;
               
               // 计算总的自然宽度
               const totalNaturalWidth = items.reduce((sum, item) => sum + item.offsetWidth, 0);
               const totalGapWidth = (items.length - 1) * gap;
               
               // 智能填充策略
               if (totalNaturalWidth + totalGapWidth <= availableWidth) {
                   // 可以完全容纳，进行适当扩展
                   const extraSpace = availableWidth - totalNaturalWidth - totalGapWidth;
                   const expandPerItem = Math.floor(extraSpace / items.length);
                   let currentX = leftMargin;
                   
                   items.forEach((item, index) => {
                       const newWidth = item.offsetWidth + expandPerItem;
                       item.style.width = newWidth + 'px';
                       item.style.left = currentX + 'px';
                       item.style.top = y + 'px';
                       item.style.position = 'absolute';
                       currentX += newWidth + gap;
                   });
                   
                   // 处理剩余空间给最后一个元素
                   const lastItem = items[items.length - 1];
                   const remainingSpace = containerWidth - rightMargin - currentX + gap;
                   if (remainingSpace > 0) {
                       const currentWidth = parseInt(lastItem.style.width);
                       lastItem.style.width = (currentWidth + remainingSpace) + 'px';
                   }
               } else {
                   // 空间不足，按比例缩放
                   const scale = availableWidth / (totalNaturalWidth + totalGapWidth);
                   let currentX = leftMargin;
                   
                   items.forEach((item, index) => {
                       const scaledWidth = Math.floor(item.offsetWidth * scale);
                       const scaledGap = index < items.length - 1 ? Math.floor(gap * scale) : 0;
                       
                       item.style.width = scaledWidth + 'px';
                       item.style.left = currentX + 'px';
                       item.style.top = y + 'px';
                       item.style.position = 'absolute';
                       currentX += scaledWidth + scaledGap;
                   });
               }
           }
         
         // 获取行高度
         function getRowHeight(items) {
             return Math.max(...items.map(item => item.offsetHeight));
         }
        
        // 创建科目分组
        function createSubjectGroup(subject) {
            const subjectGroup = document.createElement('div');
            subjectGroup.className = `subject-group ${subject}`;
            subjectGroup.innerHTML = `
                <div class="subject-header">
                    <div class="subject-title">${subject}</div>
                    <div style="display: flex; align-items: center;">
                        <div class="subject-count">0 项作业</div>
                        <button class="subject-edit-btn" onclick="editSubject(this)" title="编辑学科">编辑学科</button>
                    </div>
                </div>
                <div class="subject-homework-list"></div>
            `;
            return subjectGroup;
        }
        
        // 检查科目是否已存在
        function isSubjectExists(subject) {
            console.log('检查科目是否存在:', subject);
            const subjectGroups = document.querySelectorAll('.subject-group');
            console.log('现有科目组数量:', subjectGroups.length);
            
            for (let group of subjectGroups) {
                const subjectTitle = group.querySelector('.subject-title');
                if (subjectTitle) {
                    console.log('现有科目:', subjectTitle.textContent);
                    if (subjectTitle.textContent === subject) {
                        console.log('找到重复科目:', subject);
                        return true;
                    }
                }
            }
            console.log('科目不存在，可以添加');
            return false;
        }
        
        // 编辑学科
        function editSubject(button) {
            const subjectGroup = button.closest('.subject-group');
            const subject = subjectGroup.querySelector('.subject-title').textContent;
            const homeworkItems = subjectGroup.querySelectorAll('.homework-item');
            
            if (homeworkItems.length === 0) {
                showToast('该学科暂无作业，无法编辑', 'warning');
                return;
            }
            
            // 获取该学科下的所有作业任务
            const homeworkTasks = [];
            homeworkItems.forEach(item => {
                const taskElements = item.querySelectorAll('.homework-task');
                taskElements.forEach(taskEl => {
                    homeworkTasks.push(taskEl.textContent);
                });
            });
            
            // 获取截止时间（取第一个作业的截止时间）
            let deadline = '';
            if (homeworkItems.length > 0) {
                const firstItem = homeworkItems[0];
                const deadlineElement = firstItem.querySelector('.homework-deadline');
                if (deadlineElement) {
                    const deadlineText = deadlineElement.textContent.replace('截止：', '');
                    deadline = deadlineText;
                }
            }
            
            // 设置当前编辑的学科组
            currentEditingHomework = subjectGroup;
            
            // 显示删除学科按钮
            document.getElementById('deleteSubjectBtn').style.display = 'block';
            
            // 填充编辑表单
            document.getElementById('editHomeworkSubject').value = subject;
            
            // 转换时间格式
            if (deadline) {
                // 解析友好格式的时间
                let deadlineDate;
                if (deadline.includes('年') && deadline.includes('月') && deadline.includes('日')) {
                    // 解析"2024年1月15日 上午9点"格式
                    const dateMatch = deadline.match(/(\d{4})年(\d{1,2})月(\d{1,2})日\s*(.+)/);
                    if (dateMatch) {
                        const year = parseInt(dateMatch[1]);
                        const month = parseInt(dateMatch[2]) - 1; // 月份从0开始
                        const day = parseInt(dateMatch[3]);
                        const timeStr = dateMatch[4];
                        
                        let hour = 0;
                        if (timeStr.includes('凌晨12点')) {
                            hour = 0;
                        } else if (timeStr.includes('上午')) {
                            const hourMatch = timeStr.match(/上午(\d{1,2})点/);
                            hour = hourMatch ? parseInt(hourMatch[1]) : 0;
                        } else if (timeStr.includes('中午12点')) {
                            hour = 12;
                        } else if (timeStr.includes('下午')) {
                            const hourMatch = timeStr.match(/下午(\d{1,2})点/);
                            hour = hourMatch ? parseInt(hourMatch[1]) + 12 : 12;
                        } else if (timeStr.includes(':')) {
                            // 具体时分格式
                            const timeMatch = timeStr.match(/(\d{1,2}):(\d{2})/);
                            if (timeMatch) {
                                hour = parseInt(timeMatch[1]);
                                const minute = parseInt(timeMatch[2]);
                                deadlineDate = new Date(year, month, day, hour, minute);
                            }
                        }
                        
                        if (!deadlineDate) {
                            deadlineDate = new Date(year, month, day, hour, 0);
                        }
                    }
                } else {
                    // 兼容旧格式
                    deadlineDate = new Date(deadline.replace(' ', 'T'));
                }
                
                if (deadlineDate && !isNaN(deadlineDate.getTime())) {
                    const isoString = deadlineDate.toISOString().slice(0, 16);
                    document.getElementById('editHomeworkDeadline').value = isoString;
                }
            }
            
            // 填充作业项
            const editHomeworkItems = document.getElementById('editHomeworkItems');
            editHomeworkItems.innerHTML = '';
            
            homeworkTasks.forEach((task, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'homework-item-input';
                itemDiv.innerHTML = `
                    <input type="text" placeholder="请输入作业内容..." class="homework-input" value="${task}">
                    <button type="button" class="remove-item-btn" onclick="removeEditHomeworkItem(this)" ${homeworkTasks.length === 1 ? 'style="display: none;"' : ''}>-</button>
                `;
                editHomeworkItems.appendChild(itemDiv);
            });
            
            // 显示编辑弹窗
            document.getElementById('editHomeworkModal').style.display = 'block';
        }
        
        // 单项作业编辑功能
        let currentEditingItem = null;
        
        function editSingleHomework(button) {
            const homeworkItem = button.closest('.homework-item');
            currentEditingItem = homeworkItem;
            
            const subject = homeworkItem.getAttribute('data-subject');
            const task = homeworkItem.querySelector('.homework-task').textContent;
            const deadlineText = homeworkItem.querySelector('.homework-deadline').textContent.replace('截止：', '');
            
            // 填充编辑表单
            document.getElementById('editHomeworkSubject').value = subject;
            // 隐藏科目选择
            document.getElementById('editHomeworkSubject').closest('.form-group').style.display = 'none';
            
            // 转换时间格式
            let deadlineDate;
            if (deadlineText.includes('年') && deadlineText.includes('月') && deadlineText.includes('日')) {
                // 解析"2024年1月15日 上午9点"格式
                const dateMatch = deadlineText.match(/(\d{4})年(\d{1,2})月(\d{1,2})日\s*(.+)/);
                if (dateMatch) {
                    const year = parseInt(dateMatch[1]);
                    const month = parseInt(dateMatch[2]) - 1; // 月份从0开始
                    const day = parseInt(dateMatch[3]);
                    const timeStr = dateMatch[4];
                    
                    let hour = 0;
                    if (timeStr.includes('凌晨12点')) {
                        hour = 0;
                    } else if (timeStr.includes('上午')) {
                        const hourMatch = timeStr.match(/上午(\d{1,2})点/);
                        hour = hourMatch ? parseInt(hourMatch[1]) : 0;
                    } else if (timeStr.includes('中午12点')) {
                        hour = 12;
                    } else if (timeStr.includes('下午')) {
                        const hourMatch = timeStr.match(/下午(\d{1,2})点/);
                        hour = hourMatch ? parseInt(hourMatch[1]) + 12 : 12;
                    } else if (timeStr.includes(':')) {
                        // 具体时分格式
                        const timeMatch = timeStr.match(/(\d{1,2}):(\d{2})/);
                        if (timeMatch) {
                            hour = parseInt(timeMatch[1]);
                            const minute = parseInt(timeMatch[2]);
                            deadlineDate = new Date(year, month, day, hour, minute);
                        }
                    }
                    
                    if (!deadlineDate) {
                        deadlineDate = new Date(year, month, day, hour, 0);
                    }
                }
            } else {
                // 兼容旧格式
                deadlineDate = new Date(deadlineText.replace(' ', 'T'));
            }
            
            if (deadlineDate && !isNaN(deadlineDate.getTime())) {
                const isoString = deadlineDate.toISOString().slice(0, 16);
                document.getElementById('editHomeworkDeadline').value = isoString;
            }
            // 隐藏时间编辑
            document.getElementById('editHomeworkDeadline').closest('.form-group').style.display = 'none';
            
            // 填充单个作业项
            const editHomeworkItems = document.getElementById('editHomeworkItems');
            editHomeworkItems.innerHTML = `
                <div class="homework-item-input">
                    <input type="text" placeholder="请输入作业内容..." class="homework-input" value="${task}">
                    <button type="button" class="remove-item-btn" onclick="removeEditHomeworkItem(this)" style="display: none;">-</button>
                </div>
            `;
            
            // 隐藏添加作业项按钮
            document.querySelector('.add-item-btn[onclick="addEditHomeworkItem()"]').style.display = 'none';
            
            // 显示编辑弹窗
            document.getElementById('editHomeworkModal').style.display = 'block';
        }
        
        // 切换作业设置菜单
         function toggleHomeworkSettings(button) {
             const menu = button.nextElementSibling;
             const isVisible = menu.classList.contains('show');
             
             // 关闭所有其他设置菜单
             document.querySelectorAll('.homework-settings-menu.show').forEach(m => {
                 if (m !== menu) m.classList.remove('show');
             });
             
             // 切换当前菜单
             menu.classList.toggle('show', !isVisible);
         }
         
         // 切换设置项
         function toggleSetting(option, settingType) {
             const toggle = option.querySelector('.settings-toggle');
             const isActive = toggle.classList.contains('active');
             const homeworkItem = option.closest('.homework-item');
             const badgesContainer = homeworkItem.querySelector('.homework-badges');
             
             try {
                 // 如果是课堂作业，联动控制台通知
                 if (settingType === 'classroom') {
                     const subject = homeworkItem.getAttribute('data-subject');
                     const task = homeworkItem.querySelector('.homework-task').textContent;
                     
                     if (!isActive) {
                         // 开启课堂作业，添加通知
                         addClassroomHomeworkNotice(subject, [task]);
                     } else {
                         // 取消课堂作业，删除对应通知
                         removeClassroomHomeworkNotice(subject, task);
                     }
                 }
                 
                 // 操作成功后才切换开关状态
                 toggle.classList.toggle('active', !isActive);
                 
                 // 更新徽章显示
                 updateHomeworkBadges(homeworkItem);
             } catch (error) {
                 console.error('设置操作失败:', error);
                 // 操作失败，不改变开关状态
             }
         }
         }
         
         // 更新自定义截止时间
         function updateCustomDeadline(input) {
             const homeworkItem = input.closest('.homework-item');
             const deadlineElement = homeworkItem.querySelector('.homework-deadline');
             
             if (input.value) {
                 const customDate = new Date(input.value);
                 const year = customDate.getFullYear();
                 const month = customDate.getMonth() + 1;
                 const date = customDate.getDate();
                 const hours = customDate.getHours();
                 const minutes = customDate.getMinutes();
                 
                 let timeString;
                 if (minutes === 0) {
                     // 整点时间显示为上午/下午
                     if (hours === 0) {
                         timeString = '凌晨12点';
                     } else if (hours < 12) {
                         timeString = `上午${hours}点`;
                     } else if (hours === 12) {
                         timeString = '中午12点';
                     } else {
                         timeString = `下午${hours - 12}点`;
                     }
                 } else {
                     // 非整点时间显示具体时分
                     timeString = String(hours).padStart(2, '0') + ':' + String(minutes).padStart(2, '0');
                 }
                 
                 const customString = `${year}年${month}月${date}日 ${timeString}`;
                 deadlineElement.textContent = '截止：' + customString;
                 deadlineElement.style.color = '#ff6b6b';
             }
         }
         
         // 更新作业徽章
         function updateHomeworkBadges(homeworkItem) {
             const badgesContainer = homeworkItem.querySelector('.homework-badges');
             const classroomToggle = homeworkItem.querySelector('[data-setting="classroom"]');
             const noSubmitToggle = homeworkItem.querySelector('[data-setting="no-submit"]');
             
             let badges = [];
             
             if (classroomToggle.classList.contains('active')) {
                 badges.push('<span class="homework-badge classroom">课堂作业</span>');
             }
             
             if (noSubmitToggle.classList.contains('active')) {
                 badges.push('<span class="homework-badge no-submit">无需交上</span>');
             }
             
             badgesContainer.innerHTML = badges.join('');
         }
         
         // 添加课堂作业通知
         function addClassroomHomeworkNotice(subject, tasks) {
             const noticeList = document.querySelector('.notice-list');
             const emptyNotice = document.querySelector('.empty-notice');
             
             // 如果是第一条通知，移除空状态
             if (emptyNotice) {
                 emptyNotice.remove();
             }
             
             // 创建课堂作业通知
             const noticeItem = document.createElement('div');
             noticeItem.className = 'notice-item pinned';
             
             const now = new Date();
             const timeString = now.getFullYear() + '-' + 
                               String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                               String(now.getDate()).padStart(2, '0') + ' ' + 
                               String(now.getHours()).padStart(2, '0') + ':' + 
                               String(now.getMinutes()).padStart(2, '0');
             
             const tasksText = tasks.length > 1 ? tasks.join('、') : tasks[0];
             const content = `${subject}课堂作业：${tasksText}`;
             
             noticeItem.innerHTML = `
                 <div class="notice-content">${content}</div>
                 <div class="notice-time">${timeString} <span class="pinned-label">[置顶]</span></div>
                 <div class="notice-actions">
                     <button class="pin-btn" onclick="togglePin(this)" title="取消置顶" style="color: #ffa502;"><svg class="btn-icon"><use href="assets/icons.svg#pin"></use></svg></button>
                 </div>
             `;
             
             // 将课堂作业通知插入到置顶区域顶部
             if (noticeList.children.length === 0) {
                 // 如果通知列表为空，直接添加
                 noticeList.appendChild(noticeItem);
             } else {
                 // 插入到最顶部
                 noticeList.insertBefore(noticeItem, noticeList.firstChild);
             }
     }
     
     // 删除课堂作业通知
     function removeClassroomHomeworkNotice(subject, task) {
         const noticeItems = document.querySelectorAll('.notice-item');
         const targetContent = `${subject}课堂作业：${task}`;
         
         noticeItems.forEach(item => {
             const content = item.querySelector('.notice-content').textContent;
             if (content === targetContent) {
                 item.remove();
             }
         });
         
         // 如果没有通知了，显示空状态
         const noticeList = document.querySelector('.notice-list');
         if (noticeList.children.length === 0) {
             const emptyNotice = document.createElement('div');
             emptyNotice.className = 'empty-notice';
             emptyNotice.innerHTML = '<p>暂无通知</p>';
             noticeList.appendChild(emptyNotice);
         }
     }
         
         // 编辑作业功能
         let currentEditingHomework = null;
         
         function editHomework(button) {
             const homeworkItem = button.closest('.homework-item');
             currentEditingHomework = homeworkItem;
             
             // 获取当前作业信息
             const subject = homeworkItem.querySelector('.homework-subject').textContent;
             const deadlineText = homeworkItem.querySelector('.homework-deadline').textContent.replace('截止：', '');
             const tasks = Array.from(homeworkItem.querySelectorAll('.homework-task')).map(task => task.textContent);
             
             // 填充编辑表单
             document.getElementById('editHomeworkSubject').value = subject;
             
             // 转换时间格式
             const deadlineDate = new Date(deadlineText.replace(' ', 'T'));
             const isoString = deadlineDate.toISOString().slice(0, 16);
             document.getElementById('editHomeworkDeadline').value = isoString;
             
             // 填充作业项
             const editHomeworkItems = document.getElementById('editHomeworkItems');
             editHomeworkItems.innerHTML = '';
             
             tasks.forEach((task, index) => {
                 const itemDiv = document.createElement('div');
                 itemDiv.className = 'homework-item-input';
                 itemDiv.innerHTML = `
                     <input type="text" placeholder="请输入作业内容..." class="homework-input" value="${task}">
                     <button type="button" class="remove-item-btn" onclick="removeEditHomeworkItem(this)" ${tasks.length === 1 ? 'style="display: none;"' : ''}>-</button>
                 `;
                 editHomeworkItems.appendChild(itemDiv);
             });
             
             // 显示编辑弹窗
             document.getElementById('editHomeworkModal').style.display = 'block';
         }
         
         function closeEditHomeworkModal() {
             document.getElementById('editHomeworkModal').style.display = 'none';
             // 恢复所有元素显示状态
             document.getElementById('editHomeworkSubject').disabled = false;
             document.getElementById('editHomeworkDeadline').disabled = false;
             document.getElementById('editHomeworkSubject').closest('.form-group').style.display = 'block';
             document.getElementById('editHomeworkDeadline').closest('.form-group').style.display = 'block';
             document.querySelector('.add-item-btn[onclick="addEditHomeworkItem()"]').style.display = 'block';
             // 隐藏删除学科按钮
             document.getElementById('deleteSubjectBtn').style.display = 'none';
             currentEditingHomework = null;
             currentEditingItem = null;
         }
         
         // 删除学科
         function deleteSubject() {
             if (!currentEditingHomework) {
                 showToast('未找到要删除的学科', 'error');
                 return;
             }
             
             const subjectTitle = currentEditingHomework.querySelector('.subject-title').textContent;
             const homeworkItems = currentEditingHomework.querySelectorAll('.homework-item');
             
             // 确认删除
             showConfirm(`确定要删除"${subjectTitle}"学科及其所有作业吗？此操作不可撤销。`, '删除确认', () => {
                 // 删除所有课堂作业通知
                 homeworkItems.forEach(item => {
                     const taskElement = item.querySelector('.homework-task');
                     if (taskElement && item.querySelector('.homework-badges .classroom-badge')) {
                         removeClassroomHomeworkNotice(subjectTitle, taskElement.textContent);
                     }
                 });
                 
                 // 删除学科组
                 currentEditingHomework.remove();
                 
                 // 检查是否还有作业，如果没有则显示空状态
                 const homeworkList = document.getElementById('homeworkList');
                 const remainingSubjects = homeworkList.querySelectorAll('.subject-group');
                 if (remainingSubjects.length === 0) {
                     const emptyHomework = document.createElement('div');
                     emptyHomework.className = 'empty-homework';
                     emptyHomework.innerHTML = '<div class="empty-homework-text">暂无作业ヾ(≧▽≦*)o</div>';
                     homeworkList.appendChild(emptyHomework);
                 }
                 
                 // 关闭弹窗
                 closeEditHomeworkModal();
                 
                 // 重新布局瀑布流
                 setTimeout(layoutMasonry, 100);
                 // 保存数据
                 setTimeout(saveDataToLocalStorage, 150);
                 
                 showToast(`"${subjectTitle}"学科已删除`, 'success');
            });
         }
         
         function addEditHomeworkItem() {
             const editHomeworkItems = document.getElementById('editHomeworkItems');
             const newItem = document.createElement('div');
             newItem.className = 'homework-item-input';
             newItem.innerHTML = `
                 <input type="text" placeholder="请输入作业内容..." class="homework-input">
                 <button type="button" class="remove-item-btn" onclick="removeEditHomeworkItem(this)">-</button>
             `;
             editHomeworkItems.appendChild(newItem);
             
             // 显示所有删除按钮
             const removeButtons = editHomeworkItems.querySelectorAll('.remove-item-btn');
             removeButtons.forEach(btn => btn.style.display = 'flex');
         }
         
         function removeEditHomeworkItem(button) {
             console.log('removeEditHomeworkItem 开始执行');
             const editHomeworkItems = document.getElementById('editHomeworkItems');
             const item = button.parentElement;
             item.remove();
             console.log('已从编辑模式中删除作业项');
             
             // 如果只剩一项，隐藏删除按钮
             const remainingItems = editHomeworkItems.querySelectorAll('.homework-item-input');
             if (remainingItems.length === 1) {
                 remainingItems[0].querySelector('.remove-item-btn').style.display = 'none';
                 console.log('隐藏编辑模式最后一个删除按钮');
             }
             
             // 保存数据到本地存储
             setTimeout(() => {
                 saveDataToLocalStorage();
                 console.log('编辑删除作业项后保存数据');
             }, 100);
         }
         
         function confirmEditHomework() {
             const subject = document.getElementById('editHomeworkSubject').value;
             const deadline = document.getElementById('editHomeworkDeadline').value;
             const inputs = document.querySelectorAll('#editHomeworkItems .homework-input');
             
             if (!subject) {
                showToast('请选择科目', 'warning');
                return;
            }
            
            if (!deadline) {
                showToast('请选择结束时间', 'warning');
                return;
            }
             
             const items = [];
             inputs.forEach(input => {
                 if (input.value.trim()) {
                     items.push(input.value.trim());
                 }
             });
             
             if (items.length === 0) {
                showToast('请至少添加一项作业内容', 'warning');
                return;
            }
             
             // 判断是单项编辑还是整个学科编辑
             if (currentEditingItem) {
                 // 单项作业编辑
                 const task = items[0]; // 单项编辑只取第一个
                 updateSingleHomeworkItem(currentEditingItem, subject, deadline, task);
             } else if (currentEditingHomework) {
                 // 整个学科编辑
                 updateHomeworkItem(currentEditingHomework, subject, deadline, items);
             }
             
             closeEditHomeworkModal();
         }
         
         function updateSingleHomeworkItem(homeworkItem, subject, deadline, task) {
             // 获取原科目
             const oldSubject = homeworkItem.getAttribute('data-subject');
             
             // 更新作业项内容
             homeworkItem.setAttribute('data-subject', subject);
             homeworkItem.querySelector('.homework-subject').textContent = subject;
             
             // 更新截止时间
             const deadlineDate = new Date(deadline);
             // 格式化为友好的时间显示
             const year = deadlineDate.getFullYear();
             const month = deadlineDate.getMonth() + 1;
             const day = deadlineDate.getDate();
             const hour = deadlineDate.getHours();
             const minute = deadlineDate.getMinutes();
             
             let timeStr;
             if (minute === 0) {
                 // 整点时间显示为上午/下午格式
                 if (hour === 0) {
                     timeStr = '凌晨12点';
                 } else if (hour < 12) {
                     timeStr = `上午${hour}点`;
                 } else if (hour === 12) {
                     timeStr = '中午12点';
                 } else {
                     timeStr = `下午${hour - 12}点`;
                 }
             } else {
                 // 非整点时间显示具体时分
                 timeStr = String(hour).padStart(2, '0') + ':' + String(minute).padStart(2, '0');
             }
             
             const deadlineString = `${year}年${month}月${day}日 ${timeStr}`;
             homeworkItem.querySelector('.homework-deadline').textContent = '截止：' + deadlineString;
             homeworkItem.querySelector('.homework-task').textContent = task;
             
             // 如果科目发生变化，需要移动到新的科目组
             if (oldSubject !== subject) {
                 const oldSubjectGroup = homeworkItem.closest('.subject-group');
                 
                 // 查找或创建新科目组
                 let newSubjectGroup = document.querySelector(`.subject-group.${subject}`);
                 if (!newSubjectGroup) {
                     newSubjectGroup = createSubjectGroup(subject);
                     document.getElementById('homeworkList').appendChild(newSubjectGroup);
                 }
                 
                 // 移动作业项到新科目组
                 newSubjectGroup.appendChild(homeworkItem);
                 
                 // 更新两个科目的作业数量
                 updateSubjectCount(oldSubject);
                 updateSubjectCount(subject);
                 
                 // 如果原科目组没有作业了，删除该科目组
                 if (oldSubjectGroup.querySelectorAll('.homework-item').length === 0) {
                     oldSubjectGroup.remove();
                 }
             }
         }
         
         // 更新整个学科的作业项
         function updateHomeworkItem(homeworkItem, subject, deadline, items) {
             const oldSubject = homeworkItem.getAttribute('data-subject');
             const subjectGroup = homeworkItem.closest('.subject-group');
             const subjectHomeworkList = subjectGroup.querySelector('.subject-homework-list');
             
             // 清除该科目下的所有作业项
             const allHomeworkItems = subjectHomeworkList.querySelectorAll('.homework-item');
             allHomeworkItems.forEach(item => item.remove());
             
             // 重新创建作业项
             const deadlineDate = new Date(deadline);
             // 格式化为友好的时间显示
             const year = deadlineDate.getFullYear();
             const month = deadlineDate.getMonth() + 1;
             const day = deadlineDate.getDate();
             const hour = deadlineDate.getHours();
             const minute = deadlineDate.getMinutes();
             
             let timeStr;
             if (minute === 0) {
                 // 整点时间显示为上午/下午格式
                 if (hour === 0) {
                     timeStr = '凌晨12点';
                 } else if (hour < 12) {
                     timeStr = `上午${hour}点`;
                 } else if (hour === 12) {
                     timeStr = '中午12点';
                 } else {
                     timeStr = `下午${hour - 12}点`;
                 }
             } else {
                 // 非整点时间显示具体时分
                 timeStr = String(hour).padStart(2, '0') + ':' + String(minute).padStart(2, '0');
             }
             
             const deadlineString = `${year}年${month}月${day}日 ${timeStr}`;
             
             items.forEach((item, index) => {
                 const homeworkItem = document.createElement('div');
                 homeworkItem.className = 'homework-item';
                 homeworkItem.setAttribute('data-subject', subject);
                 homeworkItem.setAttribute('data-item-index', index);
                 
                 homeworkItem.innerHTML = `
                     <button class="homework-settings-btn" onclick="toggleHomeworkSettings(this)"><svg class="btn-icon"><use href="#settings"></use></svg></button>
                     <div class="homework-settings-menu">
                         <div class="settings-option" onclick="toggleSetting(this, 'classroom')">
                             <label>课堂作业</label>
                             <div class="settings-toggle" data-setting="classroom"></div>
                         </div>
                         <div class="settings-option" onclick="toggleSetting(this, 'no-submit')">
                             <label>无需交上</label>
                             <div class="settings-toggle" data-setting="no-submit"></div>
                         </div>
                         <div class="settings-divider"></div>
                         <div class="settings-option" onclick="editSingleHomework(this)" style="cursor: pointer;">
                             <label>编辑</label>
                             <div class="settings-edit-btn"><svg class="btn-icon"><use href="#edit"></use></svg></div>
                         </div>
                         <div class="settings-divider"></div>
                         <div class="settings-input-group" style="margin-left: 20px; margin-top: 12px;">
                             <label>独立上交时间：</label>
                             <input type="datetime-local" class="custom-deadline" onchange="updateCustomDeadline(this)">
                         </div>
                     </div>
                     <div class="homework-header">
                         <div class="homework-task">${item}</div>
                         <div class="homework-deadline">截止：${deadlineString}</div>
                     </div>
                     <div class="homework-badges"></div>
                 `;
                 
                 subjectHomeworkList.appendChild(homeworkItem);
             });
             
             // 如果科目发生变化，需要更新科目组
             if (oldSubject !== subject) {
                 // 更新科目组的类名和标题
                 subjectGroup.className = `subject-group ${subject}`;
                 subjectGroup.querySelector('.subject-title').textContent = subject;
             }
             
             // 更新科目作业数量
             updateSubjectCount(subject);
         }
         
         // 自定义确认弹窗函数
        let confirmCallback = null;
        
        function showConfirm(message, title = '确认操作', callback = null) {
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').style.display = 'block';
            confirmCallback = callback;
        }
        
        function closeConfirmModal() {
            document.getElementById('confirmModal').style.display = 'none';
            confirmCallback = null;
        }
        
        function confirmAction() {
            if (confirmCallback) {
                confirmCallback();
            }
            closeConfirmModal();
        }
        
        // 自定义输入弹窗函数
        let promptCallback = null;
        
        function showPrompt(message, title = '输入信息', placeholder = '', defaultValue = '', callback = null) {
            document.getElementById('promptTitle').textContent = title;
            document.getElementById('promptMessage').textContent = message;
            const input = document.getElementById('promptInput');
            input.placeholder = placeholder;
            input.value = defaultValue;
            document.getElementById('promptModal').style.display = 'block';
            input.focus();
            promptCallback = callback;
        }
        
        function closePromptModal() {
            document.getElementById('promptModal').style.display = 'none';
            promptCallback = null;
        }
        
        function submitPrompt() {
            const value = document.getElementById('promptInput').value.trim();
            if (promptCallback) {
                promptCallback(value);
            }
            closePromptModal();
        }

        // 点击弹窗外部关闭弹窗
         window.onclick = function(event) {
             const addNoticeModal = document.getElementById('addNoticeModal');
             const addHomeworkModal = document.getElementById('addHomeworkModal');
             const editHomeworkModal = document.getElementById('editHomeworkModal');
             
             if (event.target === addNoticeModal) {
                 closeAddNoticeModal();
             }
             if (event.target === addHomeworkModal) {
                 closeAddHomeworkModal();
             }
             if (event.target === editHomeworkModal) {
                 closeEditHomeworkModal();
             }
             
             // 点击外部关闭作业设置菜单
         if (!event.target.closest('.homework-settings-menu') && !event.target.closest('.homework-settings-btn')) {
             document.querySelectorAll('.homework-settings-menu.show').forEach(menu => {
                 menu.classList.remove('show');
             });
         }
     }
     
     // 页面加载完成后初始化瀑布流布局
     document.addEventListener('DOMContentLoaded', function() {
         loadDataFromLocalStorage(); // 加载保存的数据
         setTimeout(layoutMasonry, 100); // 延迟执行确保元素已渲染

        const navLinks = document.querySelectorAll('.nav-link');
        const pages = document.querySelectorAll('.page');

        // 默认隐藏所有页面，除了控制台
        pages.forEach(page => {
            if(page.id !== 'console') {
                page.style.display = 'none';
            }
        });

        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const pageId = this.dataset.page;
                console.log('Clicking page:', pageId); // 调试信息

                pages.forEach(page => {
                    page.style.display = 'none';
                });

                const targetPage = document.getElementById(pageId);
                console.log('Target page found:', targetPage); // 调试信息
                if (targetPage) {
                    targetPage.style.display = 'block';
                    console.log('Page displayed:', pageId); // 调试信息
                }

                navLinks.forEach(nav => {
                    nav.classList.remove('active');
                });
                this.classList.add('active');
            });
        });

        // 初始加载时显示控制台并激活对应链接
        const initialPage = document.getElementById('console');
        if(initialPage) {
            initialPage.style.display = 'block';
        }
        const consoleLink = document.querySelector('.nav-link[data-page="console"]');
        if (consoleLink) {
            consoleLink.classList.add('active');
        }
     });
     
     // 窗口大小变化时重新布局
     window.addEventListener('resize', function() {
         setTimeout(layoutMasonry, 100);
     });

        // 课程表相关功能
        let scheduleData = {};
        let timeSlots = [
            { name: '第1节课', start: '08:00', end: '08:45', type: 'class' },
            { name: '课间操', start: '08:45', end: '08:55', type: 'break' },
            { name: '第2节课', start: '08:55', end: '09:40', type: 'class' },
            { name: '大课间', start: '09:40', end: '10:00', type: 'break' },
            { name: '第3节课', start: '10:00', end: '10:45', type: 'class' },
            { name: '第4节课', start: '10:55', end: '11:40', type: 'class' },
            { name: '午休', start: '12:00', end: '14:00', type: 'lunch' },
            { name: '第5节课', start: '14:00', end: '14:45', type: 'class' },
            { name: '第6节课', start: '14:55', end: '15:40', type: 'class' },
            { name: '第7节课', start: '15:50', end: '16:35', type: 'class' },
            { name: '第8节课', start: '16:45', end: '17:30', type: 'class' }
        ];
        let weekDays = ['周一', '周二', '周三', '周四', '周五', '周六', '周日'];

        function initSchedule() {
            loadScheduleData();
            loadTimeSlots();
            loadWeekDays();
            renderScheduleTable();
        }

        function loadScheduleData() {
            const saved = localStorage.getItem('scheduleData');
            if (saved) {
                try {
                    scheduleData = JSON.parse(saved);
                } catch (e) {
                    console.error('加载课程表数据失败:', e);
                    scheduleData = {};
                }
            }
        }

        function loadTimeSlots() {
            const saved = localStorage.getItem('timeSlots');
            if (saved) {
                try {
                    timeSlots = JSON.parse(saved);
                } catch (e) {
                    console.error('加载时间段数据失败:', e);
                }
            }
        }

        function loadWeekDays() {
            const saved = localStorage.getItem('weekDays');
            if (saved) {
                try {
                    weekDays = JSON.parse(saved);
                } catch (e) {
                    console.error('加载星期数据失败:', e);
                }
            }
        }

        function saveScheduleData() {
            localStorage.setItem('scheduleData', JSON.stringify(scheduleData));
        }

        function saveTimeSlots() {
            localStorage.setItem('timeSlots', JSON.stringify(timeSlots));
        }

        function saveWeekDays() {
            localStorage.setItem('weekDays', JSON.stringify(weekDays));
        }

        function renderScheduleTable() {
            const table = document.getElementById('scheduleTable');
            if (!table) return;
            
            // 重新生成表头
            const thead = table.querySelector('thead');
            if (thead) {
                const headerRow = thead.querySelector('tr');
                headerRow.innerHTML = '<th>时间</th>';
                weekDays.forEach((day, index) => {
                    const th = document.createElement('th');
                    if (isEditMode) {
                        th.innerHTML = `${day} <button class="btn-cell btn-danger" onclick="removeWeekDay(${index})" title="删除">删除</button>`;
                    } else {
                        th.innerHTML = day;
                    }
                    headerRow.appendChild(th);
                });
                // 添加新列按钮
                if (isEditMode) {
                    const addTh = document.createElement('th');
                    addTh.innerHTML = '<button class="btn-cell btn-primary" onclick="addWeekDay()" title="添加星期">添加</button>';
                    headerRow.appendChild(addTh);
                }
            }
            
            const tbody = document.getElementById('scheduleBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            timeSlots.forEach((timeSlot, timeIndex) => {
                const row = document.createElement('tr');
                
                // 时间列
                const timeCell = document.createElement('td');
                if (isEditMode) {
                    timeCell.innerHTML = `
                        <div class="time-slot-info">
                            <div class="time-slot-name">${timeSlot.name}</div>
                            <div class="time-slot-time">${timeSlot.start}-${timeSlot.end}</div>
                        </div>
                        <div class="cell-actions">
                            <button class="btn-cell btn-warning" onclick="editTimeSlot(${timeIndex})" title="编辑">编辑</button>
                            <button class="btn-cell btn-danger" onclick="removeTimeSlot(${timeIndex})" title="删除">删除</button>
                        </div>
                    `;
                } else {
                    timeCell.innerHTML = `
                        <div class="time-slot-info">
                            <div class="time-slot-name">${timeSlot.name}</div>
                            <div class="time-slot-time">${timeSlot.start}-${timeSlot.end}</div>
                        </div>
                    `;
                }
                timeCell.className = `time-slot-item ${timeSlot.type}`;
                row.appendChild(timeCell);
                
                // 星期列
                weekDays.forEach((day, dayIndex) => {
                    const cell = document.createElement('td');
                    const key = `${timeIndex}-${dayIndex}`;
                    const cellData = scheduleData[key] || '';
                    
                    if (timeSlot.type === 'class') {
                        const textarea = document.createElement('textarea');
                        textarea.className = 'schedule-cell';
                        textarea.value = cellData;
                        textarea.placeholder = '点击编辑课程';
                        textarea.draggable = isEditMode;
                        textarea.disabled = !isEditMode; // 根据编辑模式设置是否可编辑
                        textarea.setAttribute('data-day', dayIndex);
                        textarea.setAttribute('data-time', timeIndex);
                        textarea.addEventListener('input', function() {
                            scheduleData[key] = this.value;
                            saveScheduleData();
                            adjustFontSize(this); // 调整字体大小
                        });
                        
                        // 初始化时调整字体大小
                        adjustFontSize(textarea);
                        cell.appendChild(textarea);
                    } else {
                        cell.className = `schedule-cell-readonly ${timeSlot.type}`;
                        cell.textContent = timeSlot.name;
                        cell.style.textAlign = 'center';
                        cell.style.color = '#666';
                        cell.style.fontStyle = 'italic';
                    }
                    
                    row.appendChild(cell);
                });
                
                // 空列用于对齐
                const emptyCell = document.createElement('td');
                row.appendChild(emptyCell);
                
                tbody.appendChild(row);
            });
            
            // 添加新时间段行（仅在编辑模式下显示）
            if (isEditMode) {
                const addRow = document.createElement('tr');
                const addCell = document.createElement('td');
                addCell.colSpan = weekDays.length + 2;
                addCell.innerHTML = '<button class="btn btn-primary" onclick="addTimeSlot()" style="width: 100%;">添加时间段</button>';
                addRow.appendChild(addCell);
                tbody.appendChild(addRow);
            }
        }

        // 时间段管理功能
        function showTimeSlotManager() {
            const modal = document.getElementById('timeSlotModal');
            if (modal) {
                renderTimeSlotList();
                modal.style.display = 'block';
            }
        }

        function closeTimeSlotModal() {
            const modal = document.getElementById('timeSlotModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function renderTimeSlotList() {
            const list = document.getElementById('timeSlotList');
            if (!list) return;
            
            list.innerHTML = '';
            
            timeSlots.forEach((slot, index) => {
                const item = document.createElement('div');
                item.className = `time-slot-item ${slot.type}`;
                if (isEditMode) {
                    item.innerHTML = `
                        <div class="time-slot-info">
                            <div class="time-slot-name">${slot.name}</div>
                            <div class="time-slot-time">${slot.start} - ${slot.end}</div>
                        </div>
                        <div class="time-slot-actions">
                            <button class="btn btn-small btn-warning" onclick="editTimeSlot(${index})">编辑</button>
                            <button class="btn btn-small btn-danger" onclick="removeTimeSlot(${index})">删除</button>
                        </div>
                    `;
                } else {
                    item.innerHTML = `
                        <div class="time-slot-info">
                            <div class="time-slot-name">${slot.name}</div>
                            <div class="time-slot-time">${slot.start} - ${slot.end}</div>
                        </div>
                    `;
                }
                list.appendChild(item);
            });
        }

        function addNewTimeSlot() {
            const name = document.getElementById('timeSlotName').value.trim();
            const start = document.getElementById('startTime').value;
            const end = document.getElementById('endTime').value;
            const type = document.getElementById('slotType').value;
            
            if (!name || !start || !end) {
                showMessage('请填写完整的时间段信息', 'error');
                return;
            }
            
            if (start >= end) {
                showMessage('结束时间必须晚于开始时间', 'error');
                return;
            }
            
            const newSlot = { name, start, end, type };
            timeSlots.push(newSlot);
            saveTimeSlots();
            renderTimeSlotList();
            renderScheduleTable();
            
            // 清空表单
            document.getElementById('timeSlotName').value = '';
            document.getElementById('startTime').value = '';
            document.getElementById('endTime').value = '';
            document.getElementById('slotType').value = 'class';
            
            showMessage('时间段添加成功！', 'success');
        }

        function addTimeSlot() {
            // 直接添加一个新的时间段到表格末尾
            const newTimeSlot = {
                name: `第${timeSlots.length + 1}节课`,
                start: '08:00',
                end: '08:45',
                type: 'class'
            };
            
            timeSlots.push(newTimeSlot);
            saveTimeSlots();
            renderScheduleTable();
            showToast('新时间段已添加', 'success');
        }

        function editTimeSlot(index) {
            const slot = timeSlots[index];
            if (!slot) return;
            
            showPrompt('请输入时间段名称:', '编辑时间段', '请输入时间段名称', slot.name, (newName) => {
                if (newName === null) return;
            
            showPrompt('请输入开始时间 (HH:MM):', '编辑开始时间', '请输入开始时间', slot.start, (newStart) => {
                if (newStart === null) return;
                
                showPrompt('请输入结束时间 (HH:MM):', '编辑结束时间', '请输入结束时间', slot.end, (newEnd) => {
                    if (newEnd === null) return;
                    
                    if (newStart >= newEnd) {
                        showMessage('结束时间必须晚于开始时间', 'error');
                        return;
                    }
                    
                    timeSlots[index] = { ...slot, name: newName.trim(), start: newStart, end: newEnd };
                    saveTimeSlots();
                    renderTimeSlotList();
                    renderScheduleTable();
                    showMessage('时间段修改成功！', 'success');
                });
            });
            });
        }

        function removeTimeSlot(index) {
            showConfirm('确定要删除这个时间段吗？', '删除确认', () => {
                timeSlots.splice(index, 1);
                saveTimeSlots();
                renderTimeSlotList();
                renderScheduleTable();
                showMessage('时间段删除成功！', 'success');
            });
        }

        function addWeekDay() {
            if (weekDays.length >= 7) {
                showMessage('课程表已包含完整一周，无需再添加', 'error');
                return;
            }
            
            showPrompt('请输入新的星期名称:', '添加星期', '请输入新的星期名称', '周八', (newDay) => {
                if (newDay && newDay.trim()) {
                    weekDays.push(newDay.trim());
                    saveWeekDays();
                    renderScheduleTable();
                    showMessage('星期添加成功！', 'success');
                }
            });
        }

        function removeWeekDay(index) {
            if (weekDays.length <= 1) {
                showMessage('至少需要保留一个星期', 'error');
                return;
            }
            
            showConfirm(`确定要删除 ${weekDays[index]} 吗？`, '删除确认', () => {
                weekDays.splice(index, 1);
                saveWeekDays();
                renderScheduleTable();
                showMessage('星期删除成功！', 'success');
            });
        }

        function downloadTemplate() {
            const csvContent = generateTemplateCSV();
            downloadCSV(csvContent, 'schedule_template.csv');
            showMessage('模板下载成功！', 'success');
        }

        function generateTemplateCSV() {
            let csv = '时间,' + weekDays.join(',') + '\n';
            timeSlots.forEach(timeSlot => {
                const timeStr = `${timeSlot.name}(${timeSlot.start}-${timeSlot.end})`;
                csv += timeStr + ',' + ','.repeat(weekDays.length - 1) + '\n';
            });
            return csv;
        }

        function importSchedule(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            showMessage('正在导入课程表...', 'loading');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    parseCSVAndUpdateSchedule(csv);
                    showMessage('课程表导入成功！', 'success');
                } catch (error) {
                    console.error('导入失败:', error);
                    showMessage('导入失败：' + error.message, 'error');
                }
            };
            reader.readAsText(file, 'UTF-8');
        }

        function parseCSVAndUpdateSchedule(csv) {
            const lines = csv.split('\n').filter(line => line.trim());
            if (lines.length < 2) {
                throw new Error('CSV文件格式不正确');
            }
            
            // 跳过标题行
            const dataLines = lines.slice(1);
            
            scheduleData = {};
            
            dataLines.forEach((line, timeIndex) => {
                if (timeIndex >= timeSlots.length) return;
                
                const cells = line.split(',');
                // 跳过时间列，从第二列开始
                for (let dayIndex = 0; dayIndex < weekDays.length && dayIndex + 1 < cells.length; dayIndex++) {
                    const content = cells[dayIndex + 1].trim();
                    if (content && timeSlots[timeIndex] && timeSlots[timeIndex].type === 'class') {
                        const key = `${timeIndex}-${dayIndex}`;
                        scheduleData[key] = content;
                    }
                }
            });
            
            saveScheduleData();
            renderScheduleTable();
        }

        function exportSchedule() {
            const csvContent = generateScheduleCSV();
            downloadCSV(csvContent, 'my_schedule.csv');
            showMessage('课程表导出成功！', 'success');
        }

        function generateScheduleCSV() {
            let csv = '时间,' + weekDays.join(',') + '\n';
            
            timeSlots.forEach((timeSlot, timeIndex) => {
                const timeStr = `${timeSlot.name}(${timeSlot.start}-${timeSlot.end})`;
                let row = timeStr;
                weekDays.forEach((day, dayIndex) => {
                    const key = `${timeIndex}-${dayIndex}`;
                    let content = '';
                    if (timeSlot.type === 'class') {
                        content = scheduleData[key] || '';
                    } else {
                        content = timeSlot.name;
                    }
                    row += ',' + content;
                });
                csv += row + '\n';
            });
            
            return csv;
        }

        function clearSchedule() {
            showConfirm('确定要清空所有课程表数据吗？此操作不可撤销。', '清空确认', () => {
                scheduleData = {};
                saveScheduleData();
                renderScheduleTable();
                showMessage('课程表已清空！', 'success');
            });
        }
        
        // 批量添加功能
        function showBatchAddModal() {
            const modal = document.getElementById('batchAddModal');
            if (modal) {
                // 填充时间段选项
                const timeSlotSelect = document.getElementById('batchTimeSlot');
                timeSlotSelect.innerHTML = '<option value="">请选择时间段</option>';
                timeSlots.forEach((slot, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = slot;
                    timeSlotSelect.appendChild(option);
                });
                
                // 生成星期选择器
                const weekSelector = document.getElementById('weekSelector');
                weekSelector.innerHTML = '';
                weekDays.forEach((day, index) => {
                    const checkbox = document.createElement('div');
                    checkbox.className = 'week-checkbox';
                    checkbox.innerHTML = `
                        <input type="checkbox" id="week_${index}" value="${index}">
                        <label for="week_${index}">${day}</label>
                    `;
                    checkbox.addEventListener('click', function() {
                        const input = checkbox.querySelector('input');
                        input.checked = !input.checked;
                        checkbox.classList.toggle('selected', input.checked);
                    });
                    weekSelector.appendChild(checkbox);
                });
                
                modal.style.display = 'block';
            }
        }
        
        function closeBatchAddModal() {
            const modal = document.getElementById('batchAddModal');
            if (modal) {
                modal.style.display = 'none';
                // 清空表单
                document.getElementById('batchCourseName').value = '';
                document.getElementById('batchTimeSlot').value = '';
                const checkboxes = document.querySelectorAll('#weekSelector .week-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.classList.remove('selected');
                    checkbox.querySelector('input').checked = false;
                });
            }
        }
        
        function confirmBatchAdd() {
            const courseName = document.getElementById('batchCourseName').value.trim();
            const timeSlotIndex = document.getElementById('batchTimeSlot').value;
            const selectedWeeks = [];
            
            // 获取选中的星期
            const checkboxes = document.querySelectorAll('#weekSelector input[type="checkbox"]:checked');
            checkboxes.forEach(checkbox => {
                selectedWeeks.push(parseInt(checkbox.value));
            });
            
            // 验证输入
            if (!courseName) {
                showToast('请输入课程名称', 'warning');
                return;
            }
            
            if (!timeSlotIndex) {
                showToast('请选择时间段', 'warning');
                return;
            }
            
            if (selectedWeeks.length === 0) {
                showToast('请至少选择一个星期', 'warning');
                return;
            }
            
            // 批量添加课程
            selectedWeeks.forEach(weekIndex => {
                const key = `${timeSlotIndex}-${weekIndex}`;
                scheduleData[key] = courseName;
            });
            
            // 保存数据并刷新表格
            saveScheduleData();
            renderScheduleTable();
            closeBatchAddModal();
            
            showMessage(`成功批量添加课程"${courseName}"到${selectedWeeks.length}个时间段！`, 'success');
        }

        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        function showMessage(message, type) {
            // 使用Toast替代原有的消息显示
            showToast(message, type);
        }
        
        // Toast吐司提醒功能
        function showToast(message, type = 'info', title = '', duration = 3000) {
            const container = document.getElementById('toastContainer');
            if (!container) return;
            
            // 创建Toast元素
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            // 图标映射
            const icons = {
                success: '✓',
                error: '✕',
                warning: '⚠',
                info: 'ℹ'
            };
            
            // 标题映射
            const titles = {
                success: title || '成功',
                error: title || '错误',
                warning: title || '警告',
                info: title || '提示'
            };
            
            toast.innerHTML = `
                <div class="toast-icon ${type}">${icons[type] || 'ℹ'}</div>
                <div class="toast-content">
                    <div class="toast-title">${titles[type]}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="closeToast(this)">×</button>
            `;
            
            // 添加到容器
            container.appendChild(toast);
            
            // 触发显示动画
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // 自动关闭
            if (duration > 0) {
                setTimeout(() => {
                    closeToast(toast.querySelector('.toast-close'));
                }, duration);
            }
        }
        
        function closeToast(closeBtn) {
            const toast = closeBtn.closest('.toast');
            if (toast) {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }
        }

        // 右键菜单和拖拽功能
        let currentCell = null;
        let copiedContent = '';
        let contextMenuTarget = null;

        // 添加右键菜单事件监听
        document.addEventListener('DOMContentLoaded', function() {
            document.addEventListener('contextmenu', handleContextMenu);
            document.addEventListener('click', hideContextMenu);
        });

        function handleContextMenu(e) {
            const cell = e.target.closest('.schedule-cell');
            if (cell && cell.closest('#scheduleTable')) {
                e.preventDefault();
                contextMenuTarget = cell;
                showContextMenu(e.pageX, e.pageY);
            }
        }

        function showContextMenu(x, y) {
            const menu = document.getElementById('contextMenu');
            if (menu) {
                menu.style.display = 'block';
                menu.style.left = x + 'px';
                menu.style.top = y + 'px';
            }
        }

        function hideContextMenu() {
            const menu = document.getElementById('contextMenu');
            if (menu) {
                menu.style.display = 'none';
            }
        }

        function copyCell() {
            if (contextMenuTarget) {
                copiedContent = contextMenuTarget.value || '';
                showMessage('已复制单元格内容', 'success');
            }
            hideContextMenu();
        }

        function pasteCell() {
            if (contextMenuTarget && copiedContent) {
                contextMenuTarget.value = copiedContent;
                contextMenuTarget.dispatchEvent(new Event('input'));
                showMessage('已粘贴内容', 'success');
            }
            hideContextMenu();
        }

        function clearCell() {
            if (contextMenuTarget) {
                contextMenuTarget.value = '';
                contextMenuTarget.dispatchEvent(new Event('input'));
                showMessage('已清空单元格', 'success');
            }
            hideContextMenu();
        }

        function insertRowAbove() {
            const cell = contextMenuTarget;
            if (cell) {
                const row = cell.closest('tr');
                const tbody = row.parentNode;
                const rowIndex = Array.from(tbody.children).indexOf(row);
                
                const newSlot = {
                    name: `新时间段${timeSlots.length + 1}`,
                    start: '09:00',
                    end: '09:45',
                    type: 'class'
                };
                
                timeSlots.splice(rowIndex, 0, newSlot);
                saveTimeSlots();
                renderScheduleTable();
                showMessage('已在上方插入新行', 'success');
            }
            hideContextMenu();
        }

        function insertRowBelow() {
            const cell = contextMenuTarget;
            if (cell) {
                const row = cell.closest('tr');
                const tbody = row.parentNode;
                const rowIndex = Array.from(tbody.children).indexOf(row);
                
                const newSlot = {
                    name: `新时间段${timeSlots.length + 1}`,
                    start: '09:00',
                    end: '09:45',
                    type: 'class'
                };
                
                timeSlots.splice(rowIndex + 1, 0, newSlot);
                saveTimeSlots();
                renderScheduleTable();
                showMessage('已在下方插入新行', 'success');
            }
            hideContextMenu();
        }

        function insertColumnLeft() {
            const cell = contextMenuTarget;
            if (cell) {
                const cellIndex = Array.from(cell.parentNode.children).indexOf(cell) - 1;
                if (cellIndex >= 0) {
                    weekDays.splice(cellIndex, 0, `新列${weekDays.length + 1}`);
                    saveWeekDays();
                    renderScheduleTable();
                    showMessage('已在左侧插入新列', 'success');
                }
            }
            hideContextMenu();
        }

        function insertColumnRight() {
            const cell = contextMenuTarget;
            if (cell) {
                const cellIndex = Array.from(cell.parentNode.children).indexOf(cell) - 1;
                if (cellIndex >= 0) {
                    weekDays.splice(cellIndex + 1, 0, `新列${weekDays.length + 1}`);
                    saveWeekDays();
                    renderScheduleTable();
                    showMessage('已在右侧插入新列', 'success');
                }
            }
            hideContextMenu();
        }

        // 拖拽功能
        let dragSource = null;
        
        function enableDragAndDrop() {
            const table = document.getElementById('scheduleTable');
            if (!table) return;

            table.addEventListener('dragstart', function(e) {
                if (e.target.classList.contains('schedule-cell') && isEditMode) {
                    e.target.classList.add('dragging');
                    dragSource = e.target;
                    e.dataTransfer.setData('text/plain', e.target.value);
                    e.dataTransfer.effectAllowed = 'move';
                } else {
                    e.preventDefault();
                }
            });

            table.addEventListener('dragend', function(e) {
                if (e.target.classList.contains('schedule-cell')) {
                    e.target.classList.remove('dragging');
                    dragSource = null;
                }
            });

            table.addEventListener('dragover', function(e) {
                if (isEditMode) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    if (e.target.classList.contains('schedule-cell')) {
                        e.target.classList.add('drag-over');
                    }
                }
            });

            table.addEventListener('dragleave', function(e) {
                if (e.target.classList.contains('schedule-cell')) {
                    e.target.classList.remove('drag-over');
                }
            });

            table.addEventListener('drop', function(e) {
                e.preventDefault();
                if (e.target.classList.contains('schedule-cell') && isEditMode && dragSource && dragSource !== e.target) {
                    e.target.classList.remove('drag-over');
                    
                    // 互换两个单元格的内容
                    const sourceValue = dragSource.value;
                    const targetValue = e.target.value;
                    
                    dragSource.value = targetValue;
                    e.target.value = sourceValue;
                    
                    // 触发input事件以保存数据
                    dragSource.dispatchEvent(new Event('input'));
                    e.target.dispatchEvent(new Event('input'));
                    
                    // 调整字体大小
                    adjustFontSize(dragSource);
                    adjustFontSize(e.target);
                    
                    showMessage('已互换内容', 'success');
                } else if (e.target.classList.contains('schedule-cell')) {
                    e.target.classList.remove('drag-over');
                }
            });
        }

        // 在初始化时启用拖拽功能
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(enableDragAndDrop, 100);
        });

        // 编辑模式相关变量
        let isEditMode = false;
        let scheduleBackup = null;

        // 切换编辑模式
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const editModeBtn = document.getElementById('editModeBtn');
            const editControls = document.getElementById('editControls');
            const scheduleToolbar = document.getElementById('scheduleToolbar');
            const scheduleCells = document.querySelectorAll('.schedule-cell');
            
            // 获取需要在编辑模式下隐藏的按钮
            const structuralButtons = scheduleToolbar.querySelectorAll('button[onclick*="addTimeSlot"], button[onclick*="addWeekDay"], button[onclick*="clearSchedule"]');

            if (isEditMode) {
                // 进入编辑模式
                scheduleBackup = getCurrentScheduleData();
                editModeBtn.textContent = '编辑中';
                editModeBtn.classList.remove('btn-primary');
                editModeBtn.classList.add('btn-warning');
                editModeBtn.disabled = true;
                editControls.style.display = 'flex';
                scheduleToolbar.style.display = 'block';
                
                // 隐藏结构性修改按钮
                structuralButtons.forEach(btn => {
                    btn.style.display = 'none';
                });
                
                // 启用单元格编辑
                scheduleCells.forEach(cell => {
                    cell.disabled = false;
                });
                
                // 重新渲染课程表以显示编辑按钮
                renderScheduleTable();
                
                showMessage('已进入编辑模式', 'success');
            } else {
                exitEditMode();
            }
        }

        // 退出编辑模式
        function exitEditMode() {
            isEditMode = false;
            const editModeBtn = document.getElementById('editModeBtn');
            const editControls = document.getElementById('editControls');
            const scheduleToolbar = document.getElementById('scheduleToolbar');
            const scheduleCells = document.querySelectorAll('.schedule-cell');
            
            // 重新显示所有按钮
            const structuralButtons = scheduleToolbar.querySelectorAll('button[onclick*="addTimeSlot"], button[onclick*="addWeekDay"], button[onclick*="clearSchedule"]');
            structuralButtons.forEach(btn => {
                btn.style.display = '';
            });

            editModeBtn.textContent = '编辑';
            editModeBtn.classList.remove('btn-warning');
            editModeBtn.classList.add('btn-primary');
            editModeBtn.disabled = false;
            editControls.style.display = 'none';
            scheduleToolbar.style.display = 'none';
            
            // 禁用单元格编辑
            scheduleCells.forEach(cell => {
                cell.disabled = true;
            });
            
            // 重新渲染课程表以隐藏编辑按钮
            renderScheduleTable();
            
            scheduleBackup = null;
            showMessage('已退出编辑模式', 'success');
        }

        // 保存修改
        function saveSchedule() {
            try {
                // 保存当前课程表数据到localStorage
                const currentData = getCurrentScheduleData();
                localStorage.setItem('scheduleData', JSON.stringify(currentData));
                scheduleBackup = currentData;
                showMessage('课程表已保存', 'success');
            } catch (error) {
                showMessage('保存失败：' + error.message, 'error');
            }
        }

        // 撤销修改
        function cancelEdit() {
            if (scheduleBackup) {
                try {
                    restoreScheduleData(scheduleBackup);
                    showMessage('已撤销修改', 'success');
                } catch (error) {
                    showMessage('撤销失败：' + error.message, 'error');
                }
            }
        }

        // 获取当前课程表数据
        function getCurrentScheduleData() {
            const data = {};
            const cells = document.querySelectorAll('.schedule-cell');
            cells.forEach(cell => {
                const timeIndex = cell.getAttribute('data-time');
                const dayIndex = cell.getAttribute('data-day');
                if (timeIndex !== null && dayIndex !== null) {
                    data[`${timeIndex}-${dayIndex}`] = cell.value;
                }
            });
            return data;
        }

        // 恢复课程表数据
        function restoreScheduleData(data) {
            Object.keys(data).forEach(key => {
                const [timeIndex, dayIndex] = key.split('-');
                const cell = document.querySelector(`[data-time="${timeIndex}"][data-day="${dayIndex}"]`);
                if (cell) {
                    cell.value = data[key];
                    // 同时更新scheduleData
                    scheduleData[key] = data[key];
                    // 调整字体大小
                    adjustFontSize(cell);
                }
            });
            saveScheduleData();
        }

        // 字体大小自适应函数
        function adjustFontSize(textarea) {
            const text = textarea.value;
            if (!text.trim()) {
                // 空文本使用默认大小
                textarea.classList.remove('font-small', 'font-medium', 'font-large');
                return;
            }
            
            // 移除所有字体大小类
            textarea.classList.remove('font-small', 'font-medium', 'font-large');
            
            // 根据文本长度简单判断字体大小
            const textLength = text.length;
            
            if (textLength <= 6) {
                // 短文本使用大字体
                textarea.classList.add('font-large');
            } else if (textLength <= 12) {
                // 中等文本使用中字体
                textarea.classList.add('font-medium');
            } else {
                // 长文本使用小字体
                textarea.classList.add('font-small');
            }
        }

        // 初始化时设置只读模式
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const scheduleCells = document.querySelectorAll('.schedule-cell');
                scheduleCells.forEach(cell => {
                    cell.disabled = true;
                    // 为已有内容调整字体大小
                    if (cell.value) {
                        adjustFontSize(cell);
                    }
                });
            }, 200);
        });

        // ==================== 班级信息功能 ====================
        
        // 数据存储键名
        const CLASS_INFO_KEY = 'classInfo';
        
        // 保存班级信息
        function saveClassInfo() {
            const className = document.getElementById('className').value.trim();
            const classGrade = document.getElementById('classGrade').value;
            const classTeacher = document.getElementById('classTeacher').value.trim();
            const classSlogan = document.getElementById('classSlogan').value.trim();
            
            if (!className) {
                showToast('请输入班级名称', 'warning');
                return;
            }
            
            const classInfo = {
                name: className,
                grade: classGrade,
                teacher: classTeacher,
                slogan: classSlogan,
                updateTime: new Date().toLocaleString()
            };
            
            try {
                localStorage.setItem(CLASS_INFO_KEY, JSON.stringify(classInfo));
                showToast('班级信息保存成功！', 'success');
                
                // 更新控制台显示的班级信息
                updateConsoleClassInfo(classInfo);
            } catch (error) {
                console.error('保存班级信息失败:', error);
                showToast('保存失败，请重试', 'error');
            }
        }
        
        // 加载班级信息
        function loadClassInfo() {
            try {
                const savedInfo = localStorage.getItem(CLASS_INFO_KEY);
                if (savedInfo) {
                    const classInfo = JSON.parse(savedInfo);
                    
                    document.getElementById('className').value = classInfo.name || '';
                    document.getElementById('classGrade').value = classInfo.grade || '';
                    document.getElementById('classTeacher').value = classInfo.teacher || '';
                    document.getElementById('classSlogan').value = classInfo.slogan || '';
                }
            } catch (error) {
                console.error('加载班级信息失败:', error);
            }
        }
        
        // 重置班级信息
        function resetClassInfo() {
            if (confirm('确定要重置班级信息吗？这将清空所有已填写的内容。')) {
                document.getElementById('className').value = '';
                document.getElementById('classGrade').value = '';
                document.getElementById('classTeacher').value = '';
                document.getElementById('classSlogan').value = '';
                showToast('班级信息已重置', 'info');
            }
        }
        
        // 更新控制台的班级信息显示
        function updateConsoleClassInfo(classInfo) {
            // 这里可以更新控制台页面显示的班级信息
            // 例如更新页面标题或其他显示元素
            if (classInfo.name) {
                const pageTitle = document.querySelector('.page-title');
                if (pageTitle && pageTitle.textContent === '控制台') {
                    // 可以在这里添加班级名称到标题中
                }
            }
        }
        
        // Toast 通知功能（如果不存在的话）
        function showToast(message, type = 'info') {
            // 检查是否已存在 showToast 函数
            if (typeof window.showToast !== 'undefined') {
                return window.showToast(message, type);
            }
            
            // 简单的 toast 实现
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 10000;
                opacity: 0;
                transition: opacity 0.3s ease;
            `;
            
            // 根据类型设置颜色
            const colors = {
                success: '#28a745',
                error: '#dc3545',
                warning: '#ffc107',
                info: '#17a2b8'
            };
            toast.style.backgroundColor = colors[type] || colors.info;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            // 显示动画
            setTimeout(() => {
                toast.style.opacity = '1';
            }, 100);
            
            // 自动隐藏
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>