<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>班级管理系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #ffffff;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* 深色主题样式 */
        body.dark-theme {
            background-color: #1a1a1a;
            color: #ffffff;
        }
        
        body.dark-theme .sidebar {
            background-color: #2d2d2d;
            border-right-color: #404040;
        }
        
        body.dark-theme .sidebar-header {
            border-bottom-color: #404040;
        }
        
        body.dark-theme .sidebar-title {
            color: #ffffff;
        }
        
        body.dark-theme .sidebar-header {
            border-bottom-color: #404040;
        }
        
        body.dark-theme .nav-link {
            color: #cccccc;
        }
        
        body.dark-theme .nav-link:hover {
            background-color: #404040;
       
            transition: width 0.3s ease;
            color: #ffffff;
        }
        
        body.dark-theme .nav-link.active {
            background-color: #007AFF;
            color: white;
        }
        
        .page-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* 侧边栏样式 */
        .sidebar {
            width: 250px;
            background-color: #f8f9fa;
            border-right: 1px solid #e9ecef;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid #e9ecef;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .sidebar-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            flex: 1;
        }
        
        .class-badge {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
        }
        
        .class-badge img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 6px;
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            margin-bottom: 5px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #666;
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .nav-link:hover {
            background-color: #e9ecef;
            color: #333;
        }
        
        .nav-link.active {
            background-color: #007AFF;
            color: white;
        }
        
        .nav-icon {
            margin-right: 8px !important;
            width: 18px !important;
            height: 18px !important;
        }
        
        /* 主内容区域 */
        .main-content {
            flex: 1;
            margin-left: 250px;
            display: flex;
            flex-direction: column;
            transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .main-content.staffing-open {
            transform: scale(0.95);
        }
        
        .content-area {
            flex: 1;
            padding: 0;
            overflow: hidden;
        }
        
        .content-iframe {
            width: 100%;
            height: 100vh;
            border: none;
            display: block;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transform: scale(1);
            opacity: 1;
        }
        
        .content-iframe.page-exit {
            transform: scale(0.96);
            opacity: 0;
        }
        
        .content-iframe.page-enter {
            transform: scale(0.96);
            opacity: 0;
        }
        
        .content-iframe.page-enter-active {
            transform: scale(1);
            opacity: 1;
        }
        
        /* 移动端菜单按钮 */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            width: 44px;
            height: 44px;
            background: #ffffff;
            border: none;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            z-index: 1001;
            transition: all 0.3s ease;
        }
        
        .mobile-menu-btn:hover {
            background: #f5f5f5;
            transform: scale(1.05);
        }
        
        .mobile-menu-btn svg {
            width: 20px;
            height: 20px;
            color: #333;
        }
        
        /* 深色主题下的移动端菜单按钮 */
        body.dark-theme .mobile-menu-btn {
            background: #2d2d2d;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        body.dark-theme .mobile-menu-btn:hover {
            background: #3d3d3d;
        }
        
        body.dark-theme .mobile-menu-btn svg {
            color: #ffffff;
        }
        
        /* 移动端遮罩层 */
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .mobile-overlay.show {
            opacity: 1;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 1000;
            }
            
            .sidebar.show {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- SVG图标定义 -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;" width="0" height="0">
      <!-- 电脑图标 -->
      <symbol id="computer" viewBox="0 0 24 24">
        <path fill="currentColor" d="M4 2h16a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2h-5l1 2v1H8v-1l1-2H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm0 2v11h16V4H4z"/>
      </symbol>
      
      <!-- 日历图标 -->
      <symbol id="calendar" viewBox="0 0 24 24">
        <path fill="currentColor" d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
      </symbol>
      
      <!-- 设置图标 -->
      <symbol id="settings" viewBox="0 0 24 24">
        <path fill="currentColor" d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5a3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97c0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.49.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.63c-.04.32-.07.65-.07.98c0 .33.03.66.07.98l-2.11 1.63c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.31.61.22l2.49-1c.52.4 1.08.73 1.69.98l.37 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.37-2.65c.63-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65z"/>
      </symbol>
      
      <!-- 用户组图标 -->
      <symbol id="users" viewBox="0 0 24 24">
        <path fill="currentColor" d="M16 4c0-1.11.89-2 2-2s2 .89 2 2s-.89 2-2 2s-2-.89-2-2M4 4c0-1.11.89-2 2-2s2 .89 2 2s-.89 2-2 2s-2-.89-2-2m9 9c-1.11 0-2-.89-2-2s.89-2 2-2s2 .89 2 2s-.89 2-2 2m3-7v7h2.5l-2.54 7.63A1.5 1.5 0 0 1 14.5 22H9.5c-.68 0-1.27-.45-1.46-1.11L5.5 13H8V6c0-.83.67-1.5 1.5-1.5S11 5.17 11 6v7h2V6c0-.83.67-1.5 1.5-1.5S16 5.17 16 6z"/>
      </symbol>
      
      <!-- 书本图标 -->
      <symbol id="book" viewBox="0 0 24 24">
        <path fill="currentColor" d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"/>
      </symbol>
      
      <!-- 举手图标 -->
      <symbol id="hand" viewBox="0 0 24 24">
        <path fill="currentColor" d="M23 5.5V20c0 2.2-1.8 4-4 4h-7.3c-1.08 0-2.1-.43-2.85-1.19L1 14.83s1.26-1.23 1.3-1.25c.22-.19.49-.29.79-.29c.22 0 .42.06.6.16L8 16.5V6.5C8 5.67 8.67 5 9.5 5S11 5.67 11 6.5V10h1V3.5C12 2.67 12.67 2 13.5 2S15 2.67 15 3.5V10h1V5.5C16 4.67 16.67 4 17.5 4S19 4.67 19 5.5V10h1V6.5C20 5.67 20.67 5 21.5 5S23 5.67 23 6.5V5.5z"/>
      </symbol>
      
      <!-- 工具图标 -->
      <symbol id="tools" viewBox="0 0 24 24">
        <path fill="currentColor" d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9c-2-2-5-2.4-7.4-1.3L9 6L6 9L1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/>
      </symbol>
      
      <!-- 工具图标 -->
      <symbol id="tools" viewBox="0 0 24 24">
        <path fill="currentColor" d="M19.36 2.72L20.78 4.14l-1.42 1.42L18.94 5.14L19.36 2.72M12 9L17 4l1.41 1.41L13.41 10.41L12 9M11 10L9.59 11.41l7.07 7.07L18.07 17L11 10M8.18 12.82L5.11 15.89l-1.42-1.42L6.76 11.4L8.18 12.82M2.81 15.89l1.42 1.42l-1.06 1.06c-.39.39-.39 1.02 0 1.41l.71.71c.39.39 1.02.39 1.41 0L6.35 19.43l1.42 1.42L6.71 21.91c-1.17 1.17-3.07 1.17-4.24 0l-.71-.71c-1.17-1.17-1.17-3.07 0-4.24L2.81 15.89Z"/>
      </symbol>
      
      <!-- 菜单图标 -->
      <symbol id="menu" viewBox="0 0 24 24">
        <path fill="currentColor" d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/>
      </symbol>
      
      <!-- 关闭图标 -->
      <symbol id="close" viewBox="0 0 24 24">
        <path fill="currentColor" d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z"/>
      </symbol>
      
      <!-- 扫帚图标 -->
      <symbol id="broom" viewBox="0 0 24 24">
        <path fill="currentColor" d="M19.36 2.72L20.78 4.14l-1.42 1.42L18.94 5.14L19.36 2.72M12 9L17 4l1.41 1.41L13.41 10.41L12 9M11 10L9.59 11.41l7.07 7.07L18.07 17L11 10M8.18 12.82L5.11 15.89l-1.42-1.42L6.76 11.4L8.18 12.82M2.81 15.89l1.42 1.42l-1.06 1.06c-.39.39-.39 1.02 0 1.41l.71.71c.39.39 1.02.39 1.41 0L6.35 19.43l1.42 1.42L6.71 21.91c-1.17 1.17-3.07 1.17-4.24 0l-.71-.71c-1.17-1.17-1.17-3.07 0-4.24L2.81 15.89Z"/>
      </symbol>
    </svg>
    
    <!-- 移动端菜单按钮 -->
    <button class="mobile-menu-btn" id="mobileMenuBtn" onclick="toggleMobileMenu()">
        <svg><use href="#menu"></use></svg>
    </button>
    
    <!-- 移动端遮罩层 -->
    <div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>
    
    <div class="page-container">
        <!-- 侧边栏 -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">班级管理系统</div>
                <div class="class-badge" id="classBadge" style="display: none;"></div>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link active" data-page="console" onclick="switchPage('console')">
                        <svg class="nav-icon"><use href="#computer"></use></svg>
                        <span class="nav-text">控制台</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="homework" onclick="switchPage('homework')">
                        <svg class="nav-icon"><use href="#book"></use></svg>
                        <span class="nav-text">作业</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="roll-call" onclick="switchPage('roll-call')">
                        <svg class="nav-icon"><use href="#hand"></use></svg>
                        <span class="nav-text">点名</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="tools" onclick="switchPage('tools')">
                        <svg class="nav-icon"><use href="#tools"></use></svg>
                        <span class="nav-text">小工具</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="schedule" onclick="switchPage('schedule')">
                        <svg class="nav-icon"><use href="#calendar"></use></svg>
                        <span class="nav-text">课程表</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="duty" onclick="switchPage('duty')">
                        <svg class="nav-icon"><use href="#broom"></use></svg>
                        <span class="nav-text">值日生表</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="settings" onclick="switchPage('settings')">
                        <svg class="nav-icon"><use href="#settings"></use></svg>
                        <span class="nav-text">设置</span>
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- 主内容区域 -->
        <div class="main-content">
            <div class="content-area">
                <iframe id="contentFrame" class="content-iframe" src="nothing.html"></iframe>
                

            </div>
        </div>
    </div>
    
    <script src="popup-system/modal.js"></script>
    <script>
        // 页面切换函数
        function switchPage(pageName) {
            // 移除所有导航链接的active类
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // 为当前点击的导航链接添加active类
            document.querySelector(`[data-page="${pageName}"]`).classList.add('active');
            
            const iframe = document.getElementById('contentFrame');
            
            // 开始退出动画
            iframe.classList.add('page-exit');
            
            // 等待退出动画完成后加载新页面
            setTimeout(() => {
                // 根据页面名称设置对应的iframe源地址
                const timestamp = new Date().getTime();
                switch(pageName) {
                    case 'console':
                        iframe.src = `pages/Console.html?t=${timestamp}`;
                        break;
                    case 'homework':
                        iframe.src = `pages/homework.html?t=${timestamp}`;
                        break;
                    case 'schedule':
                        iframe.src = `pages/Schedule.html?t=${timestamp}`;
                        break;
                    case 'settings':
                        iframe.src = `pages/Settings.html?t=${timestamp}`;
                        break;
                    case 'duty':
                        iframe.src = `pages/ZhiRiTable.html?t=${timestamp}`;
                        break;
                    case 'roll-call':
                        iframe.src = `pages/WhoLucky.html?t=${timestamp}`;
                        break;
                    case 'tools':
                        iframe.src = `nothing.html?t=${timestamp}`;
                        break;
                    default:
                        iframe.src = `nothing.html?t=${timestamp}`;
                        break;
                }
                
                // 设置进入动画初始状态
                iframe.classList.remove('page-exit');
                iframe.classList.add('page-enter');
                
                // 等待新页面加载后开始进入动画
                iframe.onload = function() {
                    setTimeout(() => {
                        iframe.classList.remove('page-enter');
                        iframe.classList.add('page-enter-active');
                        
                        // 动画完成后清理类
                        setTimeout(() => {
                            iframe.classList.remove('page-enter-active');
                        }, 300);
                    }, 50);
                };
            }, 300);
        }
        
        // 强制刷新当前页面函数
        function forceRefreshCurrentPage() {
            const activeLink = document.querySelector('.nav-link.active');
            if (activeLink) {
                const pageName = activeLink.getAttribute('data-page');
                switchPage(pageName);
            }
        }
        
        // 检查系统激活状态
        function checkActivationStatus() {
            try {
                // 优先使用缓存模块检查激活状态
                if (typeof classInfoCache !== 'undefined') {
                    const classInfo = classInfoCache.getClassInfo();
                    return classInfo && classInfo.className && classInfo.className.trim() !== '';
                }
                
                // 如果缓存模块未加载，回退到直接检查localStorage
                const classInfo = localStorage.getItem('classInfo');
                if (!classInfo) {
                    return false;
                }
                
                const classInfoData = JSON.parse(classInfo);
                return classInfoData && classInfoData.className && classInfoData.className.trim() !== '';
            } catch (e) {
                console.error('检查激活状态失败:', e);
                return false;
            }
        }
        
        // 强制进入激活界面
        function forceActivation() {
            window.location.href = 'Activate/first.html';
        }
        
        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 检查是否已经完成激活流程（避免重复检查）
            if (window.activationCompleted) {
                return;
            }
            
            // 检查是否来自激活页面或清空数据页面
            const urlParams = new URLSearchParams(window.location.search);
            const fromActivate = urlParams.get('from') === 'activate';
            const fromClear = urlParams.get('from') === 'clear';
            const actionClearData = urlParams.get('action') === 'clearData';
            
            console.log('URL参数检查:', {
                from: urlParams.get('from'),
                fromActivate: fromActivate,
                fromClear: fromClear,
                actionClearData: actionClearData
            });
            
            // 如果是清空数据操作，直接跳转到清空数据页面
            if (actionClearData) {
                window.location.href = 'pages/ClearData.html';
                return;
            }
            
            // 如果来自清空数据页面，清除URL参数并检查激活状态
            if (fromClear) {
                // 清除URL参数
                window.history.replaceState({}, document.title, window.location.pathname);
                // 检查激活状态，如果未激活则进入激活界面
                if (!checkActivationStatus()) {
                    forceActivation();
                    return;
                }
                // 如果已激活，继续正常流程
                checkHelloActivation();
                switchPage('console');
                loadTheme();
                loadClassBadge();
                return;
            }
            
            // 如果来自激活页面，直接进入主界面，不显示激活覆盖层
            if (fromActivate) {
                window.activationCompleted = true; // 设置标记避免重复检查
                // 清除URL参数，避免刷新时重复处理
                window.history.replaceState({}, document.title, window.location.pathname);
                
                console.log('来自激活页面，准备检查Hello激活功能');
                
                // 检查并设置Hello激活状态
                const settings = JSON.parse(localStorage.getItem('classSystemSettings') || '{}');
                if (!settings.helloActivation) {
                    settings.helloActivation = true;
                    localStorage.setItem('classSystemSettings', JSON.stringify(settings));
                    console.log('激活完成，设置Hello激活状态为true');
                }
                
                // 来自激活页面时，延迟检查Hello激活功能，确保页面完全加载
                setTimeout(() => {
                    console.log('延迟执行Hello激活功能检查');
                    checkHelloActivation();
                }, 1000);
                
                // 加载必要的页面组件
                switchPage('console');
                loadTheme();
                loadClassBadge();
                return;
            } else {
                // 只有在不是来自激活页面时才检查激活状态
                if (!checkActivationStatus()) {
                    // 系统未激活，强制进入激活界面
                    forceActivation();
                    return;
                }
                
                console.log('正常流程，检查Hello激活功能');
                // 正常情况下检查Hello激活功能
                checkHelloActivation();
            }
            
            // 默认加载控制台页面
            switchPage('console');
            
            // 加载保存的主题设置
            loadTheme();
            
            // 加载班徽
            loadClassBadge();
            
            // 添加键盘快捷键支持 Ctrl+R 强制刷新当前页面
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    forceRefreshCurrentPage();
                }
            });
        });
        
        // 移动端菜单控制函数
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            const menuBtn = document.getElementById('mobileMenuBtn');
            
            if (sidebar.classList.contains('show')) {
                closeMobileMenu();
            } else {
                openMobileMenu();
            }
        }
        
        function openMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            const menuBtn = document.getElementById('mobileMenuBtn');
            
            sidebar.classList.add('show');
            overlay.style.display = 'block';
            setTimeout(() => {
                overlay.classList.add('show');
            }, 10);
            
            // 更改按钮图标为关闭图标
            menuBtn.innerHTML = '<svg><use href="#close"></use></svg>';
        }
        
        function closeMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            const menuBtn = document.getElementById('mobileMenuBtn');
            
            sidebar.classList.remove('show');
            overlay.classList.remove('show');
            
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 300);
            
            // 更改按钮图标为菜单图标
            menuBtn.innerHTML = '<svg><use href="#menu"></use></svg>';
        }
        
        // 监听窗口大小变化，在桌面端自动关闭移动端菜单
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                closeMobileMenu();
            }
        });
        
        // ==================== 班徽管理功能 ====================
        
        // 加载班徽
        function loadClassBadge() {
            const badgeElement = document.getElementById('classBadge');
            
            try {
                // 优先使用缓存模块获取班徽配置
                if (window.classInfoCache) {
                    const defaultConfig = classInfoCache.getDefaultBadgeConfig();
                    if (defaultConfig && defaultConfig.type === 'default') {
                        badgeElement.style.background = defaultConfig.color;
                        badgeElement.textContent = defaultConfig.text || '';
                        badgeElement.style.display = 'flex';
                        return;
                    }
                    
                    // 检查是否有上传的班徽
                    const savedEmblem = classInfoCache.getClassEmblem();
                    if (savedEmblem && !defaultConfig) {
                        badgeElement.innerHTML = `<img src="${savedEmblem}" alt="班徽">`;
                        badgeElement.style.display = 'flex';
                        return;
                    }
                } else {
                    // 回退到localStorage
                    const defaultConfig = localStorage.getItem('defaultBadgeConfig');
                    if (defaultConfig) {
                        const config = JSON.parse(defaultConfig);
                        if (config.type === 'default') {
                            badgeElement.style.background = config.color;
                            badgeElement.textContent = config.text || '';
                            badgeElement.style.display = 'flex';
                            return;
                        }
                    }
                    
                    const savedEmblem = localStorage.getItem('classEmblem');
                    if (savedEmblem && !defaultConfig) {
                        badgeElement.innerHTML = `<img src="${savedEmblem}" alt="班徽">`;
                        badgeElement.style.display = 'flex';
                        return;
                    }
                }
                
                badgeElement.style.display = 'none';
            } catch (error) {
                console.error('加载班徽失败:', error);
                badgeElement.style.display = 'none';
            }
        }
        
        // 监听设置页面的班徽更新
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'badgeUpdate') {
                loadClassBadge();
            }
        });
        
        // ==================== 主题管理功能 ====================
        
        // 应用主题
        function applyTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.add('dark-theme');
            } else {
                document.body.classList.remove('dark-theme');
            }
        }
        
        // 加载主题
        function loadTheme() {
            try {
                let theme = 'light';
                
                // 优先使用缓存模块获取主题设置
                if (window.classInfoCache) {
                    const settings = classInfoCache.getSystemSettings();
                    theme = settings.theme || 'light';
                } else {
                    // 回退到localStorage
                    const settings = JSON.parse(localStorage.getItem('classSystemSettings') || '{}');
                    theme = settings.theme || 'light';
                }
                
                applyTheme(theme);
            } catch (e) {
                console.warn('加载主题设置失败:', e);
                applyTheme('light');
            }
        }
        
        // 添加通知功能实现
        function addNotice() {
            modal.prompt('请输入通知内容：', '', '添加通知').then(content => {
                if (content && content.trim()) {
                    console.log('添加通知:', content);
                    toast.success('通知添加成功！');
                } else if (content !== null) {
                    toast.warning('请输入通知内容！');
                }
            });
        }
        
        // 测试确认弹窗
        function testConfirm() {
            confirm.delete('确定要删除这个项目吗？此操作不可撤销。').then(result => {
                if (result) {
                    toast.success('项目已删除！');
                }
            });
        }
        
        // 显示消息提示（兼容原有调用）
        function showMessage(message, type = 'info') {
            toast.show({ message, type });
        }
        
        // 监听来自iframe的消息
        window.addEventListener('message', function(event) {
            const mainContent = document.querySelector('.main-content');
            
            if (event.data === 'openStaffing') {
                mainContent.classList.add('staffing-open');
            } else if (event.data === 'closeStaffing') {
                mainContent.classList.remove('staffing-open');
            } else if (event.data === 'openDeveloper') {
                mainContent.classList.add('staffing-open');
            } else if (event.data === 'closeDeveloper') {
                mainContent.classList.remove('staffing-open');
            } else if (event.data && event.data.type === 'themeChange') {
                // 处理主题切换消息
                applyTheme(event.data.theme);
            } else if (event.data && event.data.action === 'clearData') {
                // 处理清空数据消息，跳转到清空数据页面
                window.location.href = 'pages/ClearData.html';
            }
        });
        
        // 注意：checkActivateOverlay函数已被移除，激活页面跳转逻辑已整合到DOMContentLoaded事件中
        
        // 检查Hello激活功能
        function checkHelloActivation() {
            try {
                const settings = JSON.parse(localStorage.getItem('classSystemSettings') || '{}');
                const helloActivationEnabled = settings.helloActivation === true;
                
                console.log('Hello激活功能检查:', {
                    settings,
                    helloActivationEnabled,
                    timestamp: new Date().toISOString()
                });
                
                if (helloActivationEnabled) {
                    console.log('开始显示Hello页面覆盖层');
                    // 检查是否已存在Hello覆盖层
                    const existingOverlay = document.getElementById('hello-overlay');
                    if (existingOverlay) {
                        console.log('Hello覆盖层已存在，移除旧的');
                        existingOverlay.remove();
                    }
                    // 显示Hello页面覆盖层
                    showHelloOverlay();
                    console.log('Hello覆盖层已添加到DOM');
                } else {
                    console.log('Hello激活功能未开启或设置不存在');
                }
            } catch (e) {
                console.warn('检查Hello激活功能失败:', e);
            }
        }
        
        // 显示Hello页面覆盖层
        function showHelloOverlay() {
            console.log('showHelloOverlay函数开始执行');
            
            // 先缩放主页面内容
            const mainContent = document.querySelector('.main-content');
            const sidebar = document.querySelector('.sidebar');
            console.log('找到的元素:', { mainContent: !!mainContent, sidebar: !!sidebar });
            
            if (mainContent) mainContent.style.transform = 'scale(0.9)';
            if (sidebar) sidebar.style.transform = 'scale(0.9)';
            
            // 创建Hello覆盖层
            const overlay = document.createElement('div');
            overlay.id = 'hello-overlay';
            console.log('创建Hello覆盖层元素:', overlay);
            overlay.innerHTML = `
                <!-- 星空背景 -->
                <div class="starfield" id="hello-starfield"></div>
                
                <!-- 主容器 -->
                <div class="main-container">
                    <!-- 欢迎文字 -->
                    <div class="welcome-text">
                        <div class="text-container">
                            <div class="text-group active" id="hello-chinese">
                                <span class="char">你</span>
                                <span class="char">好</span>
                            </div>
                            <div class="text-group" id="hello-english">
                                <span class="char">H</span>
                                <span class="char">e</span>
                                <span class="char">l</span>
                                <span class="char">l</span>
                                <span class="char">o</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 底部灵动岛按钮 -->
                <div class="dynamic-island disabled" id="hello-dynamicButton">
                    <span class="button-text">继续</span>
                </div>
            `;
            
            // 添加Hello覆盖层样式
            const style = document.createElement('style');
            style.textContent = `
                #hello-overlay {
                    position: fixed !important;
                    top: 0 !important;
                    left: 0 !important;
                    width: 100vw !important;
                    height: 100vh !important;
                    background: #1a1a2e !important;
                    color: white !important;
                    z-index: 999999 !important;
                    overflow: hidden !important;
                    font-family: Arial, sans-serif !important;
                    display: block !important;
                    visibility: visible !important;
                    opacity: 1 !important;
                    pointer-events: auto !important;
                }
                
                #hello-overlay .starfield {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    z-index: 1;
                    pointer-events: none;
                }
                
                #hello-overlay .star {
                    position: absolute;
                    background: white;
                    border-radius: 50%;
                    animation: hello-twinkle 3s infinite;
                }
                
                @keyframes hello-twinkle {
                    0%, 100% { opacity: 0.3; }
                    50% { opacity: 1; }
                }
                
                #hello-overlay .main-container {
                    position: relative;
                    z-index: 10;
                    height: 100vh;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                
                #hello-overlay .welcome-text {
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    text-align: center;
                    color: white;
                    font-size: 3rem;
                    font-weight: 300;
                    letter-spacing: 0.2em;
                    text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
                    z-index: 10;
                    height: 200px;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                }
                
                #hello-overlay .text-container {
                    position: relative;
                    height: 80px;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                }
                
                #hello-overlay .char {
                    display: inline-block;
                    opacity: 0;
                    transform: translateY(20px);
                    transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                    font-size: 3rem;
                    margin: 0 0.1em;
                }
                
                #hello-overlay .char.show {
                    opacity: 1;
                    transform: translateY(0px);
                }
                
                #hello-overlay .char.float {
                    transform: translateY(-5px);
                }
                
                #hello-overlay .char.hide {
                    opacity: 0;
                    transform: translateY(20px);
                }
                
                #hello-overlay .text-group {
                    position: absolute;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    opacity: 0;
                    width: 100%;
                    left: 50%;
                    transform: translateX(-50%);
                }
                
                #hello-overlay .text-group.active {
                    opacity: 1;
                }
                
                #hello-overlay .dynamic-island {
                    position: fixed;
                    bottom: 30px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(0, 0, 0, 0.8);
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    border-radius: 25px;
                    padding: 12px 24px;
                    backdrop-filter: blur(20px);
                    cursor: pointer;
                    transition: all 0.3s ease;
                    z-index: 1000;
                    opacity: 0;
                    transform: translateX(-50%) scale(0.8);
                    width: 60px;
                    height: 50px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    overflow: hidden;
                }
                
                #hello-overlay .dynamic-island.show {
                    opacity: 1;
                    transform: translateX(-50%) scale(1);
                }
                
                #hello-overlay .dynamic-island.expanding {
                    animation: hello-expandIsland 2s ease-out forwards;
                }
                
                #hello-overlay .dynamic-island.expanded {
                    width: 200px;
                    height: 50px;
                }
                
                #hello-overlay .dynamic-island.shrinking {
                    animation: hello-shrinkIsland 1.2s ease-in-out forwards;
                }
                
                @keyframes hello-expandIsland {
                    0% {
                        width: 60px;
                        height: 50px;
                    }
                    100% {
                        width: 200px;
                        height: 50px;
                    }
                }
                
                @keyframes hello-shrinkIsland {
                    0% {
                        width: 200px;
                        height: 50px;
                        opacity: 1;
                    }
                    100% {
                        width: 60px;
                        height: 50px;
                        opacity: 0;
                    }
                }
                
                #hello-overlay .dynamic-island .button-text {
                    color: white;
                    font-size: 14px;
                    font-weight: 500;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                    white-space: nowrap;
                }
                
                #hello-overlay .dynamic-island.expanded .button-text {
                    opacity: 1;
                }
                
                #hello-overlay .dynamic-island.disabled {
                    background: rgba(100, 100, 100, 0.3);
                    border-color: rgba(255, 255, 255, 0.1);
                    cursor: not-allowed;
                }
                
                #hello-overlay .dynamic-island.disabled .button-text {
                    color: rgba(255, 255, 255, 0.5);
                }
                
                #hello-overlay .dynamic-island.enabled {
                    background: rgba(0, 122, 255, 0.8);
                    border-color: rgba(0, 122, 255, 0.5);
                }
                
                #hello-overlay .dynamic-island.enabled:hover {
                    background: rgba(0, 122, 255, 0.9);
                    transform: translateX(-50%) scale(1.05);
                }
            `;
            
            document.head.appendChild(style);
            document.body.appendChild(overlay);
            
            console.log('Hello覆盖层已添加到DOM，当前body子元素数量:', document.body.children.length);
            console.log('Hello覆盖层在DOM中的位置:', document.getElementById('hello-overlay'));
            
            // 初始化Hello覆盖层
            console.log('开始初始化Hello覆盖层组件');
            createHelloStarfield();
            initHelloBottomButton();
            
            // 延迟启动文字动画
            setTimeout(() => {
                console.log('开始Hello文字动画');
                startHelloTextAnimation();
            }, 1000);
            
            console.log('showHelloOverlay函数执行完成');
        }
        
        // 显示激活页面覆盖层
        function showActivateOverlay() {
             // 先缩放主页面内容
             const mainContent = document.querySelector('.main-content');
             const sidebar = document.querySelector('.sidebar');
             if (mainContent) mainContent.style.transform = 'scale(0.9)';
             if (sidebar) sidebar.style.transform = 'scale(0.9)';
             
             // 创建覆盖层
             const overlay = document.createElement('div');
             overlay.id = 'activate-overlay';
             overlay.innerHTML = `
                 <!-- 星空背景 -->
                 <div class="starfield" id="starfield"></div>
                 
                 <!-- 主容器 -->
                 <div class="main-container">
                     <!-- 欢迎文字 -->
                     <div class="welcome-text">
                         <div class="text-container">
                             <div class="text-group" id="chinese">
                                 <span class="char">你</span>
                                 <span class="char">好</span>
                             </div>
                             <div class="text-group" id="english">
                                 <span class="char">H</span>
                                 <span class="char">e</span>
                                 <span class="char">l</span>
                                 <span class="char">l</span>
                                 <span class="char">o</span>
                             </div>
                         </div>
                     </div>
                 </div>
                 
                 <!-- 底部灵动岛按钮 -->
                  <div class="dynamic-island disabled" id="dynamicButton">
                      <span class="button-text">继续</span>
                  </div>
             `;
            
            // 添加覆盖层样式
            const style = document.createElement('style');
            style.textContent = `
                #activate-overlay {
                    position: fixed;
                    top: -5%;
                    left: -5%;
                    width: 110%;
                    height: 110%;
                    background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
                    color: white;
                    z-index: 9999;
                    overflow: hidden;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                }
                
                
                #activate-overlay .starfield {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    z-index: 1;
                    pointer-events: none;
                }
                
                #activate-overlay .star {
                    position: absolute;
                    background: white;
                    border-radius: 50%;
                    animation: overlay-twinkle 3s infinite;
                }
                
                @keyframes overlay-twinkle {
                    0%, 100% { opacity: 0.3; }
                    50% { opacity: 1; }
                }
                
                #activate-overlay .main-container {
                    position: relative;
                    z-index: 10;
                    height: 100vh;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                
                #activate-overlay .welcome-text {
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    text-align: center;
                    color: white;
                    font-size: 3rem;
                    font-weight: 300;
                    letter-spacing: 0.2em;
                    text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
                    z-index: 10;
                    height: 200px;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                }
                
                #activate-overlay .text-container {
                    position: relative;
                    height: 80px;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                }
                
                #activate-overlay .char {
                    display: inline-block;
                    opacity: 0;
                    transform: translateY(20px);
                    transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                    font-size: 3rem;
                    margin: 0 0.1em;
                }
                
                #activate-overlay .char.show {
                    opacity: 1;
                    transform: translateY(0px);
                }
                
                #activate-overlay .char.float {
                    transform: translateY(-5px);
                }
                
                #activate-overlay .char.hide {
                    opacity: 0;
                    transform: translateY(20px);
                }
                
                #activate-overlay .text-group {
                    position: absolute;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    opacity: 0;
                    width: 100%;
                    left: 50%;
                    transform: translateX(-50%);
                }
                
                #activate-overlay .text-group.active {
                    opacity: 1;
                }
                
                #activate-overlay .dynamic-island {
                    position: fixed;
                    bottom: 30px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(0, 0, 0, 0.8);
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    border-radius: 25px;
                    padding: 12px 24px;
                    backdrop-filter: blur(20px);
                    cursor: pointer;
                    transition: all 0.3s ease;
                    z-index: 1000;
                    opacity: 0;
                    transform: translateX(-50%) scale(0.8);
                    width: 60px;
                    height: 50px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    overflow: hidden;
                }
                
                #activate-overlay .dynamic-island.show {
                    opacity: 1;
                    transform: translateX(-50%) scale(1);
                }
                
                #activate-overlay .dynamic-island.expanding {
                    animation: overlay-expandIsland 2s ease-out forwards;
                }
                
                #activate-overlay .dynamic-island.expanded {
                    width: 200px;
                    height: 50px;
                }
                
                #activate-overlay .dynamic-island.shrinking {
                    animation: overlay-shrinkIsland 1.2s ease-in-out forwards;
                }
                
                @keyframes overlay-expandIsland {
                    0% {
                        width: 60px;
                        height: 50px;
                    }
                    100% {
                        width: 200px;
                        height: 50px;
                    }
                }
                
                @keyframes overlay-shrinkIsland {
                    0% {
                        width: 200px;
                        height: 50px;
                        opacity: 1;
                    }
                    100% {
                        width: 60px;
                        height: 50px;
                        opacity: 0;
                    }
                }
                
                #activate-overlay .dynamic-island .button-text {
                    color: white;
                    font-size: 14px;
                    font-weight: 500;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                    white-space: nowrap;
                }
                
                #activate-overlay .dynamic-island.expanded .button-text {
                    opacity: 1;
                }
                
                #activate-overlay .dynamic-island.disabled {
                    background: rgba(100, 100, 100, 0.3);
                    border-color: rgba(255, 255, 255, 0.1);
                    cursor: not-allowed;
                }
                
                #activate-overlay .dynamic-island.disabled .button-text {
                    color: rgba(255, 255, 255, 0.5);
                }
                
                #activate-overlay .dynamic-island.enabled {
                    background: rgba(0, 122, 255, 0.8);
                    border-color: rgba(0, 122, 255, 0.5);
                }
                
                #activate-overlay .dynamic-island.enabled:hover {
                    background: rgba(0, 122, 255, 0.9);
                    transform: translateX(-50%) scale(1.05);
                }
            `;
            
            document.head.appendChild(style);
            document.body.appendChild(overlay);
            
            // 初始化覆盖层
            createOverlayStarfield();
            initOverlayBottomButton();
            
            // 延迟启动文字动画
            setTimeout(() => {
                startOverlayTextAnimation();
            }, 1000);
        }
         
         // 创建星空背景
          function createOverlayStarfield() {
              const starfield = document.getElementById('starfield');
              const numberOfStars = 100;
              
              for (let i = 0; i < numberOfStars; i++) {
                  const star = document.createElement('div');
                  star.className = 'star';
                  
                  // 随机位置
                  star.style.left = Math.random() * 100 + '%';
                  star.style.top = Math.random() * 100 + '%';
                  
                  // 随机大小
                  const size = Math.random() * 3 + 1;
                  star.style.width = size + 'px';
                  star.style.height = size + 'px';
                  
                  // 随机动画延迟
                  star.style.animationDelay = Math.random() * 3 + 's';
                  
                  starfield.appendChild(star);
              }
          }
         
         // 初始化底部按钮
         function initOverlayBottomButton() {
             const button = document.getElementById('dynamicButton');
             
             // 延迟显示按钮（缩短到200ms）
             setTimeout(() => {
                 button.classList.add('show');
                 
                 // 延迟展开按钮（缩短到200ms）
                 setTimeout(() => {
                     button.classList.add('expanding');
                     
                     setTimeout(() => {
                         button.classList.remove('expanding');
                         button.classList.add('expanded');
                         
                         // 延迟启用按钮（缩短到200ms）
                         setTimeout(() => {
                             button.classList.remove('disabled');
                             button.classList.add('enabled');
                             
                             // 添加点击事件
                             button.addEventListener('click', () => {
                                 if (button.classList.contains('enabled')) {
                                     // 开始iOS风格解锁动画
                                     startUnlockAnimation();
                                 }
                             });
                         }, 200);
                     }, 400);
                 }, 200);
             }, 200);
         }
         
         function startUnlockAnimation() {
                 const overlay = document.getElementById('activate-overlay');
                 const button = document.getElementById('dynamicButton');
                 const buttonText = button.querySelector('.button-text');
                 const mainContent = document.querySelector('.main-content');
                 const sidebar = document.querySelector('.sidebar');
                 
                 if (!overlay || !button || !buttonText) return;
                 
                 // 第一步：文字渐隐，按钮减少高度
                 buttonText.style.transition = 'opacity 0.3s ease-out';
                 buttonText.style.opacity = '0';
                 
                 button.style.transition = 'all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                  button.style.height = '3px';
                  button.style.width = '134px';
                  button.style.borderRadius = '1.5px';
                  button.style.background = 'rgba(255, 255, 255, 0.8)';
                 
                 // 第二步：按钮沿Y轴移动到底部8px位置
                 setTimeout(() => {
                     button.style.position = 'fixed';
                     button.style.bottom = '8px';
                     button.style.left = '50%';
                     button.style.transform = 'translateX(-50%)';
                     button.style.top = 'auto';
                     
                     // 第三步：开始向上滑动和毛玻璃效果
                     setTimeout(() => {
                         // 添加毛玻璃效果
                         overlay.style.backdropFilter = 'blur(20px)';
                         overlay.style.background = 'rgba(255, 255, 255, 0.1)';
                         
                         // 向上滑动
                         overlay.style.transform = 'translateY(-100%)';
                         
                         // 同时恢复主页面缩放
                         if (mainContent) {
                             mainContent.style.transform = 'scale(1)';
                             mainContent.style.transition = 'transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                         }
                         if (sidebar) {
                             sidebar.style.transform = 'scale(1)';
                             sidebar.style.transition = 'transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                         }
                         
                         // 第四步：动画完成后移除覆盖层
                         setTimeout(() => {
                             overlay.remove();
                             // 清除URL参数，但保持激活完成状态
                             const url = new URL(window.location);
                             url.searchParams.delete('from');
                             window.history.replaceState({}, document.title, url);
                             // 确保激活完成标记保持
                             window.activationCompleted = true;
                         }, 800);
                     }, 600);
                 }, 300);
             }
         
         // 创建Hello星空背景
         function createHelloStarfield() {
             const starfield = document.getElementById('hello-starfield');
             const numberOfStars = 100;
             
             for (let i = 0; i < numberOfStars; i++) {
                 const star = document.createElement('div');
                 star.className = 'star';
                 
                 // 随机位置
                 star.style.left = Math.random() * 100 + '%';
                 star.style.top = Math.random() * 100 + '%';
                 
                 // 随机大小
                 const size = Math.random() * 3 + 1;
                 star.style.width = size + 'px';
                 star.style.height = size + 'px';
                 
                 // 随机动画延迟
                 star.style.animationDelay = Math.random() * 3 + 's';
                 
                 starfield.appendChild(star);
             }
         }
         
         // 初始化Hello底部按钮
         function initHelloBottomButton() {
             const button = document.getElementById('hello-dynamicButton');
             
             // 延迟显示按钮
             setTimeout(() => {
                 button.classList.add('show');
                 
                 // 延迟展开按钮
                 setTimeout(() => {
                     button.classList.add('expanding');
                     
                     setTimeout(() => {
                         button.classList.remove('expanding');
                         button.classList.add('expanded');
                         
                         // 延迟启用按钮
                         setTimeout(() => {
                             button.classList.remove('disabled');
                             button.classList.add('enabled');
                             
                             // 添加点击事件
                             button.addEventListener('click', () => {
                                 console.log('Hello按钮被点击，按钮状态:', button.classList.toString());
                                 if (button.classList.contains('enabled')) {
                                     console.log('开始Hello解锁动画');
                                     // 开始Hello解锁动画
                                     startHelloUnlockAnimation();
                                 } else {
                                     console.log('按钮未启用，忽略点击');
                                 }
                             });
                         }, 200);
                     }, 400);
                 }, 200);
             }, 200);
         }
         
         // Hello解锁动画
         function startHelloUnlockAnimation() {
             const overlay = document.getElementById('hello-overlay');
             const button = document.getElementById('hello-dynamicButton');
             const buttonText = button.querySelector('.button-text');
             const mainContent = document.querySelector('.main-content');
             const sidebar = document.querySelector('.sidebar');
             
             if (!overlay || !button || !buttonText) return;
             
             // 第一步：文字渐隐，按钮减少高度
             buttonText.style.transition = 'opacity 0.3s ease-out';
             buttonText.style.opacity = '0';
             
             button.style.transition = 'all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
             button.style.height = '3px';
             button.style.width = '134px';
             button.style.borderRadius = '1.5px';
             button.style.background = 'rgba(255, 255, 255, 0.8)';
             
             // 第二步：按钮沿Y轴移动到底部8px位置
             setTimeout(() => {
                 button.style.position = 'fixed';
                 button.style.bottom = '8px';
                 button.style.left = '50%';
                 button.style.transform = 'translateX(-50%)';
                 button.style.top = 'auto';
                 
                 // 第三步：开始向上滑动和毛玻璃效果
                 setTimeout(() => {
                     console.log('开始Hello上移和毛玻璃动画');
                     
                     // 设置过渡动画
                     overlay.style.transition = 'all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                     
                     // 添加毛玻璃效果
                     overlay.style.backdropFilter = 'blur(20px)';
                     overlay.style.background = 'rgba(255, 255, 255, 0.1)';
                     
                     // 向上滑动
                     overlay.style.transform = 'translateY(-100%)';
                     
                     console.log('Hello动画样式已应用:', {
                         backdropFilter: overlay.style.backdropFilter,
                         background: overlay.style.background,
                         transform: overlay.style.transform,
                         transition: overlay.style.transition
                     });
                     
                     // 同时恢复主页面缩放
                     if (mainContent) {
                         mainContent.style.transform = 'scale(1)';
                         mainContent.style.transition = 'transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                     }
                     if (sidebar) {
                         sidebar.style.transform = 'scale(1)';
                         sidebar.style.transition = 'transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                     }
                     
                     // 第四步：动画完成后移除覆盖层
                     setTimeout(() => {
                         console.log('Hello动画完成，准备移除覆盖层');
                         overlay.remove();
                         // Hello激活完成后，关闭Hello激活功能
                         try {
                             const settings = JSON.parse(localStorage.getItem('classSystemSettings') || '{}');
                             settings.helloActivation = false;
                             localStorage.setItem('classSystemSettings', JSON.stringify(settings));
                             console.log('Hello激活功能已关闭');
                         } catch (e) {
                             console.warn('关闭Hello激活功能失败:', e);
                         }
                     }, 800);
                 }, 600);
             }, 300);
         }
         
         // Hello文字动画
         function startHelloTextAnimation() {
             const chineseGroup = document.getElementById('hello-chinese');
             const englishGroup = document.getElementById('hello-english');
             
             function animateText(group, delay = 0) {
                 return new Promise(resolve => {
                     setTimeout(() => {
                         group.classList.add('active');
                         const chars = group.querySelectorAll('.char');
                         
                         chars.forEach((char, index) => {
                             setTimeout(() => {
                                 char.classList.add('show');
                                 
                                 // 添加浮动效果
                                 setTimeout(() => {
                                     char.classList.add('float');
                                 }, 300);
                             }, index * 200);
                         });
                         
                         // 等待所有字符显示完成
                         setTimeout(() => {
                             // 保持显示一段时间
                             setTimeout(() => {
                                 // 隐藏文字
                                 chars.forEach((char, index) => {
                                     setTimeout(() => {
                                         char.classList.remove('show', 'float');
                                         char.classList.add('hide');
                                     }, index * 100);
                                 });
                                 
                                 setTimeout(() => {
                                     group.classList.remove('active');
                                     chars.forEach(char => {
                                         char.classList.remove('hide');
                                     });
                                     resolve();
                                 }, chars.length * 100 + 300);
                             }, 2000);
                         }, chars.length * 200 + 500);
                     }, delay);
                 });
             }
             
             // 循环动画
             async function loop() {
                 await animateText(chineseGroup);
                 await animateText(englishGroup, 500);
                 setTimeout(loop, 1000);
             }
             
             loop();
         }
         
         // 文字动画
         function startOverlayTextAnimation() {
             const chineseGroup = document.getElementById('chinese');
             const englishGroup = document.getElementById('english');
             
             function animateText(group, delay = 0) {
                 return new Promise(resolve => {
                     setTimeout(() => {
                         group.classList.add('active');
                         const chars = group.querySelectorAll('.char');
                         
                         chars.forEach((char, index) => {
                             setTimeout(() => {
                                 char.classList.add('show');
                                 
                                 // 添加浮动效果
                                 setTimeout(() => {
                                     char.classList.add('float');
                                 }, 300);
                             }, index * 200);
                         });
                         
                         // 等待所有字符显示完成
                         setTimeout(() => {
                             // 保持显示一段时间
                             setTimeout(() => {
                                 // 隐藏文字
                                 chars.forEach((char, index) => {
                                     setTimeout(() => {
                                         char.classList.remove('show', 'float');
                                         char.classList.add('hide');
                                     }, index * 100);
                                 });
                                 
                                 setTimeout(() => {
                                     group.classList.remove('active');
                                     chars.forEach(char => {
                                         char.classList.remove('hide');
                                     });
                                     resolve();
                                 }, chars.length * 100 + 300);
                             }, 2000);
                         }, chars.length * 200 + 500);
                     }, delay);
                 });
             }
             
             // 循环动画
             async function loop() {
                 await animateText(chineseGroup);
                 await animateText(englishGroup, 500);
                 setTimeout(loop, 1000);
             }
             
             loop();
         }
    </script>
    
    <!-- 缓存系统 -->
    <script src="Cache/StudentListCache.js"></script>
    <script src="Cache/DutyDataCache.js"></script>
    <script src="Cache/ScheduleCache.js"></script>
    <script src="Cache/ClassInfoCache.js"></script>
    <script src="Cache/HomeworkCache.js"></script>
    <script src="Cache/NoticeCache.js"></script>
    
    <!-- 弹窗系统 -->
    <script src="popup-system/toast.js"></script>
    <script src="popup-system/confirm.js"></script>
</body>
</html>