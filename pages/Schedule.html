<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>课程表 - 班级管理系统</title>
    <link rel="stylesheet" href="../popup-system/popup-system.css">
    <script src="../security/security-system.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f7;
            color: #333;
            line-height: 1.6;
            padding: 5px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* 深色主题样式 */
        body.dark-theme {
            background-color: #1a1a1a;
            color: #ffffff;
        }
        
        body.dark-theme .page-title {
            color: #ffffff;
        }
        
        body.dark-theme .edit-control-card,
        body.dark-theme .schedule-toolbar-card,
        body.dark-theme .schedule-content-card {
            background: #2d2d2d;
            border-color: #555;
        }
        
        body.dark-theme .schedule-table {
            background: #2d2d2d;
        }
        
        body.dark-theme .schedule-table th,
        body.dark-theme .schedule-table td {
            border-color: #555;
            color: #ffffff;
        }
        
        body.dark-theme .schedule-table th {
            background: #3d3d3d;
        }
        
        body.dark-theme .time-slot {
            background: #3d3d3d;
            color: #ffffff;
        }
        
        body.dark-theme .subject-cell {
            background: #2d2d2d;
        }
        
        body.dark-theme .subject-cell:hover {
            background: #3d3d3d;
        }
        
        body.dark-theme .subject-name {
            color: #ffffff;
        }
        
        body.dark-theme .teacher-name {
            color: #aaa;
        }
        
        body.dark-theme .classroom {
            color: #888;
        }
        
        /* 深色主题下的卡片组件 */
        body.dark-theme .edit-control-card,
        body.dark-theme .schedule-toolbar-card,
        body.dark-theme .schedule-content-card {
            background: #2d2d2d;
            border-color: #555;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        body.dark-theme .schedule-table {
            background: #2d2d2d;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        body.dark-theme .page-title {
            color: #ffffff;
        }

        .container {
            max-width: 100%;
            margin: 0;
            padding: 0 5px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 600;
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        /* 编辑控制卡片 */
        .edit-control-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .edit-controls {
            display: flex;
            gap: 10px;
        }

        /* 课程表工具栏卡片 */
        .schedule-toolbar-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }

        .schedule-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        /* 课程表内容卡片 */
        .schedule-content-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
            overflow-x: auto;
        }

        /* 课程表样式 */
        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .schedule-table th,
        .schedule-table td {
            border: 1px solid #e5e5e7;
            padding: 12px 8px;
            text-align: center;
            vertical-align: middle;
            position: relative;
            min-width: 100px;
        }

        .schedule-table th:last-child,
        .schedule-table td:last-child {
            border-right: none;
        }

        .schedule-table tr:last-child td {
            border-bottom: none;
        }

        .schedule-table th {
            background: #f6f6f6;
            font-weight: 600;
            color: #1d1d1f;
            font-size: 14px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .schedule-table th:first-child {
            background: #f6f6f6;
            font-weight: 600;
            color: #1d1d1f;
            position: sticky;
            left: 0;
            z-index: 11;
            min-width: 150px;
            width: 150px;
        }

        .schedule-table th:not(:first-child) {
            min-width: 100px;
            max-width: 120px;
        }

        .schedule-table td {
            background: white;
            transition: all 0.2s ease;
            cursor: pointer;
            font-size: 13px;
            line-height: 1.4;
            height: 60px;
            max-width: 120px;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .schedule-table td:hover {
            background: #f0f8ff;
        }

        .schedule-table td:first-child {
            background: #f9f9f9;
            font-weight: 500;
            position: sticky;
            left: 0;
            z-index: 9;
            min-width: 150px;
            width: 150px;
        }

        .schedule-table td:first-child:hover {
            background: #f0f0f0;
        }

        /* 编辑模式样式 */
        .edit-mode .schedule-table td:not(:first-child) {
            background: #fff8e1;
        }

        .edit-mode .schedule-table td:not(:first-child):hover {
            background: #fff3c4;
        }

        .edit-mode .schedule-table td:not(:first-child):focus {
            outline: 2px solid #007aff;
            background: white;
        }

        /* 课程单元格样式 */
        .schedule-cell {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            resize: none;
            outline: none;
            font-family: inherit;
            font-size: inherit;
            text-align: center;
            padding: 4px;
            box-sizing: border-box;
        }

        /* 按钮样式 */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: #4a90e2;
            color: white;
        }

        .btn-primary:hover {
            background: #357abd;
            box-shadow: 0 2px 8px rgba(74, 144, 226, 0.3);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
        }

        /* 消息样式 */
        .schedule-messages {
            margin-bottom: 20px;
        }

        .success-message, .error-message {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }

        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e5e5e7;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .close {
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            color: #6c757d;
            transition: color 0.2s ease;
        }

        .close:hover {
            color: #dc3545;
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid #e5e5e7;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* 表单样式 */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #1d1d1f;
        }

        .form-control, input[type="text"], input[type="time"], select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d1d6;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-control:focus, input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #007aff;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        /* 时间段列表样式 */
        .time-slot-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid #e5e5e7;
            border-radius: 6px;
        }

        .time-slot-item {
            padding: 12px 16px;
            border-bottom: 1px solid #e5e5e7;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .time-slot-item:last-child {
            border-bottom: none;
        }

        .time-slot-info {
            flex: 1;
        }

        .time-slot-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .time-slot-time {
            font-size: 12px;
            color: #6c757d;
        }

        .time-slot-actions {
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
        }

        /* 星期选择器样式 */
        .week-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        
        .week-checkbox {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            min-width: 60px;
            justify-content: center;
        }
        
        .week-checkbox:hover {
            border-color: #007bff;
            background: #f8f9ff;
        }
        
        .week-checkbox.selected {
            border-color: #007bff;
            background: #007bff;
            color: white;
        }
        
        .week-checkbox input[type="checkbox"] {
            display: none;
        }

        /* 右键菜单样式 */
        .context-menu {
            position: fixed;
            background: white;
            border: 1px solid #e5e5e7;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            min-width: 150px;
            overflow: hidden;
        }

        .context-menu-item {
            padding: 10px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            transition: background-color 0.2s ease;
        }

        .context-menu-item:hover {
            background: #f0f8ff;
        }

        .context-menu-separator {
            height: 1px;
            background: #e5e5e7;
            margin: 4px 0;
        }

        .context-menu-icon {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }



        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .page-title {
                font-size: 1.8rem;
                margin-bottom: 1rem;
                text-align: center;
            }

            .edit-control-card, .schedule-toolbar-card {
                padding: 12px;
                margin-bottom: 15px;
            }

            .schedule-toolbar {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }

            .schedule-toolbar .btn {
                justify-content: center;
                padding: 10px;
                font-size: 14px;
            }

            .schedule-content-card {
                padding: 0;
                overflow-x: auto;
            }

            .schedule-table {
                min-width: 600px;
                font-size: 11px;
            }

            .schedule-table th,
            .schedule-table td {
                padding: 6px 3px;
                min-width: 70px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .schedule-table th:first-child,
            .schedule-table td:first-child {
                min-width: 80px;
                position: sticky;
                left: 0;
                background: inherit;
                z-index: 1;
            }

            .modal-content {
                margin: 5% auto;
                width: 95%;
                max-height: 90vh;
                overflow-y: auto;
            }

            .week-selector {
                flex-direction: column;
                gap: 8px;
            }

            .week-selector .btn {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 5px;
            }
            
            .page-title {
                font-size: 1.5rem;
            }
            
            .edit-control-card, .schedule-toolbar-card {
                padding: 10px;
            }
            
            .schedule-table {
                min-width: 500px;
                font-size: 10px;
            }
            
            .schedule-table th,
            .schedule-table td {
                padding: 4px 2px;
                min-width: 60px;
            }
            
            .schedule-table th:first-child,
            .schedule-table td:first-child {
                min-width: 70px;
            }
        }

        /* 文件输入隐藏 */
        .file-input {
            display: none;
        }

        /* 拖拽样式 */
        .schedule-table td.drag-over {
            background: #e3f2fd !important;
            border: 2px dashed #2196f3;
        }

        .schedule-table td.dragging {
            opacity: 0.5;
        }

        /* 时间列布局 */
        .time-slot-item {
            position: relative;
            padding: 8px;
        }

        .time-slot-info {
            flex: 1;
        }

        .time-slot-name {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .time-slot-time {
            font-size: 12px;
            color: #666;
        }

        /* 单元格操作按钮 */
        .cell-actions {
            position: absolute;
            top: 2px;
            right: 2px;
            display: none;
        }

        .schedule-table td:hover .cell-actions {
            display: block;
        }

        .cell-actions .btn {
            margin-left: 2px;
        }

        .btn-cell {
            padding: 1px 4px;
            font-size: 10px;
            margin-left: 2px;
        }

        .cell-action-btn {
            width: 16px;
            height: 16px;
            border: none;
            border-radius: 2px;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cell-edit-btn {
            background: #007aff;
            color: white;
        }

        .cell-delete-btn {
            background: #dc3545;
            color: white;
        }

        /* 表格中的按钮样式 */
        .cell-actions .btn {
            width: 20px;
            height: 20px;
            padding: 0;
            min-width: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
        }

        .cell-actions .btn svg {
            fill: white;
            width: 12px;
            height: 12px;
        }

        /* 表格头部按钮样式 */
        .schedule-table th {
            position: relative;
            padding: 8px;
        }

        .schedule-table th .btn {
            width: 18px;
            height: 18px;
            padding: 0;
            min-width: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
            margin-left: 8px;
            vertical-align: middle;
        }

        .schedule-table th .btn svg {
            fill: white;
            width: 12px;
            height: 12px;
        }

        /* 表格底部按钮样式 */
        .schedule-table tbody .btn {
            width: 24px;
            height: 24px;
            padding: 0;
            min-width: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
        }

        .schedule-table tbody .btn svg {
            fill: white;
            width: 14px;
            height: 14px;
        }

        /* 时间段管理模态框中的按钮样式 */
        .time-slot-actions .btn {
            width: 22px;
            height: 22px;
            padding: 0;
            min-width: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
        }

        .time-slot-actions .btn svg {
            fill: white;
            width: 12px;
            height: 12px;
        }

        /* 已移除添加时间段按钮样式 */

        /* 时间段管理样式 */
        .time-slot-list {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
        }

        .time-slot-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 5px;
            background: #f9f9f9;
            border-radius: 3px;
            border-left: 4px solid #007bff;
        }

        .time-slot-item.break {
            border-left-color: #28a745;
        }

        .time-slot-item.lunch {
            border-left-color: #ffc107;
        }

        .time-slot-item.activity {
            border-left-color: #17a2b8;
        }

        .time-slot-info {
            flex: 1;
        }

        .time-slot-name {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .time-slot-time {
            font-size: 12px;
            color: #666;
        }

        .time-slot-actions {
            display: flex;
            gap: 5px;
        }

        /* SVG 图标定义 */
        .icon {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-title">课程表</div>
        
        <!-- 编辑控制按钮 -->
        <div class="edit-control-card">
            <button id="editModeBtn" class="btn btn-primary" onclick="toggleEditMode()" title="进入编辑模式">编辑</button>
            <button class="btn btn-warning" onclick="resetSchedule()" title="重置课程表为工作日模式">重置</button>
            <div id="editControls" class="edit-controls" style="display: none;">
                <button class="btn btn-success" onclick="saveSchedule()" title="保存修改">保存</button>
                <button class="btn btn-secondary" onclick="cancelEdit()" title="撤销修改">撤销</button>
                <button class="btn btn-danger" onclick="exitEditMode()" title="退出编辑模式">退出编辑</button>
            </div>
        </div>
        
        <!-- 课程表工具栏卡片 -->
        <div id="scheduleToolbar" class="schedule-toolbar-card" style="display: none;">
            <div class="schedule-toolbar">


                <button class="btn btn-info" onclick="showTimeSlotManager()" title="管理时间段">时间管理</button>
                <button class="btn btn-warning" onclick="showBatchAddModal()" title="批量添加课程">批量添加</button>
                <button class="btn btn-info" onclick="document.getElementById('fileInput').click()" title="从CSV文件导入课程表数据">导入</button>
                <button class="btn btn-secondary" onclick="exportSchedule()" title="导出课程表为CSV文件">导出</button>
                <button class="btn btn-danger" onclick="clearSchedule()" title="清空所有课程表数据">清空</button>
                <input type="file" id="fileInput" class="file-input" accept=".csv,.xlsx,.xls" onchange="importSchedule(event)" style="display: none;">
            </div>
        </div>
        
        <div class="schedule-messages">
            <div class="success-message" id="successMessage" style="display: none;"></div>
            <div class="error-message" id="errorMessage" style="display: none;"></div>
            <div class="loading" id="loading" style="display: none;">正在处理中...</div>
        </div>

        <!-- 课程表内容卡片 -->
        <div class="schedule-content-card">
            <table class="schedule-table" id="scheduleTable">
                <thead>
                    <tr>
                        <th>时间</th>
                        <th>周一</th>
                        <th>周二</th>
                        <th>周三</th>
                        <th>周四</th>
                        <th>周五</th>
                        <th>周六</th>
                        <th>周日</th>
                    </tr>
                </thead>
                <tbody id="scheduleBody">
                    <!-- 课程表内容将通过JavaScript生成 -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- 时间段管理模态框 -->
    <div id="timeSlotModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>时间段管理</h3>
                <span class="close" onclick="closeTimeSlotModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="time-slot-list" id="timeSlotList">
                    <!-- 时间段列表 -->
                </div>
                <div class="add-time-slot">
                    <h4>添加新时间段</h4>
                    <div class="form-group">
                        <label>时间段名称:</label>
                        <input type="text" id="timeSlotName" placeholder="例如：第1节课、课间操、午休">
                    </div>
                    <div class="form-group">
                        <label>开始时间:</label>
                        <input type="time" id="startTime">
                    </div>
                    <div class="form-group">
                        <label>结束时间:</label>
                        <input type="time" id="endTime">
                    </div>
                    <div class="form-group">
                        <label>类型:</label>
                        <select id="slotType">
                            <option value="class">课程</option>
                            <option value="break">课间</option>
                            <option value="lunch">午休</option>
                            <option value="activity">活动</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="addNewTimeSlot()" title="添加时间段">
                    添加时间段
                </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 右键菜单 -->
    <div id="contextMenu" class="context-menu" style="display: none;">
        <div class="context-menu-item" onclick="copyCell()"><svg class="context-menu-icon"><use href="#copy"></use></svg>复制</div>
        <div class="context-menu-item" onclick="pasteCell()"><svg class="context-menu-icon"><use href="#paste"></use></svg>粘贴</div>
        <div class="context-menu-item" onclick="clearCell()"><svg class="context-menu-icon"><use href="#delete"></use></svg>清空</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" onclick="insertRowAbove()"><svg class="context-menu-icon"><use href="#arrow-up"></use></svg>上方插入行</div>
        <div class="context-menu-item" onclick="insertRowBelow()"><svg class="context-menu-icon"><use href="#arrow-down"></use></svg>下方插入行</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" onclick="insertColumnLeft()"><svg class="context-menu-icon"><use href="#arrow-left"></use></svg>左侧插入列</div>
        <div class="context-menu-item" onclick="insertColumnRight()"><svg class="context-menu-icon"><use href="#arrow-right"></use></svg>右侧插入列</div>
    </div>

    <!-- 自定义确认弹窗 -->
    <div id="confirmModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 id="confirmTitle">确认操作</h3>
                <span class="close" onclick="closeConfirmModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">确定要执行此操作吗？</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeConfirmModal()">
                取消
            </button>
            <button class="btn btn-danger" id="confirmBtn" onclick="confirmAction()">
                确定
            </button>
            </div>
        </div>
    </div>

    <!-- 自定义输入弹窗 -->
    <div id="promptModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 id="promptTitle">输入信息</h3>
                <span class="close" onclick="closePromptModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p id="promptMessage">请输入：</p>
                <input type="text" id="promptInput" class="form-control" placeholder="">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePromptModal()">
                取消
            </button>
            <button class="btn btn-primary" onclick="submitPrompt()">
                确定
            </button>
            </div>
        </div>
    </div>

    <!-- 批量添加模态框 -->
    <div id="batchAddModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>批量添加课程</h3>
                <span class="close" onclick="closeBatchAddModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="batchCourseName">课程名称</label>
                    <input type="text" id="batchCourseName" class="form-control" placeholder="请输入课程名称（如：午休、早读）">
                </div>
                <div class="form-group">
                    <label for="batchTimeSlot">选择时间段</label>
                    <select id="batchTimeSlot" class="form-control">
                        <option value="">请选择时间段</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>选择星期</label>
                    <div class="week-selector" id="weekSelector">
                        <!-- 动态生成星期选择器 -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeBatchAddModal()">
                取消
            </button>
                <button class="btn btn-primary" onclick="confirmBatchAdd()" title="批量添加">
                    批量添加
                </button>
            </div>
        </div>
    </div>

    <script src="../Cache/ScheduleCache.js"></script>
    <script>
        // 全局变量（将逐步迁移到缓存系统）
        let timeSlots = [
            { name: '第1节课', start: '08:00', end: '08:45', type: 'class' },
            { name: '课间操', start: '08:45', end: '08:55', type: 'break' },
            { name: '第2节课', start: '08:55', end: '09:40', type: 'class' },
            { name: '大课间', start: '09:40', end: '10:00', type: 'break' },
            { name: '第3节课', start: '10:00', end: '10:45', type: 'class' },
            { name: '第4节课', start: '10:55', end: '11:40', type: 'class' },
            { name: '午休', start: '12:00', end: '14:00', type: 'lunch' },
            { name: '第5节课', start: '14:00', end: '14:45', type: 'class' },
            { name: '第6节课', start: '14:55', end: '15:40', type: 'class' },
            { name: '第7节课', start: '15:50', end: '16:35', type: 'class' },
            { name: '第8节课', start: '16:45', end: '17:30', type: 'class' }
        ];
        let weekDays = ['周一', '周二', '周三', '周四', '周五'];
        let isEditMode = false;
        let scheduleBackup = {};
        let copiedCellContent = '';
        let currentContextCell = null;
        let confirmCallback = null;
        let promptCallback = null;

        // 初始化
        function initSchedule() {
            loadDataFromLocalStorage();
            renderScheduleTable();
            setupEventListeners();
        }

        // 数据加载与保存（使用缓存系统）
        function loadDataFromLocalStorage() {
            // 从缓存系统加载数据
            timeSlots = scheduleCache.getTimeSlots();
            weekDays = scheduleCache.getWeekDays();
            
            // 检查weekDays是否包含周末，如果包含则重置为工作日
            if (weekDays.includes('周六') || weekDays.includes('周日')) {
                weekDays = ['周一', '周二', '周三', '周四', '周五'];
                scheduleCache.setWeekDays(weekDays);
                console.log('检测到包含周末的旧数据，已重置为工作日');
            }
        }

        function saveDataToLocalStorage() {
            // 使用缓存系统保存数据
            scheduleCache.setTimeSlots(timeSlots);
            scheduleCache.setWeekDays(weekDays);
            scheduleCache.save();
        }

        // 表格渲染
        function renderScheduleTable() {
            const table = document.getElementById('scheduleTable');
            if (!table) return;
            
            // 重新生成表头
            const thead = table.querySelector('thead');
            if (thead) {
                const headerRow = thead.querySelector('tr');
                headerRow.innerHTML = '<th>时间</th>';
                // 限制最多显示7天
                const displayWeekDays = weekDays.slice(0, 7);
                displayWeekDays.forEach((day, index) => {
                    const th = document.createElement('th');
                    if (isEditMode) {
                        th.innerHTML = `${day} <button class="btn btn-danger" onclick="removeWeekDay(${index})" title="删除"><svg width="16" height="16"><use href="#delete"></use></svg></button>`;
                    } else {
                        th.innerHTML = day;
                    }
                    headerRow.appendChild(th);
                });
                // 添加新列按钮（带7天限制）
                if (isEditMode) {
                    const addTh = document.createElement('th');
                    addTh.innerHTML = '<button class="btn btn-primary" onclick="addWeekDayWithLimit()" title="添加星期"><svg width="16" height="16"><use href="#add"></use></svg></button>';
                    headerRow.appendChild(addTh);
                }
            }
            
            const tbody = document.getElementById('scheduleBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            timeSlots.forEach((timeSlot, timeIndex) => {
                const row = document.createElement('tr');
                
                // 时间列
                const timeCell = document.createElement('td');
                if (isEditMode) {
                    timeCell.innerHTML = `
                        <div class="time-slot-info">
                            <div class="time-slot-name">${timeSlot.name}</div>
                            <div class="time-slot-time">${timeSlot.start}-${timeSlot.end}</div>
                        </div>
                        <div class="cell-actions">
                            <button class="btn btn-warning" onclick="editTimeSlot(${timeIndex})" title="编辑"><svg width="16" height="16"><use href="#edit"></use></svg></button>
                            <button class="btn btn-danger" onclick="removeTimeSlot(${timeIndex})" title="删除"><svg width="16" height="16"><use href="#delete"></use></svg></button>
                        </div>
                    `;
                } else {
                    timeCell.innerHTML = `
                        <div class="time-slot-info">
                            <div class="time-slot-name">${timeSlot.name}</div>
                            <div class="time-slot-time">${timeSlot.start}-${timeSlot.end}</div>
                        </div>
                    `;
                }
                timeCell.className = `time-slot-item ${timeSlot.type}`;
                row.appendChild(timeCell);
                
                // 星期列 - 限制最多显示7天
                const displayWeekDays = weekDays.slice(0, 7);
                
                if (timeSlot.type === 'class') {
                    // 课程时间段：显示正常的课程格子
                    displayWeekDays.forEach((day, dayIndex) => {
                        const cell = document.createElement('td');
                        const course = scheduleCache.getCourse(timeIndex, dayIndex);
                        const cellData = course ? (course.subject || '') : '';
                        
                        const textarea = document.createElement('textarea');
                        textarea.className = 'schedule-cell';
                        textarea.value = cellData;
                        textarea.placeholder = '点击编辑课程';
                        textarea.draggable = isEditMode;
                        textarea.disabled = !isEditMode; // 根据编辑模式设置是否可编辑
                        textarea.setAttribute('data-day', dayIndex);
                        textarea.setAttribute('data-slot', timeIndex);
                        textarea.addEventListener('input', function() {
                            const course = { subject: this.value };
                            scheduleCache.setCourse(timeIndex, dayIndex, course);
                            adjustFontSize(this); // 调整字体大小
                        });
                        
                        // 初始化时调整字体大小
                        adjustFontSize(textarea);
                        cell.appendChild(textarea);
                        row.appendChild(cell);
                    });
                } else {
                    // 非课程时间段：显示合并的单元格
                    const mergedCell = document.createElement('td');
                    // 在编辑模式下需要考虑额外的"添加星期"按钮列
                    const colSpan = isEditMode ? displayWeekDays.length + 1 : displayWeekDays.length;
                    mergedCell.colSpan = colSpan;
                    mergedCell.className = `schedule-cell-readonly ${timeSlot.type}`;
                    mergedCell.textContent = timeSlot.name;
                    mergedCell.style.textAlign = 'center';
                    mergedCell.style.color = '#666';
                    mergedCell.style.fontStyle = 'italic';
                    mergedCell.style.backgroundColor = '#f8f9fa';
                    mergedCell.style.fontWeight = '500';
                    row.appendChild(mergedCell);
                }
                
                tbody.appendChild(row);
            });
            
            // 编辑模式下不再显示添加时间段按钮
        }

        // 事件监听器设置
        function setupEventListeners() {
            // 右键菜单
            document.addEventListener('contextmenu', handleContextMenu);
            document.addEventListener('click', hideContextMenu);
            
            // 拖拽事件绑定
            const scheduleTable = document.getElementById('scheduleTable');
            if (scheduleTable) {
                scheduleTable.addEventListener('dragstart', handleDragStart);
                scheduleTable.addEventListener('dragover', handleDragOver);
                scheduleTable.addEventListener('dragleave', handleDragLeave);
                scheduleTable.addEventListener('drop', handleDrop);
                scheduleTable.addEventListener('dragend', handleDragEnd);
            }
            
            // 模态框点击外部关闭
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });

            // ESC键关闭模态框
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const modals = document.querySelectorAll('.modal');
                    modals.forEach(modal => {
                        if (modal.style.display !== 'none') {
                            modal.style.display = 'none';
                        }
                    });
                    hideContextMenu();
                }
            });
        }

        // 编辑模式切换
        async function toggleEditMode() {
            if (isEditMode) {
                exitEditMode();
            } else {
                // 进入编辑模式前需要安全验证
                const verified = await securitySystem.verifySensitiveOperation('修改课程表');
                if (!verified) {
                    return;
                }
                enterEditMode();
            }
        }

        function enterEditMode() {
            isEditMode = true;
            scheduleBackup = JSON.parse(JSON.stringify(scheduleCache.getScheduleData()));
            
            document.body.classList.add('edit-mode');
            document.getElementById('editModeBtn').style.display = 'none';
            document.getElementById('editControls').style.display = 'flex';
            document.getElementById('scheduleToolbar').style.display = 'block';
            
            renderScheduleTable();
            toast.info('已进入编辑模式，可以修改课程表内容', '编辑模式');
        }

        function exitEditMode() {
            isEditMode = false;
            
            document.body.classList.remove('edit-mode');
            document.getElementById('editModeBtn').style.display = 'inline-flex';
            document.getElementById('editControls').style.display = 'none';
            document.getElementById('scheduleToolbar').style.display = 'none';
            
            renderScheduleTable();
            toast.info('已退出编辑模式', '退出编辑');
        }

        function saveSchedule() {
            saveDataToLocalStorage();
            scheduleBackup = {};
            toast.success('课程表已保存', '保存成功');
        }

        function cancelEdit() {
            if (Object.keys(scheduleBackup).length > 0) {
                scheduleCache.setScheduleData(JSON.parse(JSON.stringify(scheduleBackup)));
                renderScheduleTable();
                toast.info('已撤销所有修改', '撤销成功');
            }
        }

        // 重置课程表
        function resetSchedule() {
            console.log('重置按钮被点击');
            if (typeof confirm === 'undefined' || !confirm.warning) {
                console.error('confirm系统未正确加载');
                alert('确定要重置课程表吗？这将清除所有课程数据并重置为工作日模式。');
                // 直接执行重置
                scheduleData = {};
                weekDays = ['周一', '周二', '周三', '周四', '周五'];
                localStorage.removeItem('scheduleData');
                localStorage.removeItem('weekDays');
                localStorage.removeItem('timeSlots');
                renderScheduleTable();
                alert('课程表已重置为工作日模式');
                return;
            }
            
            confirm.warning('确定要重置课程表吗？', '这将清除所有课程数据并重置为工作日模式（周一到周五）。此操作不可撤销。').then(result => {
                console.log('确认对话框结果:', result);
                if (result) {
                    // 使用缓存系统清空所有数据
                    scheduleCache.clearAll();
                    // 重置为默认工作日
                    weekDays = ['周一', '周二', '周三', '周四', '周五'];
                    scheduleCache.setWeekDays(weekDays);
                    // 重新加载数据
                    timeSlots = scheduleCache.getTimeSlots();
                    // 重新渲染表格
                    renderScheduleTable();
                    if (typeof toast !== 'undefined' && toast.success) {
                        toast.success('课程表已重置为工作日模式', '重置成功');
                    } else {
                        alert('课程表已重置为工作日模式');
                    }
                }
            }).catch(error => {
                console.error('确认对话框错误:', error);
                alert('重置功能出现错误，请刷新页面后重试');
            });
        }

        // 单元格编辑处理
        function handleCellEdit(e) {
            const cell = e.target;
            const slot = cell.getAttribute('data-slot');
            const day = cell.getAttribute('data-day');
            const key = `${slot}-${day}`;
            
            scheduleData[key] = cell.textContent.trim();
            saveDataToLocalStorage();
            adjustFontSize();
        }

        // 时间段管理
        // 已移除添加时间段功能

        function showTimeSlotManager() {
            const modal = document.getElementById('timeSlotModal');
            if (modal) {
                renderTimeSlotList();
                modal.style.display = 'block';
            }
        }

        function closeTimeSlotModal() {
            const modal = document.getElementById('timeSlotModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function renderTimeSlotList() {
            const list = document.getElementById('timeSlotList');
            if (!list) return;
            
            list.innerHTML = '';
            
            timeSlots.forEach((slot, index) => {
                const item = document.createElement('div');
                item.className = `time-slot-item ${slot.type}`;
                if (isEditMode) {
                    item.innerHTML = `
                        <div class="time-slot-info">
                            <div class="time-slot-name">${slot.name}</div>
                            <div class="time-slot-time">${slot.start} - ${slot.end}</div>
                        </div>
                        <div class="time-slot-actions">
                            <button class="btn btn-small btn-warning" onclick="editTimeSlot(${index})" title="编辑">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="m18.5 2.5 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                            </button>
                            <button class="btn btn-small btn-danger" onclick="removeTimeSlot(${index})" title="删除">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3,6 5,6 21,6"></polyline>
                                    <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                </svg>
                            </button>
                        </div>
                    `;
                } else {
                    item.innerHTML = `
                        <div class="time-slot-info">
                            <div class="time-slot-name">${slot.name}</div>
                            <div class="time-slot-time">${slot.start} - ${slot.end}</div>
                        </div>
                    `;
                }
                list.appendChild(item);
            });
        }

        function addNewTimeSlot() {
            const name = document.getElementById('timeSlotName').value.trim();
            const start = document.getElementById('startTime').value;
            const end = document.getElementById('endTime').value;
            const type = document.getElementById('slotType').value;
            
            if (!name || !start || !end) {
                toast.error('请填写完整的时间段信息', '输入错误');
                return;
            }
            
            if (start >= end) {
                toast.error('结束时间必须晚于开始时间', '时间错误');
                return;
            }
            
            // 检查时间冲突（不能有重叠，但可以紧接着）
            for (let i = 0; i < timeSlots.length; i++) {
                const existingSlot = timeSlots[i];
                
                // 检查是否有重叠（新时间段的开始时间在现有时间段内，或新时间段的结束时间在现有时间段内）
                if ((start > existingSlot.start && start < existingSlot.end) ||
                    (end > existingSlot.start && end < existingSlot.end) ||
                    (start <= existingSlot.start && end >= existingSlot.end)) {
                    toast.error(`时间段与"${existingSlot.name}"冲突，不能有重叠`, '时间冲突');
                    return;
                }
            }
            
            const newSlot = { name, start, end, type };
            timeSlots.push(newSlot);
            saveTimeSlots();
            renderTimeSlotList();
            renderScheduleTable();
            
            // 清空表单
            document.getElementById('timeSlotName').value = '';
            document.getElementById('startTime').value = '';
            document.getElementById('endTime').value = '';
            document.getElementById('slotType').value = 'class';
            
            toast.success('时间段添加成功！', '添加成功');
        }

        async function editTimeSlot(index) {
            const slot = timeSlots[index];
            if (!slot) return;
            
            return new Promise((resolve) => {
                const content = document.createElement('div');
                content.innerHTML = `
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500;">时间段名称:</label>
                        <input type="text" id="edit-name" value="${slot.name}" style="width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px; font-size: 14px;">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500;">开始时间:</label>
                        <input type="time" id="edit-start" value="${slot.start}" style="width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px; font-size: 14px;">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500;">结束时间:</label>
                        <input type="time" id="edit-end" value="${slot.end}" style="width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px; font-size: 14px;">
                    </div>
                `;
                
                modal.show({
                    title: '编辑时间段',
                    content,
                    buttons: [
                        { text: '取消', onClick: () => resolve(false) },
                        { 
                            text: '保存', 
                            type: 'primary', 
                            onClick: () => {
                                const newName = document.getElementById('edit-name').value.trim();
                                const newStart = document.getElementById('edit-start').value;
                                const newEnd = document.getElementById('edit-end').value;
                                
                                // 验证输入
                                if (!newName) {
                                    toast.error('请输入时间段名称');
                                    return;
                                }
                                
                                if (!newStart || !newEnd) {
                                    toast.error('请选择开始时间和结束时间');
                                    return;
                                }
                                
                                // 验证结束时间必须晚于开始时间
                                if (newEnd <= newStart) {
                                    toast.error('结束时间必须晚于开始时间');
                                    return;
                                }
                                
                                // 检查时间冲突（不能有重叠，但可以紧接着）
                                for (let i = 0; i < timeSlots.length; i++) {
                                    if (i === index) continue; // 跳过当前编辑的时间段
                                    const existingSlot = timeSlots[i];
                                    
                                    // 检查是否有重叠（新时间段的开始时间在现有时间段内，或新时间段的结束时间在现有时间段内）
                                    if ((newStart > existingSlot.start && newStart < existingSlot.end) ||
                                        (newEnd > existingSlot.start && newEnd < existingSlot.end) ||
                                        (newStart <= existingSlot.start && newEnd >= existingSlot.end)) {
                                        toast.error(`时间段与"${existingSlot.name}"冲突，不能有重叠`);
                                        return;
                                    }
                                }
                                
                                // 更新时间段
                                timeSlots[index] = { ...slot, name: newName, start: newStart, end: newEnd };
                                saveTimeSlots();
                                renderTimeSlotList();
                                renderScheduleTable();
                                toast.success('时间段修改成功！');
                                resolve(true);
                            }
                        }
                    ],
                    onClose: () => resolve(false)
                });
                
                // 聚焦到名称输入框
                setTimeout(() => {
                    const nameInput = document.getElementById('edit-name');
                    if (nameInput) nameInput.focus();
                }, 100);
            });
        }

        async function removeTimeSlot(index) {
            const confirmed = await confirm.delete('确定要删除这个时间段吗？此操作不可撤销。');
            if (confirmed) {
                timeSlots.splice(index, 1);
                saveTimeSlots();
                renderTimeSlotList();
                renderScheduleTable();
                toast.success('时间段删除成功！', '删除成功');
            }
        }

        // 保存函数
        function saveTimeSlots() {
            // 使用缓存系统保存时间段
            scheduleCache.setTimeSlots(timeSlots);
        }

        function saveWeekDays() {
            // 使用缓存系统保存星期设置
            scheduleCache.setWeekDays(weekDays);
        }

        function generateScheduleCSV() {
            let csv = '时间,' + weekDays.join(',') + '\n';
            
            timeSlots.forEach((timeSlot, timeIndex) => {
                const timeStr = `${timeSlot.name}(${timeSlot.start}-${timeSlot.end})`;
                let row = timeStr;
                weekDays.forEach((day, dayIndex) => {
                    const key = `${timeIndex}-${dayIndex}`;
                    let content = '';
                    if (timeSlot.type === 'class') {
                        content = scheduleData[key] || '';
                    } else {
                        content = timeSlot.name;
                    }
                    row += ',' + content;
                });
                csv += row + '\n';
            });
            
            return csv;
        }

        // 星期管理
        async function addWeekDayWithLimit() {
            if (weekDays.length >= 7) {
                toast.error('最多只能添加7个星期', '添加失败');
                return;
            }
            const day = await customPrompt('添加星期', '请输入星期名称：');
            if (day && !weekDays.includes(day)) {
                weekDays.push(day);
                saveWeekDays();
                renderScheduleTable();
                toast.success(`星期 "${day}" 已添加`, '添加成功');
            } else if (weekDays.includes(day)) {
                toast.error('该星期已存在', '添加失败');
            }
        }

        // removeWeekDay别名函数，兼容demo.html调用
        function removeWeekDay(index) {
            if (weekDays.length <= 1) {
                toast.error('至少需要保留一个星期', '错误');
                return;
            }
            deleteWeekDay(index);
        }

        function deleteWeekDay(index) {
            const day = weekDays[index];
            if (typeof confirm !== 'undefined' && confirm.warning) {
                confirm.warning(`确定要删除 "${day}" 吗？这将删除该列的所有课程数据。`, '删除星期').then(result => {
                    if (result) {
                        // 删除相关的课程数据
                        const newScheduleData = {};
                        Object.keys(scheduleData).forEach(key => {
                            const [slotIndex, dayIndex] = key.split('-').map(Number);
                            if (dayIndex < index) {
                                newScheduleData[key] = scheduleData[key];
                            } else if (dayIndex > index) {
                                const newKey = `${slotIndex}-${dayIndex - 1}`;
                                newScheduleData[newKey] = scheduleData[key];
                            }
                            // dayIndex === index 的数据被删除
                        });
                        
                        scheduleData = newScheduleData;
                        weekDays.splice(index, 1);
                        renderScheduleTable();
                        if (typeof toast !== 'undefined' && toast.success) {
                            toast.success(`星期 "${day}" 已删除`, '删除成功');
                        } else {
                            alert(`星期 "${day}" 已删除`);
                        }
                    }
                });
            } else {
                if (window.confirm(`确定要删除 "${day}" 吗？这将删除该列的所有课程数据。`)) {
                    // 删除相关的课程数据
                    const newScheduleData = {};
                    Object.keys(scheduleData).forEach(key => {
                        const [slotIndex, dayIndex] = key.split('-').map(Number);
                        if (dayIndex < index) {
                            newScheduleData[key] = scheduleData[key];
                        } else if (dayIndex > index) {
                            const newKey = `${slotIndex}-${dayIndex - 1}`;
                            newScheduleData[newKey] = scheduleData[key];
                        }
                        // dayIndex === index 的数据被删除
                    });
                    
                    scheduleData = newScheduleData;
                    weekDays.splice(index, 1);
                    renderScheduleTable();
                    alert(`星期 "${day}" 已删除`);
                }
            }
        }

        // 课程表导入导出
        function generateCSVTemplate() {
            let csv = '时间段,' + weekDays.join(',') + '\n';
            timeSlots.forEach((slot, slotIndex) => {
                let row = `"${slot.name} (${slot.start}-${slot.end})"`;
                weekDays.forEach((day, dayIndex) => {
                    const key = `${slotIndex}-${dayIndex}`;
                    let content = '';
                    if (slot.type === 'class') {
                        content = scheduleData[key] || '';
                    } else {
                        content = ''; // 非课程时间段导出空内容
                    }
                    row += ',"' + content.replace(/"/g, '""') + '"';
                });
                csv += row + '\n';
            });
            return csv;
        }

        function importSchedule(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    const lines = csv.split('\n').filter(line => line.trim());
                    
                    if (lines.length < 2) {
                        if (typeof toast !== 'undefined' && toast.error) {
                            toast.error('CSV文件格式不正确', '导入失败');
                        } else {
                            alert('CSV文件格式不正确');
                        }
                        return;
                    }

                    // 解析表头
                    const headers = parseCSVLine(lines[0]);
                    const importedWeekDays = headers.slice(1); // 去掉第一列"时间段"

                    // 解析数据行
                    const importedData = {};
                    const importedTimeSlots = [];
                    
                    for (let i = 1; i < lines.length; i++) {
                        const cells = parseCSVLine(lines[i]);
                        if (cells.length < 2) continue;
                        
                        const timeSlotInfo = cells[0];
                        const slotIndex = i - 1;
                        
                        // 解析时间段信息
                        const match = timeSlotInfo.match(/^(.+?)\s*\((.+?)\)$/);
                        let slotName, startTime, endTime;
                        
                        if (match) {
                            const [, name, timeRange] = match;
                            slotName = name.trim();
                            const timeParts = timeRange.split('-');
                            startTime = timeParts[0] ? timeParts[0].trim() : '08:00';
                            endTime = timeParts[1] ? timeParts[1].trim() : '08:45';
                        } else {
                            slotName = timeSlotInfo;
                            startTime = '08:00';
                            endTime = '08:45';
                        }
                        
                        // 根据时间段名称判断类型
                        let slotType = 'class';
                        const lowerName = slotName.toLowerCase();
                        if (lowerName.includes('午休') || lowerName.includes('午餐') || lowerName.includes('lunch')) {
                            slotType = 'lunch';
                        } else if (lowerName.includes('课间') || lowerName.includes('休息') || lowerName.includes('break') || 
                                 lowerName.includes('操') || lowerName.includes('活动')) {
                            slotType = 'break';
                        }
                        
                        // 调试输出：显示解析的时间段信息
                        console.log('解析时间段:', {
                            原始: timeSlotInfo,
                            解析后名称: slotName,
                            类型: slotType,
                            开始时间: startTime,
                            结束时间: endTime
                        });
                        
                        importedTimeSlots.push({
                            name: slotName,
                            start: startTime,
                            end: endTime,
                            type: slotType
                        });
                        
                        // 解析课程数据
                        for (let j = 1; j < cells.length && j - 1 < importedWeekDays.length; j++) {
                            const dayIndex = j - 1;
                            const key = `${slotIndex}-${dayIndex}`;
                            importedData[key] = cells[j].trim();
                        }
                    }

                    // 确认导入
                    if (typeof confirm !== 'undefined' && confirm.warning) {
                        confirm.warning('导入将覆盖现有的课程表数据，确定要继续吗？', '确认导入').then(result => {
                            if (result) {
                                // 使用缓存系统保存导入的数据
                                scheduleCache.setTimeSlots(importedTimeSlots);
                                scheduleCache.setWeekDays(importedWeekDays);
                                
                                // 保存课程数据
                                Object.keys(importedData).forEach(key => {
                                    const [timeIndex, dayIndex] = key.split('-').map(Number);
                                    const courseText = importedData[key];
                                    if (courseText) {
                                        const course = { subject: courseText };
                                        scheduleCache.setCourse(timeIndex, dayIndex, course);
                                    }
                                });
                                
                                // 重新加载数据并渲染
                                timeSlots = scheduleCache.getTimeSlots();
                                weekDays = scheduleCache.getWeekDays();
                                renderScheduleTable();
                                
                                if (typeof toast !== 'undefined' && toast.success) {
                                    toast.success('课程表数据已导入', '导入成功');
                                } else {
                                    alert('课程表数据已导入');
                                }
                            }
                        });
                    } else {
                        if (window.confirm('导入将覆盖现有的课程表数据，确定要继续吗？')) {
                            // 使用缓存系统保存导入的数据
                            scheduleCache.setTimeSlots(importedTimeSlots);
                            scheduleCache.setWeekDays(importedWeekDays);
                            
                            // 保存课程数据
                            Object.keys(importedData).forEach(key => {
                                const [timeIndex, dayIndex] = key.split('-').map(Number);
                                const courseText = importedData[key];
                                if (courseText) {
                                    const course = { subject: courseText };
                                    scheduleCache.setCourse(timeIndex, dayIndex, course);
                                }
                            });
                            
                            // 重新加载数据并渲染
                            timeSlots = scheduleCache.getTimeSlots();
                            weekDays = scheduleCache.getWeekDays();
                            renderScheduleTable();
                            
                            alert('课程表数据已导入');
                        }
                    }
                    
                } catch (error) {
                    console.error('导入失败:', error);
                    if (typeof toast !== 'undefined' && toast.error) {
                        toast.error('文件解析出错，请检查文件格式', '导入失败');
                    } else {
                        alert('文件解析出错，请检查文件格式');
                    }
                }
            };
            reader.readAsText(file, 'UTF-8');
            
            // 清空文件输入
            event.target.value = '';
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const nextChar = line[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        current += '"';
                        i++; // 跳过下一个引号
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current);
            return result;
        }

        function exportSchedule() {
            const csv = generateCSVTemplate();
            downloadCSV(csv, '课程表.csv');
            if (typeof toast !== 'undefined' && toast.success) {
                toast.success('课程表已导出为CSV文件', '导出成功');
            } else {
                alert('课程表已导出为CSV文件');
            }
        }

        // 清空课程表
        function clearSchedule() {
            if (typeof confirm !== 'undefined' && confirm.warning) {
                confirm.warning('确定要清空所有课程表数据吗？此操作不可撤销。', '清空课程表').then(result => {
                    if (result) {
                        // 使用缓存系统清空课程数据，保留时间段和星期设置
                        scheduleCache.clearSchedule();
                        renderScheduleTable();
                        if (typeof toast !== 'undefined' && toast.success) {
                            toast.success('课程表已清空', '清空成功');
                        } else {
                            alert('课程表已清空');
                        }
                    }
                });
            } else {
                if (window.confirm('确定要清空所有课程表数据吗？此操作不可撤销。')) {
                    // 使用缓存系统清空课程数据，保留时间段和星期设置
                    scheduleCache.clearSchedule();
                    renderScheduleTable();
                    alert('课程表已清空');
                }
            }
        }

        // 批量添加课程
        function showBatchAddModal() {
            const modal = document.getElementById('batchAddModal');
            if (modal) {
                // 填充时间段选项
                const timeSlotSelect = document.getElementById('batchTimeSlot');
                timeSlotSelect.innerHTML = '<option value="">请选择时间段</option>';
                timeSlots.forEach((slot, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = slot;
                    timeSlotSelect.appendChild(option);
                });
                
                // 生成星期选择器
                const weekSelector = document.getElementById('weekSelector');
                weekSelector.innerHTML = '';
                weekDays.forEach((day, index) => {
                    const checkbox = document.createElement('div');
                    checkbox.className = 'week-checkbox';
                    checkbox.innerHTML = `
                        <input type="checkbox" id="week_${index}" value="${index}">
                        <label for="week_${index}">${day}</label>
                    `;
                    checkbox.addEventListener('click', function() {
                        const input = checkbox.querySelector('input');
                        input.checked = !input.checked;
                        checkbox.classList.toggle('selected', input.checked);
                    });
                    weekSelector.appendChild(checkbox);
                });
                
                modal.style.display = 'block';
            }
        }

        function closeBatchAddModal() {
            const modal = document.getElementById('batchAddModal');
            if (modal) {
                modal.style.display = 'none';
                // 清空表单
                document.getElementById('batchCourseName').value = '';
                document.getElementById('batchTimeSlot').value = '';
                const checkboxes = document.querySelectorAll('#weekSelector .week-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.classList.remove('selected');
                    checkbox.querySelector('input').checked = false;
                });
            }
        }

        function confirmBatchAdd() {
            const courseName = document.getElementById('batchCourseName').value.trim();
            const timeSlotIndex = document.getElementById('batchTimeSlot').value;
            const selectedWeeks = [];
            
            // 获取选中的星期
            const checkboxes = document.querySelectorAll('#weekSelector input[type="checkbox"]:checked');
            checkboxes.forEach(checkbox => {
                selectedWeeks.push(parseInt(checkbox.value));
            });
            
            // 验证输入
            if (!courseName) {
                toast.warning('请输入课程名称');
                return;
            }
            
            if (!timeSlotIndex) {
                toast.warning('请选择时间段');
                return;
            }
            
            if (selectedWeeks.length === 0) {
                toast.warning('请至少选择一个星期');
                return;
            }
            
            // 批量添加课程
            selectedWeeks.forEach(weekIndex => {
                const key = `${timeSlotIndex}-${weekIndex}`;
                scheduleData[key] = courseName;
            });
            
            // 保存数据并刷新表格
            saveDataToLocalStorage();
            renderScheduleTable();
            closeBatchAddModal();
            
            showMessage(`成功批量添加课程"${courseName}"到${selectedWeeks.length}个时间段！`, 'success');
        }

        // CSV下载辅助函数
        function downloadCSV(content, filename) {
            const BOM = '\uFEFF'; // UTF-8 BOM
            const blob = new Blob([BOM + content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // Toast 消息提示


        // 右键菜单功能
        function handleContextMenu(e) {
            const cell = e.target.closest('td');
            if (cell && cell.closest('#scheduleTable') && isEditMode) {
                e.preventDefault();
                currentContextCell = cell;
                showContextMenu(e.pageX, e.pageY);
            }
        }

        function showContextMenu(x, y) {
            const menu = document.getElementById('contextMenu');
            menu.style.display = 'block';
            menu.style.left = x + 'px';
            menu.style.top = y + 'px';
            
            // 确保菜单不超出视窗
            const rect = menu.getBoundingClientRect();
            if (rect.right > window.innerWidth) {
                menu.style.left = (x - rect.width) + 'px';
            }
            if (rect.bottom > window.innerHeight) {
                menu.style.top = (y - rect.height) + 'px';
            }
        }

        function hideContextMenu() {
            document.getElementById('contextMenu').style.display = 'none';
        }

        function copyCell() {
            if (currentContextCell) {
                copiedCellContent = currentContextCell.textContent.trim();
                hideContextMenu();
                toast.success('单元格内容已复制', '复制成功');
            }
        }

        function pasteCell() {
            if (currentContextCell && copiedCellContent !== '') {
                currentContextCell.textContent = copiedCellContent;
                const slot = parseInt(currentContextCell.getAttribute('data-slot'));
                const day = parseInt(currentContextCell.getAttribute('data-day'));
                
                // 使用缓存系统保存课程数据
                const course = { subject: copiedCellContent };
                scheduleCache.setCourse(slot, day, course);
                
                hideContextMenu();
                adjustFontSize();
                toast.success('内容已粘贴到单元格', '粘贴成功');
            }
        }

        function clearCell() {
            if (currentContextCell) {
                currentContextCell.textContent = '';
                const slot = parseInt(currentContextCell.getAttribute('data-slot'));
                const day = parseInt(currentContextCell.getAttribute('data-day'));
                
                // 使用缓存系统删除课程数据
                scheduleCache.removeCourse(slot, day);
                
                hideContextMenu();
                toast.success('单元格内容已清空', '清空成功');
            }
        }

        function insertRowAbove() {
            if (currentContextCell) {
                const slotIndex = parseInt(currentContextCell.getAttribute('data-slot'));
                insertTimeSlotAt(slotIndex);
                hideContextMenu();
            }
        }

        function insertRowBelow() {
            if (currentContextCell) {
                const slotIndex = parseInt(currentContextCell.getAttribute('data-slot'));
                insertTimeSlotAt(slotIndex + 1);
                hideContextMenu();
            }
        }

        function insertColumnLeft() {
            if (currentContextCell) {
                const dayIndex = parseInt(currentContextCell.getAttribute('data-day'));
                insertWeekDayAt(dayIndex);
                hideContextMenu();
            }
        }

        function insertColumnRight() {
            if (currentContextCell) {
                const dayIndex = parseInt(currentContextCell.getAttribute('data-day'));
                insertWeekDayAt(dayIndex + 1);
                hideContextMenu();
            }
        }

        async function insertTimeSlotAt(index) {
             const name = await customPrompt('插入时间段', '请输入时间段名称：');
             if (name) {
                 // 调整现有数据的索引
                 const newScheduleData = {};
                 Object.keys(scheduleData).forEach(key => {
                     const [slotIndex, dayIndex] = key.split('-').map(Number);
                     if (slotIndex >= index) {
                         const newKey = `${slotIndex + 1}-${dayIndex}`;
                         newScheduleData[newKey] = scheduleData[key];
                     } else {
                         newScheduleData[key] = scheduleData[key];
                     }
                 });
                 
                 scheduleData = newScheduleData;
                 
                 const newSlot = {
                     name: name,
                     startTime: '08:00',
                     endTime: '08:45',
                     type: 'class'
                 };
                 timeSlots.splice(index, 0, newSlot);
                 renderScheduleTable();
                 toast.success(`时间段 "${name}" 已插入`, '插入成功');
             }
         }

         async function insertWeekDayAt(index) {
             const day = await customPrompt('插入星期', '请输入星期名称：');
             if (day && !weekDays.includes(day)) {
                 // 调整现有数据的索引
                 const newScheduleData = {};
                 Object.keys(scheduleData).forEach(key => {
                     const [slotIndex, dayIndex] = key.split('-').map(Number);
                     if (dayIndex >= index) {
                         const newKey = `${slotIndex}-${dayIndex + 1}`;
                         newScheduleData[newKey] = scheduleData[key];
                     } else {
                         newScheduleData[key] = scheduleData[key];
                     }
                 });
                 
                 scheduleData = newScheduleData;
                 weekDays.splice(index, 0, day);
                 renderScheduleTable();
                 toast.success(`星期 "${day}" 已插入`, '插入成功');
             } else if (weekDays.includes(day)) {
                 toast.error('该星期已存在', '插入失败');
             }
         }

         // 拖拽功能
         let dragSource = null;

         function handleDragStart(e) {
             if (isEditMode && e.target.classList.contains('schedule-cell')) {
                 e.target.classList.add('dragging');
                 dragSource = e.target;
                 e.dataTransfer.setData('text/plain', e.target.value || e.target.textContent);
                 e.dataTransfer.effectAllowed = 'move';
             } else {
                 e.preventDefault();
             }
         }

         function handleDragOver(e) {
             e.preventDefault();
             let target = e.target;
             if (target.classList.contains('schedule-cell')) {
                 // 如果是textarea，检查它是否有正确的属性
                 if (target !== dragSource && isEditMode && target.getAttribute('data-slot')) {
                     target.classList.add('drag-over');
                 }
             } else {
                 // 如果不是textarea，尝试找到包含的textarea
                 const textarea = target.querySelector('.schedule-cell');
                 if (textarea && textarea !== dragSource && isEditMode && textarea.getAttribute('data-slot')) {
                     textarea.classList.add('drag-over');
                 }
             }
         }

         function handleDragLeave(e) {
             let target = e.target;
             if (target.classList.contains('schedule-cell')) {
                 target.classList.remove('drag-over');
             } else {
                 const textarea = target.querySelector('.schedule-cell');
                 if (textarea) {
                     textarea.classList.remove('drag-over');
                 }
             }
         }

         function handleDrop(e) {
             e.preventDefault();
             let target = e.target;
             
             // 如果目标不是textarea，尝试找到包含的textarea
             if (!target.classList.contains('schedule-cell')) {
                 const textarea = target.querySelector('.schedule-cell');
                 if (textarea) {
                     target = textarea;
                 }
             }
             
             if (target && dragSource && target !== dragSource && isEditMode && 
                 target.classList.contains('schedule-cell') && target.getAttribute('data-slot')) {
                 target.classList.remove('drag-over');
                 
                 const sourceSlot = dragSource.getAttribute('data-slot');
                 const sourceDay = dragSource.getAttribute('data-day');
                 const targetSlot = target.getAttribute('data-slot');
                 const targetDay = target.getAttribute('data-day');
                 
                 const sourceKey = `${sourceSlot}-${sourceDay}`;
                 const targetKey = `${targetSlot}-${targetDay}`;
                 
                 const sourceValue = scheduleData[sourceKey] || '';
                 const targetValue = scheduleData[targetKey] || '';
                 
                 scheduleData[sourceKey] = targetValue;
                 scheduleData[targetKey] = sourceValue;
                 
                 // 更新textarea的值
                 dragSource.value = targetValue;
                 target.value = sourceValue;
                 
                 saveDataToLocalStorage();
                 adjustFontSize(dragSource);
                 adjustFontSize(target);
                 toast.success('课程已交换', '交换成功');
             }
         }

         function handleDragEnd(e) {
             if (dragSource) {
                 dragSource.classList.remove('dragging');
                 dragSource = null;
             }
             // 清除所有拖拽样式
             document.querySelectorAll('.drag-over').forEach(el => {
                 el.classList.remove('drag-over');
             });
         }

         // 字体大小调整
         function adjustFontSize(element) {
            if (element) {
                // 调整单个元素的字体大小
                const content = element.value || element.textContent || '';
                if (content.length > 10) {
                    element.style.fontSize = '11px';
                } else if (content.length > 6) {
                    element.style.fontSize = '12px';
                } else {
                    element.style.fontSize = '13px';
                }
            } else {
                // 调整所有单元格的字体大小
                const cells = document.querySelectorAll('.schedule-cell');
                cells.forEach(cell => {
                    const content = cell.value || cell.textContent || '';
                    if (content.length > 10) {
                        cell.style.fontSize = '11px';
                    } else if (content.length > 6) {
                        cell.style.fontSize = '12px';
                    } else {
                        cell.style.fontSize = '13px';
                    }
                });
            }
        }

         // 自定义确认对话框
         function customConfirm(title, message, callback) {
             const modal = document.getElementById('confirmModal');
             document.getElementById('confirmTitle').textContent = title;
             document.getElementById('confirmMessage').textContent = message;
             confirmCallback = callback;
             modal.style.display = 'block';
         }

         function closeConfirmModal() {
             document.getElementById('confirmModal').style.display = 'none';
             confirmCallback = null;
         }

         function confirmAction() {
             if (confirmCallback) {
                 confirmCallback();
             }
             closeConfirmModal();
         }

         // 自定义输入对话框
         function customPrompt(title, message, defaultValue = '') {
             return new Promise((resolve) => {
                 const modal = document.getElementById('promptModal');
                 document.getElementById('promptTitle').textContent = title;
                 document.getElementById('promptMessage').textContent = message;
                 document.getElementById('promptInput').value = defaultValue;
                 
                 promptCallback = (value) => {
                     resolve(value);
                 };
                 
                 modal.style.display = 'block';
                 document.getElementById('promptInput').focus();
             });
         }

         function closePromptModal() {
             document.getElementById('promptModal').style.display = 'none';
             if (promptCallback) {
                 promptCallback(null);
                 promptCallback = null;
             }
         }

         function submitPrompt() {
             const value = document.getElementById('promptInput').value.trim();
             if (promptCallback) {
                 promptCallback(value || null);
                 promptCallback = null;
             }
             closePromptModal();
         }

         // 主题管理函数
         function applyTheme(theme) {
             if (theme === 'dark') {
                 document.body.classList.add('dark-theme');
             } else {
                 document.body.classList.remove('dark-theme');
             }
         }
         
         function loadTheme() {
             const savedTheme = localStorage.getItem('theme') || 'light';
             applyTheme(savedTheme);
         }
         
         // 监听来自父窗口的主题切换消息
         window.addEventListener('message', function(event) {
             if (event.data.type === 'themeChange') {
                 applyTheme(event.data.theme);
             }
         });
         
         // 页面加载完成后初始化
         document.addEventListener('DOMContentLoaded', function() {
             initSchedule();
             loadTheme();
         });
         
         // 页面显示时重新加载主题
         window.addEventListener('pageshow', loadTheme);
     </script>

     <!-- SVG 图标定义 -->
     <svg style="display: none;">
         <defs>
             <symbol id="copy" viewBox="0 0 24 24">
                 <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
             </symbol>
             <symbol id="paste" viewBox="0 0 24 24">
                 <path d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"/>
             </symbol>
             <symbol id="delete" viewBox="0 0 24 24">
                 <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
             </symbol>
             <symbol id="add" viewBox="0 0 24 24">
                 <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
             </symbol>
             <symbol id="edit" viewBox="0 0 24 24">
                 <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
             </symbol>
             <symbol id="save" viewBox="0 0 24 24">
                 <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
             </symbol>
             <symbol id="cancel" viewBox="0 0 24 24">
                 <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
             </symbol>
             <symbol id="download" viewBox="0 0 24 24">
                 <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
             </symbol>
             <symbol id="upload" viewBox="0 0 24 24">
                 <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/>
             </symbol>
             <symbol id="clear" viewBox="0 0 24 24">
                 <path d="M5 13h14v-2H5v2zm-2 4h14v-2H3v2zM7 7v2h14V7H7z"/>
             </symbol>
             <symbol id="time" viewBox="0 0 24 24">
                 <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
             </symbol>
             <symbol id="arrow-up" viewBox="0 0 24 24">
                 <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
             </symbol>
             <symbol id="arrow-down" viewBox="0 0 24 24">
                 <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
             </symbol>
             <symbol id="arrow-left" viewBox="0 0 24 24">
                 <path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"/>
             </symbol>
             <symbol id="arrow-right" viewBox="0 0 24 24">
                 <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
             </symbol>
         </defs>
     </svg>
     
     <script src="../popup-system/toast.js"></script>
     <script src="../popup-system/modal.js"></script>
     <script src="../popup-system/confirm.js"></script>
 </body>
 </html>